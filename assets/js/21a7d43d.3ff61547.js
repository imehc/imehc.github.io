(self.webpackChunkanch=self.webpackChunkanch||[]).push([["2062"],{28368(e,t,n){"use strict";n.r(t),n.d(t,{metadata:()=>i,default:()=>E,frontMatter:()=>m,contentTitle:()=>u,toc:()=>f,assets:()=>p});var i=JSON.parse('{"id":"web/three/basic/first-person-controls","title":"\u7B2C\u4E00\u4EBA\u79F0\u8F68\u9053\u63A7\u5236","description":"\u6838\u5FC3\u6982\u5FF5","source":"@site/docs/web/three/basic/09-first-person-controls.mdx","sourceDirName":"web/three/basic","slug":"/web/three/basic/first-person-controls","permalink":"/web/three/basic/first-person-controls","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Javascript","permalink":"/tags/javascript"}],"version":"current","lastUpdatedBy":"cming","lastUpdatedAt":1768362596000,"sidebarPosition":9,"frontMatter":{"sidebar_position":9,"title":"\u7B2C\u4E00\u4EBA\u79F0\u8F68\u9053\u63A7\u5236","tags":["Javascript"]},"sidebar":"webSidebar","previous":{"title":"\u8F68\u9053\u63A7\u5236","permalink":"/web/three/basic/orbit-controls"},"next":{"title":"\u52A9\u624B","permalink":"/web/three/basic/helpers"}}'),r=n(35656),s=n(75395),o=n(50642),l=n(6124),c=n(60140),a=n(57140),d=n(82044);let h=()=>{let[e,t]=(0,a.useState)(!0);return(0,a.useId)(),(0,a.useId)(),(0,a.useEffect)(()=>{let e=()=>{t(e=>!e)};return document.addEventListener("pointerlockchange",e,!1),()=>{document.removeEventListener("pointerlockchange",e,!1)}},[]),(0,r.jsxs)(d.A,{children:[(0,r.jsxs)(c.Hl,{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[100,10,100,100,10,100]}),(0,r.jsx)("meshBasicMaterial",{wireframe:!0,color:"lime"})]}),(0,r.jsx)(o.Z,{selector:"#button"}),(0,r.jsx)(l.U,{})]}),(0,r.jsxs)("div",{id:"instructions",className:e?"show":"hide",children:["Instructions",(0,r.jsx)("button",{id:"button",type:"button",children:"Click To Enter"})]})]})},m={sidebar_position:9,title:"\u7B2C\u4E00\u4EBA\u79F0\u8F68\u9053\u63A7\u5236",tags:["Javascript"]},u="\u7B2C\u4E00\u4EBA\u79F0\u8F68\u9053\u63A7\u5236",p={},f=[{value:"\u6838\u5FC3\u6982\u5FF5",id:"\u6838\u5FC3\u6982\u5FF5",level:2}];function v(e){let t={h1:"h1",h2:"h2",header:"header",li:"li",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"\u7B2C\u4E00\u4EBA\u79F0\u8F68\u9053\u63A7\u5236",children:"\u7B2C\u4E00\u4EBA\u79F0\u8F68\u9053\u63A7\u5236"})}),"\n",(0,r.jsx)(h,{}),"\n",(0,r.jsx)(t.h2,{id:"\u6838\u5FC3\u6982\u5FF5",children:"\u6838\u5FC3\u6982\u5FF5"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"PointerLockControls"}),": \u7B2C\u4E00\u4EBA\u79F0\u89C6\u89D2\u63A7\u5236\u5668"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Pointer Lock API"}),": \u9501\u5B9A\u9F20\u6807\u6307\u9488\uFF0C\u9690\u85CF\u5149\u6807"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"selector"}),": \u6307\u5B9A\u89E6\u53D1\u63A7\u5236\u7684\u6309\u94AE"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"pointerlockchange"}),": \u76D1\u542C\u9501\u5B9A\u72B6\u6001\u53D8\u5316\u4E8B\u4EF6"]}),"\n"]})]})}function E(e={}){let{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(v,{...e})}):v(e)}},50642(e,t,n){"use strict";n.d(t,{Z:()=>E});var i=n(44320),r=n(45225),s=n(57140),o=n(67199),l=n(65730),c=Object.defineProperty,a=(e,t,n)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?c(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n,n};let d=new o.O9p(0,0,0,"YXZ"),h=new o.Pq0,m={type:"change"},u={type:"lock"},p={type:"unlock"},f=Math.PI/2;class v extends l.Q{constructor(e,t){super(),a(this,"camera"),a(this,"domElement"),a(this,"isLocked"),a(this,"minPolarAngle"),a(this,"maxPolarAngle"),a(this,"pointerSpeed"),a(this,"onMouseMove",e=>{this.domElement&&!1!==this.isLocked&&(d.setFromQuaternion(this.camera.quaternion),d.y-=.002*e.movementX*this.pointerSpeed,d.x-=.002*e.movementY*this.pointerSpeed,d.x=Math.max(f-this.maxPolarAngle,Math.min(f-this.minPolarAngle,d.x)),this.camera.quaternion.setFromEuler(d),this.dispatchEvent(m))}),a(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(u),this.isLocked=!0):(this.dispatchEvent(p),this.isLocked=!1))}),a(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),a(this,"connect",e=>{this.domElement=e||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),a(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),a(this,"dispose",()=>{this.disconnect()}),a(this,"getObject",()=>this.camera),a(this,"direction",new o.Pq0(0,0,-1)),a(this,"getDirection",e=>e.copy(this.direction).applyQuaternion(this.camera.quaternion)),a(this,"moveForward",e=>{h.setFromMatrixColumn(this.camera.matrix,0),h.crossVectors(this.camera.up,h),this.camera.position.addScaledVector(h,e)}),a(this,"moveRight",e=>{h.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(h,e)}),a(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),a(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}}let E=s.forwardRef(({domElement:e,selector:t,onChange:n,onLock:o,onUnlock:l,enabled:c=!0,makeDefault:a,...d},h)=>{let{camera:m,...u}=d,p=(0,r.C)(e=>e.setEvents),f=(0,r.C)(e=>e.gl),E=(0,r.C)(e=>e.camera),x=(0,r.C)(e=>e.invalidate),g=(0,r.C)(e=>e.events),b=(0,r.C)(e=>e.get),k=(0,r.C)(e=>e.set),w=m||E,L=e||g.connected||f.domElement,P=s.useMemo(()=>new v(w),[w]);return s.useEffect(()=>{if(c){P.connect(L);let e=b().events.compute;return p({compute(e,t){let n=t.size.width/2,i=t.size.height/2;t.pointer.set(n/t.size.width*2-1,-(2*(i/t.size.height))+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{P.disconnect(),p({compute:e})}}},[c,P]),s.useEffect(()=>{let e=e=>{x(),n&&n(e)};P.addEventListener("change",e),o&&P.addEventListener("lock",o),l&&P.addEventListener("unlock",l);let i=()=>P.lock(),r=t?Array.from(document.querySelectorAll(t)):[document];return r.forEach(e=>e&&e.addEventListener("click",i)),()=>{P.removeEventListener("change",e),o&&P.removeEventListener("lock",o),l&&P.removeEventListener("unlock",l),r.forEach(e=>e?e.removeEventListener("click",i):void 0)}},[n,o,l,t,P,x]),s.useEffect(()=>{if(a){let e=b().controls;return k({controls:P}),()=>k({controls:e})}},[a,P]),s.createElement("primitive",(0,i.A)({ref:h,object:P},u))})},6124(e,t,n){"use strict";n.d(t,{U:()=>c});var i=n(57140),r=n(45225),s=n(15697),o=n.n(s);function l(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function c({showPanel:e=0,className:t,parent:n}){let s=function(e,t=[],n){let[r,s]=i.useState();return i.useLayoutEffect(()=>{let t=e();return s(t),l(void 0,t),()=>l(void 0,null)},t),r}(()=>new(o()),[]);return i.useEffect(()=>{if(s){let i=n&&n.current||document.body;s.showPanel(e),null==i||i.appendChild(s.dom);let o=(null!=t?t:"").split(" ").filter(e=>e);o.length&&s.dom.classList.add(...o);let l=(0,r.j)(()=>s.begin()),c=(0,r.k)(()=>s.end());return()=>{o.length&&s.dom.classList.remove(...o),null==i||i.removeChild(s.dom),l(),c()}}},[n,s,t,e]),null}},15697(e){var t;(t=function(){function e(e){return r.appendChild(e.dom),e}function n(e){for(var t=0;t<r.children.length;t++)r.children[t].style.display=t===e?"block":"none";i=e}var i=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",function(e){e.preventDefault(),n(++i%r.children.length)},!1);var s=(performance||Date).now(),o=s,l=0,c=e(new t.Panel("FPS","#0ff","#002")),a=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=e(new t.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:r,addPanel:e,showPanel:n,begin:function(){s=(performance||Date).now()},end:function(){l++;var e=(performance||Date).now();if(a.update(e-s,200),e>o+1e3&&(c.update(1e3*l/(e-o),100),o=e,l=0,d)){var t=performance.memory;d.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){s=this.end()},domElement:r,setMode:n}}).Panel=function(e,t,n){var i=1/0,r=0,s=Math.round,o=s(window.devicePixelRatio||1),l=80*o,c=48*o,a=3*o,d=2*o,h=3*o,m=15*o,u=74*o,p=30*o,f=document.createElement("canvas");f.width=l,f.height=c,f.style.cssText="width:80px;height:48px";var v=f.getContext("2d");return v.font="bold "+9*o+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=n,v.fillRect(0,0,l,c),v.fillStyle=t,v.fillText(e,a,d),v.fillRect(h,m,u,p),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(h,m,u,p),{dom:f,update:function(c,E){i=Math.min(i,c),r=Math.max(r,c),v.fillStyle=n,v.globalAlpha=1,v.fillRect(0,0,l,m),v.fillStyle=t,v.fillText(s(c)+" "+e+" ("+s(i)+"-"+s(r)+")",a,d),v.drawImage(f,h+o,m,u-o,p,h,m,u-o,p),v.fillRect(h+u-o,m,o,p),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(h+u-o,m,o,s((1-c/E)*p))}}},e.exports=t},65730(e,t,n){"use strict";n.d(t,{Q:()=>r});var i=Object.defineProperty;class r{constructor(){var e;let t,n;n=void 0,(t="symbol"!=typeof(e="_listeners")?e+"":e)in this?i(this,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):this[t]=n}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let n=this._listeners[e];if(void 0!==n){let e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}}}]);