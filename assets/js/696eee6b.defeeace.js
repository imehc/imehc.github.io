(self.webpackChunkanch=self.webpackChunkanch||[]).push([["1834"],{97585(e,t,r){"use strict";r.r(t),r.d(t,{metadata:()=>n,default:()=>j,frontMatter:()=>g,contentTitle:()=>y,toc:()=>w,assets:()=>b});var n=JSON.parse('{"id":"web/three/basic/annotations","title":"\u6DFB\u52A0\u6CE8\u91CA","description":"\u6838\u5FC3\u6982\u5FF5","source":"@site/docs/web/three/basic/20-annotations.mdx","sourceDirName":"web/three/basic","slug":"/web/three/basic/annotations","permalink":"/web/three/basic/annotations","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Javascript","permalink":"/tags/javascript"}],"version":"current","lastUpdatedBy":"imehc","lastUpdatedAt":1768180953000,"sidebarPosition":20,"frontMatter":{"sidebar_position":20,"title":"\u6DFB\u52A0\u6CE8\u91CA","tags":["Javascript"]},"sidebar":"webSidebar","previous":{"title":"useGLTF","permalink":"/web/three/basic/use-gltf"},"next":{"title":"GLTFJSX","permalink":"/web/three/basic/gltfjsx"}}'),i=r(35656),l=r(75395),a=r(1340),s=r(99005),o=r(6124),c=r(60140),d=r(22374),u=r(24809),h=r(54325),f=r(57140);let m=({url:e})=>{let{scene:t}=(0,u.p)(e),[r,n]=(0,f.useState)({});if(!r[e]){let l=[];t.traverse(e=>{e.userData.prop&&l.push((0,i.jsx)(h.E,{position:[e.position.x,e.position.y,e.position.z],distanceFactor:.25,children:(0,i.jsx)("div",{className:"annotation",children:e.userData.prop})},e.uuid))}),console.log(`Caching JSX for url ${e}`),n({...r,[e]:(0,i.jsx)("primitive",{object:t,children:l})})}return r[e]};var p=JSON.parse('{"hammer":"/models/annotations/hammer.glb","drill":"/models/annotations/drill.glb","tapeMeasure":"/models/annotations/tapeMeasure.glb"}'),x=r(82044);let v=()=>{let{model:e}=(0,d._5)({model:{value:"hammer",options:Object.keys(p)}});return(0,i.jsxs)(x.A,{children:[(0,i.jsxs)(c.Hl,{camera:{position:[0,0,-.2],near:.025},children:[(0,i.jsx)(a.OH,{files:"/models/assets-useGLTF/img/workshop_1k.hdr",background:!0}),(0,i.jsx)("group",{children:(0,i.jsx)(m,{url:p[e]})}),(0,i.jsx)(s.N,{autoRotate:!0}),(0,i.jsx)(o.U,{})]}),(0,i.jsxs)("span",{children:["The ",e.replace(/([A-Z])/g," $1").toLowerCase()," is selected."]})]})},g={sidebar_position:20,title:"\u6DFB\u52A0\u6CE8\u91CA",tags:["Javascript"]},y="\u6DFB\u52A0\u6CE8\u91CA",b={},w=[{value:"\u6838\u5FC3\u6982\u5FF5",id:"\u6838\u5FC3\u6982\u5FF5",level:2}];function M(e){let t={h1:"h1",h2:"h2",header:"header",li:"li",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"\u6DFB\u52A0\u6CE8\u91CA",children:"\u6DFB\u52A0\u6CE8\u91CA"})}),"\n",(0,i.jsx)(v,{}),"\n",(0,i.jsx)(t.h2,{id:"\u6838\u5FC3\u6982\u5FF5",children:"\u6838\u5FC3\u6982\u5FF5"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Html"}),": @react-three/drei \u63D0\u4F9B\u7684\u7EC4\u4EF6\uFF0C\u7528\u4E8E\u5728 3D \u573A\u666F\u4E2D\u5D4C\u5165 HTML \u5143\u7D20"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"scene.traverse()"}),": \u9012\u5F52\u904D\u5386\u573A\u666F\u4E2D\u7684\u6240\u6709\u5BF9\u8C61"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"userData"}),": Three.js \u5BF9\u8C61\u4E0A\u5B58\u50A8\u81EA\u5B9A\u4E49\u6570\u636E\u7684\u5C5E\u6027"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"distanceFactor"}),": \u63A7\u5236 HTML \u5143\u7D20\u968F\u76F8\u673A\u8DDD\u79BB\u7684\u7F29\u653E\u884C\u4E3A"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"\u7F13\u5B58\u673A\u5236"}),": \u907F\u514D\u91CD\u590D\u751F\u6210 JSX\uFF0C\u63D0\u9AD8\u6027\u80FD"]}),"\n"]})]})}function j(e={}){let{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(M,{...e})}):M(e)}},6124(e,t,r){"use strict";r.d(t,{U:()=>o});var n=r(57140),i=r(45225),l=r(15697),a=r.n(l);function s(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function o({showPanel:e=0,className:t,parent:r}){let l=function(e,t=[],r){let[i,l]=n.useState();return n.useLayoutEffect(()=>{let t=e();return l(t),s(void 0,t),()=>s(void 0,null)},t),i}(()=>new(a()),[]);return n.useEffect(()=>{if(l){let n=r&&r.current||document.body;l.showPanel(e),null==n||n.appendChild(l.dom);let a=(null!=t?t:"").split(" ").filter(e=>e);a.length&&l.dom.classList.add(...a);let s=(0,i.j)(()=>l.begin()),o=(0,i.k)(()=>l.end());return()=>{a.length&&l.dom.classList.remove(...a),null==n||n.removeChild(l.dom),s(),o()}}},[r,l,t,e]),null}},54325(e,t,r){"use strict";let n,i;r.d(t,{E:()=>y});var l=r(44320),a=r(57140),s=r(84668),o=r(67199),c=r(45225);let d=new o.Pq0,u=new o.Pq0,h=new o.Pq0,f=new o.I9Y;function m(e,t,r){let n=d.setFromMatrixPosition(e.matrixWorld);n.project(t);let i=r.width/2,l=r.height/2;return[n.x*i+i,-(n.y*l)+l]}let p=e=>1e-10>Math.abs(e)?0:e;function x(e,t,r=""){let n="matrix3d(";for(let r=0;16!==r;r++)n+=p(t[r]*e.elements[r])+(15!==r?",":")");return r+n}let v=(n=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>x(e,n)),g=(i=e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1],(e,t)=>x(e,i(t),"translate(-50%,-50%)")),y=a.forwardRef(({children:e,eps:t=.001,style:r,className:n,prepend:i,center:x,fullscreen:y,portal:b,distanceFactor:w,sprite:M=!1,transform:j=!1,occlude:P,onOcclude:S,castShadow:E,receiveShadow:R,material:T,geometry:k,zIndexRange:W=[0x1000037,0],calculatePosition:$=m,as:F="div",wrapperClass:z,pointerEvents:A="auto",...L},C)=>{let{gl:H,camera:D,scene:I,size:N,raycaster:J,events:q,viewport:O}=(0,c.C)(),[U]=a.useState(()=>document.createElement(F)),_=a.useRef(null),B=a.useRef(null),G=a.useRef(0),X=a.useRef([0,0]),V=a.useRef(null),Z=a.useRef(null),Y=(null==b?void 0:b.current)||q.connected||H.domElement.parentNode,K=a.useRef(null),Q=a.useRef(!1),ee=a.useMemo(()=>{var e;return P&&"blending"!==P||Array.isArray(P)&&P.length&&(e=P[0])&&"object"==typeof e&&"current"in e},[P]);a.useLayoutEffect(()=>{let e=H.domElement;P&&"blending"===P?(e.style.zIndex=`${Math.floor(W[0]/2)}`,e.style.position="absolute",e.style.pointerEvents="none"):(e.style.zIndex=null,e.style.position=null,e.style.pointerEvents=null)},[P]),a.useLayoutEffect(()=>{if(B.current){let e=_.current=s.createRoot(U);if(I.updateMatrixWorld(),j)U.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{let e=$(B.current,D,N);U.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${e[0]}px,${e[1]}px,0);transform-origin:0 0;`}return Y&&(i?Y.prepend(U):Y.appendChild(U)),()=>{Y&&Y.removeChild(U),e.unmount()}}},[Y,j]),a.useLayoutEffect(()=>{z&&(U.className=z)},[z]);let et=a.useMemo(()=>j?{position:"absolute",top:0,left:0,width:N.width,height:N.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:x?"translate3d(-50%,-50%,0)":"none",...y&&{top:-N.height/2,left:-N.width/2,width:N.width,height:N.height},...r},[r,x,y,N,j]),er=a.useMemo(()=>({position:"absolute",pointerEvents:A}),[A]);a.useLayoutEffect(()=>{var t,i;Q.current=!1,j?null==(t=_.current)||t.render(a.createElement("div",{ref:V,style:et},a.createElement("div",{ref:Z,style:er},a.createElement("div",{ref:C,className:n,style:r,children:e})))):null==(i=_.current)||i.render(a.createElement("div",{ref:C,style:et,className:n,children:e}))});let en=a.useRef(!0);(0,c.D)(e=>{if(B.current){D.updateMatrixWorld(),B.current.updateWorldMatrix(!0,!1);let e=j?X.current:$(B.current,D,N);if(j||Math.abs(G.current-D.zoom)>t||Math.abs(X.current[0]-e[0])>t||Math.abs(X.current[1]-e[1])>t){var r;let t,n,i,l,a=(r=B.current,t=d.setFromMatrixPosition(r.matrixWorld),n=u.setFromMatrixPosition(D.matrixWorld),i=t.sub(n),l=D.getWorldDirection(h),i.angleTo(l)>Math.PI/2),s=!1;ee&&(Array.isArray(P)?s=P.map(e=>e.current):"blending"!==P&&(s=[I]));let c=en.current;s?en.current=function(e,t,r,n){let i=d.setFromMatrixPosition(e.matrixWorld),l=i.clone();l.project(t),f.set(l.x,l.y),r.setFromCamera(f,t);let a=r.intersectObjects(n,!0);if(a.length){let e=a[0].distance;return i.distanceTo(r.ray.origin)<e}return!0}(B.current,D,J,s)&&!a:en.current=!a,c!==en.current&&(S?S(!en.current):U.style.display=en.current?"block":"none");let m=Math.floor(W[0]/2),x=P?ee?[W[0],m]:[m-1,0]:W;if(U.style.zIndex=`${function(e,t,r){if(t instanceof o.ubm||t instanceof o.qUd){let n=d.setFromMatrixPosition(e.matrixWorld),i=u.setFromMatrixPosition(t.matrixWorld),l=n.distanceTo(i),a=(r[1]-r[0])/(t.far-t.near),s=r[1]-a*t.far;return Math.round(a*l+s)}}(B.current,D,x)}`,j){let[e,t]=[N.width/2,N.height/2],r=D.projectionMatrix.elements[5]*t,{isOrthographicCamera:n,top:i,left:l,bottom:a,right:s}=D,o=v(D.matrixWorldInverse),c=n?`scale(${r})translate(${p(-(s+l)/2)}px,${p((i+a)/2)}px)`:`translateZ(${r}px)`,d=B.current.matrixWorld;M&&((d=D.matrixWorldInverse.clone().transpose().copyPosition(d).scale(B.current.scale)).elements[3]=d.elements[7]=d.elements[11]=0,d.elements[15]=1),U.style.width=N.width+"px",U.style.height=N.height+"px",U.style.perspective=n?"":`${r}px`,V.current&&Z.current&&(V.current.style.transform=`${c}${o}translate(${e}px,${t}px)`,Z.current.style.transform=g(d,1/((w||10)/400)))}else{let t=void 0===w?1:function(e,t){if(t instanceof o.qUd)return t.zoom;if(!(t instanceof o.ubm))return 1;{let r=d.setFromMatrixPosition(e.matrixWorld),n=u.setFromMatrixPosition(t.matrixWorld);return 1/(2*Math.tan(t.fov*Math.PI/180/2)*r.distanceTo(n))}}(B.current,D)*w;U.style.transform=`translate3d(${e[0]}px,${e[1]}px,0) scale(${t})`}X.current=e,G.current=D.zoom}}if(!ee&&K.current&&!Q.current)if(j){if(V.current){let e=V.current.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){let{isOrthographicCamera:t}=D;if(t||k)L.scale&&(Array.isArray(L.scale)?L.scale instanceof o.Pq0?K.current.scale.copy(L.scale.clone().divideScalar(1)):K.current.scale.set(1/L.scale[0],1/L.scale[1],1/L.scale[2]):K.current.scale.setScalar(1/L.scale));else{let t=(w||10)/400,r=e.clientWidth*t,n=e.clientHeight*t;K.current.scale.set(r,n,1)}Q.current=!0}}}else{let t=U.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){let e=1/O.factor,r=t.clientWidth*e,n=t.clientHeight*e;K.current.scale.set(r,n,1),Q.current=!0}K.current.lookAt(e.camera.position)}});let ei=a.useMemo(()=>({vertexShader:j?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[j]);return a.createElement("group",(0,l.A)({},L,{ref:B}),P&&!ee&&a.createElement("mesh",{castShadow:E,receiveShadow:R,ref:K},k||a.createElement("planeGeometry",null),T||a.createElement("shaderMaterial",{side:o.$EB,vertexShader:ei.vertexShader,fragmentShader:ei.fragmentShader})))})},15697(e){var t;(t=function(){function e(e){return i.appendChild(e.dom),e}function r(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";n=e}var n=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(e){e.preventDefault(),r(++n%i.children.length)},!1);var l=(performance||Date).now(),a=l,s=0,o=e(new t.Panel("FPS","#0ff","#002")),c=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=e(new t.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:i,addPanel:e,showPanel:r,begin:function(){l=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-l,200),e>a+1e3&&(o.update(1e3*s/(e-a),100),a=e,s=0,d)){var t=performance.memory;d.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){l=this.end()},domElement:i,setMode:r}}).Panel=function(e,t,r){var n=1/0,i=0,l=Math.round,a=l(window.devicePixelRatio||1),s=80*a,o=48*a,c=3*a,d=2*a,u=3*a,h=15*a,f=74*a,m=30*a,p=document.createElement("canvas");p.width=s,p.height=o,p.style.cssText="width:80px;height:48px";var x=p.getContext("2d");return x.font="bold "+9*a+"px Helvetica,Arial,sans-serif",x.textBaseline="top",x.fillStyle=r,x.fillRect(0,0,s,o),x.fillStyle=t,x.fillText(e,c,d),x.fillRect(u,h,f,m),x.fillStyle=r,x.globalAlpha=.9,x.fillRect(u,h,f,m),{dom:p,update:function(o,v){n=Math.min(n,o),i=Math.max(i,o),x.fillStyle=r,x.globalAlpha=1,x.fillRect(0,0,s,h),x.fillStyle=t,x.fillText(l(o)+" "+e+" ("+l(n)+"-"+l(i)+")",c,d),x.drawImage(p,u+a,h,f-a,m,u,h,f-a,m),x.fillRect(u+f-a,h,a,m),x.fillStyle=r,x.globalAlpha=.9,x.fillRect(u+f-a,h,a,l((1-o/v)*m))}}},e.exports=t}}]);