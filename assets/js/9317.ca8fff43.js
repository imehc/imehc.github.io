"use strict";(self.webpackChunkanch=self.webpackChunkanch||[]).push([["9317"],{76500(e,t,i){i.d(t,{initViewer:()=>O});var s=i(77359),n=i(88708),r=i(68654),o=i(52890),a=i(67357),l=i(99600),h=i(11989),d=i(22661),c=i(97168),A=i(88381),u=i(6963),g=i(15424),p=i(28693),f=i(31634),w=i(23751),m=i(89926),C=i(60694),v=i(33107),D=i(46757),y=i(49441),I=i(38582),_=i(31176),M=i(49779),T=i(56644),b=i(39892),L=i(65056),E=i(52155);let P=class{viewer;terrainProvider;handler=null;measureIds=[];bMeasuring=!1;onMeasureStart;onMeasureEnd;constructor(e){this.viewer=e.viewer,this.terrainProvider=e.terrainProvider,this.onMeasureStart=e.onMeasureStart,this.onMeasureEnd=e.onMeasureEnd}measureLineSpace(){this.bMeasuring=!0,this.onMeasureStart?.();let e=[],t=null,i=0;this.handler=new A.A(this.viewer.scene.canvas),this.handler.setInputAction(i=>{let s=this.viewer.scene.pickPosition(i.endPosition);if(!s){let e=this.viewer.camera.getPickRay(i.endPosition);e&&(s=this.viewer.scene.globe.pick(e,this.viewer.scene))}s&&e.length>=2&&(t?(e.pop(),e.push(s)):t=this.createPolyline(e,u.A.CHARTREUSE,2))},a.A.MOUSE_MOVE),this.handler.setInputAction(t=>{let s=this.viewer.scene.pickPosition(t.position);if(!s){let e=this.viewer.camera.getPickRay(t.position);e&&(s=this.viewer.scene.globe.pick(e,this.viewer.scene))}if(s){0===e.length&&e.push(s.clone()),e.push(s);let t=Number.parseFloat(this.getSpaceDistance(e)),n=((i+=t)>1e3?`${(i/1e3).toFixed(3)}\u{5343}\u{7C73}`:`${i.toFixed(2)}\u{7C73}`)+`
(+${t>1e3?`${(t/1e3).toFixed(3)}\u{5343}\u{7C73}`:`${t.toFixed(2)}\u{7C73}`})`,r=this.viewer.entities.add({name:"\u7A7A\u95F4\u76F4\u7EBF\u8DDD\u79BB",position:e[e.length-1],point:{pixelSize:5,color:u.A.RED,outlineColor:u.A.WHITE,outlineWidth:2,heightReference:g.Ay.NONE},label:{text:n,font:"18px sans-serif",fillColor:u.A.CHARTREUSE,style:p.A.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:f.A.BOTTOM,pixelOffset:new w.A(20,-20),disableDepthTestDistance:1/0,heightReference:g.Ay.NONE}});this.measureIds.push(r.id)}},a.A.LEFT_CLICK),this.handler.setInputAction(()=>{this.finishMeasure()},a.A.RIGHT_CLICK)}measureGroundDistance(){this.bMeasuring=!0,this.onMeasureStart?.(),this.viewer.scene.globe.depthTestAgainstTerrain=!0;let e=[],t=null;this.handler=new A.A(this.viewer.scene.canvas),this.handler.setInputAction(i=>{let s=this.viewer.scene.pickPosition(i.endPosition);if(!s){let e=this.viewer.camera.getPickRay(i.endPosition);e&&(s=this.viewer.scene.globe.pick(e,this.viewer.scene))}if(s){let i=m.A.fromCartesian(s);i.height=this.viewer.scene.sampleHeight(i),s=this.viewer.scene.globe.ellipsoid.cartographicToCartesian(i),e.length>=2&&(t?(e.pop(),e.push(s)):t=this.createGroundPolyline(e))}},a.A.MOUSE_MOVE),this.handler.setInputAction(t=>{let i=this.viewer.scene.pickPosition(t.position);if(!i){let e=this.viewer.camera.getPickRay(t.position);e&&(i=this.viewer.scene.globe.pick(e,this.viewer.scene))}if(i){let t=m.A.fromCartesian(i);t.height=this.viewer.scene.sampleHeight(t),i=this.viewer.scene.globe.ellipsoid.cartographicToCartesian(t),0===e.length&&e.push(i.clone()),e.push(i),this.calculateGroundDistance(e,0)}},a.A.LEFT_CLICK),this.handler.setInputAction(()=>{this.finishMeasure()},a.A.RIGHT_CLICK)}createPolyline(e,t,i){let s=this.viewer.entities.add({name:"\u76F4\u7EBF",polyline:{show:!0,positions:new C.A(()=>e,!1),arcType:v.A.NONE,material:t,width:i}});return this.measureIds.push(s.id),s}createGroundPolyline(e){let t=this.viewer.entities.add({name:"\u76F4\u7EBF",polyline:{show:!0,positions:new C.A(()=>e,!1),material:u.A.GOLD,width:2,clampToGround:!0}});return this.measureIds.push(t.id),t}getSpaceDistance(e){let t=0;if(e.length>2){let i=m.A.fromCartesian(e[e.length-3]),s=m.A.fromCartesian(e[e.length-2]),n=new D.A;n.setEndPoints(i,s),t=Math.sqrt(n.surfaceDistance**2+(s.height-i.height)**2)}return t.toFixed(2)}calculateGroundDistance(e,t){if(e.length>2){let i=[],s=m.A.fromCartesian(e[e.length-3]),n=m.A.fromCartesian(e[e.length-2]),r=new D.A;r.setEndPoints(s,n);let o=r.surfaceDistance;i.push(s);let a=Math.floor(o/100);a=(a=a>200?200:a)<20?20:a;for(let e=1;e<a;e++){let t=r.interpolateUsingSurfaceDistance(o/a*e,new m.A);t.height=this.viewer.scene.sampleHeight(t),i.push(t)}i.push(n);let l=0;for(let e=0;e<i.length-1;e++)r.setEndPoints(i[e],i[e+1]),l+=Math.sqrt(r.surfaceDistance**2+(i[e+1].height-i[e].height)**2);let h=((t+=l)>1e3?`${(t/1e3).toFixed(3)}\u{5343}\u{7C73}`:`${t.toFixed(2)}\u{7C73}`)+`
(+${l>1e3?`${(l/1e3).toFixed(3)}\u{5343}\u{7C73}`:`${l.toFixed(2)}\u{7C73}`})`,d=this.viewer.entities.add({name:"\u5730\u8868\u8DDD\u79BB",position:e[e.length-1],point:{pixelSize:5,color:u.A.RED,outlineColor:u.A.WHITE,outlineWidth:2},label:{text:h,font:"18px sans-serif",fillColor:u.A.GOLD,style:p.A.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:f.A.BOTTOM,disableDepthTestDistance:1/0,pixelOffset:new w.A(20,-20)}});this.measureIds.push(d.id)}}finishMeasure(){this.handler&&!this.handler.isDestroyed()&&(this.handler.destroy(),this.handler=null),this.bMeasuring=!1,this.onMeasureEnd?.()}clear(){for(let e of this.measureIds)this.viewer.entities.removeById(e);this.measureIds.length=0,this.handler&&!this.handler.isDestroyed()&&(this.handler.destroy(),this.handler=null),this.bMeasuring=!1,this.onMeasureEnd?.()}measureAreaSpace(){this.bMeasuring=!0,this.onMeasureStart?.();let e=[],t=[],i=null;this.handler=new A.A(this.viewer.scene.canvas),this.handler.setInputAction(t=>{let s=this.viewer.scene.pickPosition(t.endPosition);if(!s){let e=this.viewer.camera.getPickRay(t.endPosition);e&&(s=this.viewer.scene.globe.pick(e,this.viewer.scene))}s&&e.length>=2&&(i?(e.pop(),e.push(s)):i=this.createPolygon(e))},a.A.MOUSE_MOVE),this.handler.setInputAction(i=>{let s=this.viewer.scene.pickPosition(i.position);if(!s){let e=this.viewer.camera.getPickRay(i.position);e&&(s=this.viewer.scene.globe.pick(e,this.viewer.scene))}if(s){0===e.length&&e.push(s.clone()),e.push(s);let i=m.A.fromCartesian(e[e.length-1]),n=h.A.toDegrees(i.longitude),r=h.A.toDegrees(i.latitude),o=i.height;t.push({lon:n,lat:r,hei:o});let a=this.viewer.entities.add({name:"\u591A\u8FB9\u5F62\u9762\u79EF",position:e[e.length-1],point:{pixelSize:3,color:u.A.RED,outlineColor:u.A.WHITE,outlineWidth:2,heightReference:g.Ay.CLAMP_TO_GROUND}});this.measureIds.push(a.id)}},a.A.LEFT_CLICK),this.handler.setInputAction(()=>{let i;this.handler&&!this.handler.isDestroyed()&&(this.handler.destroy(),this.handler=null),e.pop();let s=this.getArea(t,e);i=s<.001?`${(1e6*s).toFixed(4)}\u{5E73}\u{65B9}\u{7C73}`:`${s.toFixed(4)}\u{5E73}\u{65B9}\u{516C}\u{91CC}`;let n=this.viewer.entities.add({name:"\u591A\u8FB9\u5F62\u9762\u79EF",position:e[e.length-1],label:{text:i,font:"18px sans-serif",fillColor:u.A.CYAN,style:p.A.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:f.A.BOTTOM,pixelOffset:new w.A(20,-40),disableDepthTestDistance:1/0,heightReference:g.Ay.CLAMP_TO_GROUND}});this.measureIds.push(n.id),this.bMeasuring=!1,this.onMeasureEnd?.()},a.A.RIGHT_CLICK)}measureAltitude(){let e,t,i;this.bMeasuring=!0,this.onMeasureStart?.();let s=[],n=0;this.handler=new A.A(this.viewer.scene.canvas),this.handler.setInputAction(r=>{let o=this.viewer.scene.pickPosition(r.endPosition);if(!o){let e=this.viewer.camera.getPickRay(r.endPosition);e&&(o=this.viewer.scene.globe.pick(e,this.viewer.scene))}if(o&&1===n){let n=m.A.fromCartesian(o),r=h.A.toDegrees(n.longitude),a=h.A.toDegrees(n.latitude),l=n.height;s.length=3,s.push(r,a,l);let d=this.drawAltitudeTriangle(s,e,t,i);e=d.Line1,t=d.Line2,i=d.H}},a.A.MOUSE_MOVE),this.handler.setInputAction(r=>{let o=this.viewer.scene.pickPosition(r.position);if(!o){let e=this.viewer.camera.getPickRay(r.position);e&&(o=this.viewer.scene.globe.pick(e,this.viewer.scene))}if(o){let r=m.A.fromCartesian(o),a=h.A.toDegrees(r.longitude),l=h.A.toDegrees(r.latitude),d=r.height,c=this.viewer.entities.add({name:"\u9AD8\u5EA6\u5DEE",position:o,point:{pixelSize:3,color:u.A.RED,outlineColor:u.A.WHITE,outlineWidth:2,heightReference:g.Ay.CLAMP_TO_GROUND}});if(this.measureIds.push(c.id),1==++n)s.push(a,l,d);else{s.length=3,s.push(a,l,d),this.finishMeasure();let n=this.drawAltitudeTriangle(s,e,t,i);e=n.Line1,t=n.Line2,i=n.H}}},a.A.LEFT_CLICK),this.handler.setInputAction(()=>{this.finishMeasure()},a.A.RIGHT_CLICK)}measureTriangle(){let e,t,i,s;this.bMeasuring=!0,this.onMeasureStart?.();let n=[],r=0;this.handler=new A.A(this.viewer.scene.canvas),this.handler.setInputAction(o=>{let a=this.viewer.scene.pickPosition(o.endPosition);if(!a){let e=this.viewer.camera.getPickRay(o.endPosition);e&&(a=this.viewer.scene.globe.pick(e,this.viewer.scene))}if(a&&1===r){let r=m.A.fromCartesian(a),o=h.A.toDegrees(r.longitude),l=h.A.toDegrees(r.latitude),d=r.height;n.length=3,n.push(o,l,d);let c=this.drawTriangle(n,e,t,i,s);e=c.XLine,t=c.X,i=c.Y,s=c.H}},a.A.MOUSE_MOVE),this.handler.setInputAction(o=>{let a=this.viewer.scene.pickPosition(o.position);if(!a){let e=this.viewer.camera.getPickRay(o.position);e&&(a=this.viewer.scene.globe.pick(e,this.viewer.scene))}if(a){let o=m.A.fromCartesian(a),l=h.A.toDegrees(o.longitude),d=h.A.toDegrees(o.latitude),c=o.height,A=this.viewer.entities.add({name:"\u4E09\u89D2\u6D4B\u91CF",position:a,point:{pixelSize:3,color:u.A.RED,outlineColor:u.A.WHITE,outlineWidth:2,heightReference:g.Ay.CLAMP_TO_GROUND}});if(this.measureIds.push(A.id),1==++r)n.push(l,d,c);else{n.length=3,n.push(l,d,c),this.finishMeasure();let r=this.drawTriangle(n,e,t,i,s);e=r.XLine,t=r.X,i=r.Y,s=r.H}}},a.A.LEFT_CLICK),this.handler.setInputAction(()=>{this.finishMeasure()},a.A.RIGHT_CLICK)}measureAngle(){let e,t,i;this.bMeasuring=!0,this.onMeasureStart?.();let s=[],n=0;this.handler=new A.A(this.viewer.scene.canvas),this.handler.setInputAction(r=>{let o=this.viewer.scene.pickPosition(r.endPosition);if(!o){let e=this.viewer.camera.getPickRay(r.endPosition);e&&(o=this.viewer.scene.globe.pick(e,this.viewer.scene))}if(o&&1===n){s.length=1,s.push(o);let n=this.drawAngle(s,e,t,i);e=n.Line1,t=n.Line2,i=n.angleT}},a.A.MOUSE_MOVE),this.handler.setInputAction(r=>{let o=this.viewer.scene.pickPosition(r.position);if(!o){let e=this.viewer.camera.getPickRay(r.position);e&&(o=this.viewer.scene.globe.pick(e,this.viewer.scene))}if(o)if(1==++n){s.push(o);let e=this.viewer.entities.add({name:"\u65B9\u4F4D\u89D2",position:o,point:{pixelSize:3,color:u.A.RED,outlineColor:u.A.WHITE,outlineWidth:2,heightReference:g.Ay.CLAMP_TO_GROUND}});this.measureIds.push(e.id)}else{s.length=1,s.push(o),this.finishMeasure();let n=this.drawAngle(s,e,t,i);e=n.Line1,t=n.Line2,i=n.angleT}},a.A.LEFT_CLICK),this.handler.setInputAction(()=>{this.finishMeasure()},a.A.RIGHT_CLICK)}isMeasuring(){return this.bMeasuring}createPolygon(e){let t=this.viewer.entities.add({name:"\u591A\u8FB9\u5F62",polygon:{hierarchy:new C.A(()=>({positions:e}),!1),material:u.A.DARKTURQUOISE.withAlpha(.4),outline:!0,outlineColor:u.A.CYAN.withAlpha(.8)}});return this.measureIds.push(t.id),t}getArea(e,t){let i=Math.PI/180,s=180/Math.PI,n=0;for(let r=0;r<e.length-2;r++){let o=(r+1)%e.length,a=(r+2)%e.length,l=this.calculateAngle(e[r],e[o],e[a],i,s);n+=this.calculateDistance(t[r],t[o])*this.calculateDistance(t[o],t[a])*Math.abs(Math.sin(l))}return n/1e6}calculateAngle(e,t,i,s,n){let r=this.calculateBearing(t,e,s,n)-this.calculateBearing(t,i,s,n);return r<0&&(r+=360),r}calculateBearing(e,t,i,s){let n=e.lat*i,r=e.lon*i,o=t.lat*i,a=t.lon*i,l=-Math.atan2(Math.sin(r-a)*Math.cos(o),Math.cos(n)*Math.sin(o)-Math.sin(n)*Math.cos(o)*Math.cos(r-a));return l<0&&(l+=2*Math.PI),l*=s}calculateDistance(e,t){let i=m.A.fromCartesian(e),s=m.A.fromCartesian(t),n=new D.A;return n.setEndPoints(i,s),Math.sqrt(n.surfaceDistance**2+(s.height-i.height)**2)}drawAltitudeTriangle(e,t,i,s){if(t&&i&&s){t.polyline&&(t.polyline.positions=new y.A(e[5]>e[2]?l.A.fromDegreesArrayHeights([e[0],e[1],e[5],e[0],e[1],e[2]]):l.A.fromDegreesArrayHeights([e[3],e[4],e[2],e[3],e[4],e[5]]))),i.polyline&&(i.polyline.positions=new y.A(e[5]>e[2]?l.A.fromDegreesArrayHeights([e[0],e[1],e[5],e[3],e[4],e[5]]):l.A.fromDegreesArrayHeights([e[3],e[4],e[2],e[0],e[1],e[2]])));let n=Math.abs(e[2]-e[5]).toFixed(2);return s.position=new I.A(e[5]>e[2]?l.A.fromDegrees(e[0],e[1],(e[2]+e[5])/2):l.A.fromDegrees(e[3],e[4],(e[2]+e[5])/2)),s.label&&(s.label.text=new y.A(`\u{9AD8}\u{5EA6}\u{5DEE}:${n}\u{7C73}`)),{Line1:t,Line2:i,H:s}}t=this.viewer.entities.add({name:"triangleLine",polyline:{positions:e[5]>e[2]?l.A.fromDegreesArrayHeights([e[0],e[1],e[5],e[0],e[1],e[2]]):l.A.fromDegreesArrayHeights([e[3],e[4],e[2],e[3],e[4],e[5]]),arcType:v.A.NONE,width:2,material:new _.A({color:u.A.CHARTREUSE}),depthFailMaterial:new _.A({color:u.A.RED})}}),this.measureIds.push(t.id),i=this.viewer.entities.add({name:"triangleLine",polyline:{positions:e[5]>e[2]?l.A.fromDegreesArrayHeights([e[0],e[1],e[5],e[3],e[4],e[5]]):l.A.fromDegreesArrayHeights([e[3],e[4],e[2],e[0],e[1],e[2]]),arcType:v.A.NONE,width:2,material:new M.A({color:u.A.CHARTREUSE}),depthFailMaterial:new M.A({color:u.A.RED})}}),this.measureIds.push(i.id);let n=Math.abs(e[2]-e[5]).toFixed(2);return s=this.viewer.entities.add({name:"lineZ",position:e[5]>e[2]?l.A.fromDegrees(e[0],e[1],(e[2]+e[5])/2):l.A.fromDegrees(e[3],e[4],(e[2]+e[5])/2),label:{text:`\u{9AD8}\u{5EA6}\u{5DEE}:${n}\u{7C73}`,translucencyByDistance:new T.A(150,2,15e4,0),font:"45px \u6977\u4F53",fillColor:u.A.WHITE,outlineColor:u.A.BLACK,style:p.A.FILL_AND_OUTLINE,outlineWidth:3,disableDepthTestDistance:1/0,scale:.5,pixelOffset:new w.A(0,-10),backgroundColor:u.A.fromCssColorString("rgba(0, 0, 0, 0.7)"),backgroundPadding:new w.A(10,10),verticalOrigin:f.A.BOTTOM}}),this.measureIds.push(s.id),{Line1:t,Line2:i,H:s}}drawTriangle(e,t,i,s,n){if(t&&i&&s&&n){t.polyline&&(t.polyline.positions=new y.A(e[5]>e[2]?l.A.fromDegreesArrayHeights([e[0],e[1],e[2],e[0],e[1],e[5],e[3],e[4],e[5],e[0],e[1],e[2]]):l.A.fromDegreesArrayHeights([e[0],e[1],e[2],e[3],e[4],e[5],e[3],e[4],e[2],e[0],e[1],e[2]])));let r=l.A.distance(l.A.fromDegrees(e[0],e[1]),l.A.fromDegrees(e[3],e[4])).toFixed(2),o=Math.abs(e[2]-e[5]).toFixed(2),a=Math.sqrt(Number.parseFloat(r)**2+Number.parseFloat(o)**2).toFixed(2);return i.position=new I.A(l.A.fromDegrees((e[0]+e[3])/2,(e[1]+e[4])/2,Math.max(e[2],e[5]))),n.position=new I.A(e[5]>e[2]?l.A.fromDegrees(e[0],e[1],(e[2]+e[5])/2):l.A.fromDegrees(e[3],e[4],(e[2]+e[5])/2)),s.position=new I.A(l.A.fromDegrees((e[0]+e[3])/2,(e[1]+e[4])/2,(e[2]+e[5])/2)),i.label&&(i.label.text=new y.A(`\u{6C34}\u{5E73}\u{8DDD}\u{79BB}:${r}\u{7C73}`)),n.label&&(n.label.text=new y.A(`\u{9AD8}\u{5EA6}\u{5DEE}:${o}\u{7C73}`)),s.label&&(s.label.text=new y.A(`\u{7A7A}\u{95F4}\u{8DDD}\u{79BB}:${a}\u{7C73}`)),{XLine:t,X:i,Y:s,H:n}}t=this.viewer.entities.add({name:"triangleLine",polyline:{positions:e[5]>e[2]?l.A.fromDegreesArrayHeights([e[0],e[1],e[2],e[0],e[1],e[5],e[3],e[4],e[5],e[0],e[1],e[2]]):l.A.fromDegreesArrayHeights([e[0],e[1],e[2],e[3],e[4],e[5],e[3],e[4],e[2],e[0],e[1],e[2]]),arcType:v.A.NONE,width:2,material:new _.A({color:u.A.YELLOW}),depthFailMaterial:new _.A({color:u.A.RED})}}),this.measureIds.push(t.id);let r=l.A.distance(l.A.fromDegrees(e[0],e[1]),l.A.fromDegrees(e[3],e[4])).toFixed(2),o=Math.abs(e[2]-e[5]).toFixed(2),a=Math.sqrt(Number.parseFloat(r)**2+Number.parseFloat(o)**2).toFixed(2);return i=this.viewer.entities.add({name:"lineX",position:l.A.fromDegrees((e[0]+e[3])/2,(e[1]+e[4])/2,Math.max(e[2],e[5])),label:{text:`\u{6C34}\u{5E73}\u{8DDD}\u{79BB}:${r}\u{7C73}`,translucencyByDistance:new T.A(150,2,15e4,0),font:"45px \u6977\u4F53",fillColor:u.A.WHITE,outlineColor:u.A.BLACK,style:p.A.FILL_AND_OUTLINE,outlineWidth:3,disableDepthTestDistance:1/0,scale:.5,pixelOffset:new w.A(0,-10),backgroundColor:u.A.fromCssColorString("rgba(0, 0, 0, 0.7)"),backgroundPadding:new w.A(10,10),verticalOrigin:f.A.BOTTOM}}),this.measureIds.push(i.id),n=this.viewer.entities.add({name:"lineZ",position:e[5]>e[2]?l.A.fromDegrees(e[0],e[1],(e[2]+e[5])/2):l.A.fromDegrees(e[3],e[4],(e[2]+e[5])/2),label:{text:`\u{9AD8}\u{5EA6}\u{5DEE}:${o}\u{7C73}`,translucencyByDistance:new T.A(150,2,15e4,0),font:"45px \u6977\u4F53",fillColor:u.A.WHITE,outlineColor:u.A.BLACK,style:p.A.FILL_AND_OUTLINE,outlineWidth:3,disableDepthTestDistance:1/0,scale:.5,pixelOffset:new w.A(0,-10),backgroundColor:u.A.fromCssColorString("rgba(0, 0, 0, 0.7)"),backgroundPadding:new w.A(10,10),verticalOrigin:f.A.BOTTOM}}),this.measureIds.push(n.id),s=this.viewer.entities.add({name:"lineY",position:l.A.fromDegrees((e[0]+e[3])/2,(e[1]+e[4])/2,(e[2]+e[5])/2),label:{text:`\u{7A7A}\u{95F4}\u{8DDD}\u{79BB}:${a}\u{7C73}`,translucencyByDistance:new T.A(150,2,15e4,0),font:"45px \u6977\u4F53",fillColor:u.A.WHITE,outlineColor:u.A.BLACK,style:p.A.FILL_AND_OUTLINE,outlineWidth:3,disableDepthTestDistance:1/0,scale:.5,pixelOffset:new w.A(0,-10),backgroundColor:u.A.fromCssColorString("rgba(0, 0, 0, 0.7)"),backgroundPadding:new w.A(10,10),verticalOrigin:f.A.BOTTOM}}),this.measureIds.push(s.id),{XLine:t,X:i,Y:s,H:n}}drawAngle(e,t,i,s){let n=m.A.fromCartesian(e[0]),r=h.A.toDegrees(n.longitude),o=h.A.toDegrees(n.latitude),a=m.A.fromCartesian(e[1]),d=h.A.toDegrees(a.longitude),c=h.A.toDegrees(a.latitude),A=l.A.distance(l.A.fromDegrees(r,o),l.A.fromDegrees(d,c)),g=b.A.eastNorthUpToFixedFrame(l.A.fromDegrees(r,o)),C=m.A.fromCartesian(L.A.multiplyByPoint(g,l.A.fromElements(0,A,0),new l.A)),v=h.A.toDegrees(C.longitude),D=h.A.toDegrees(C.latitude),_=this.courseAngle(r,o,d,c),P=A>1e3?`${(A/1e3).toFixed(3)}\u{5343}\u{7C73}`:`${A.toFixed(2)}\u{7C73}`;return t&&i&&s?(t.polyline&&(t.polyline.positions=new y.A(l.A.fromDegreesArray([r,o,v,D]))),i.polyline&&(i.polyline.positions=new y.A(l.A.fromDegreesArray([r,o,d,c]))),s.label&&(s.label.text=new y.A(`\u{89D2}\u{5EA6}:${_}\xb0
\u{8DDD}\u{79BB}:${P}`)),s.position=new I.A(e[1])):(t=this.viewer.entities.add({name:"Angle1",polyline:{positions:new y.A(l.A.fromDegreesArray([r,o,v,D])),width:3,material:new M.A({color:u.A.RED}),clampToGround:!0}}),this.measureIds.push(t.id),i=this.viewer.entities.add({name:"Angle2",polyline:{positions:new y.A(l.A.fromDegreesArray([r,o,d,c])),width:10,material:new E.A(u.A.YELLOW),clampToGround:!0}}),this.measureIds.push(i.id),s=this.viewer.entities.add({name:"AngleT",position:e[1],label:{text:`\u{89D2}\u{5EA6}:${_}\xb0
\u{8DDD}\u{79BB}:${P}`,translucencyByDistance:new T.A(150,2,15e4,0),font:"45px \u6977\u4F53",fillColor:u.A.WHITE,outlineColor:u.A.BLACK,style:p.A.FILL_AND_OUTLINE,outlineWidth:4,scale:.5,pixelOffset:new w.A(0,-40),disableDepthTestDistance:1/0,backgroundColor:u.A.fromCssColorString("rgba(0, 0, 0, 1)"),backgroundPadding:new w.A(10,10),verticalOrigin:f.A.BASELINE}}),this.measureIds.push(s.id)),{Line1:t,Line2:i,angleT:s}}courseAngle(e,t,i,s){let n=Math.atan2(Math.abs(e-i),Math.abs(t-s));return i>=e?s<t&&(n=Math.PI-n):n=s>=t?2*Math.PI-n:Math.PI+n,Math.floor(100*(n=180*n/Math.PI))/100}};function O(e){let t=new s.A(e,{baseLayerPicker:!1,animation:!1,timeline:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,navigationHelpButton:!1});t.scene.debugShowFramesPerSecond=!0,t.imageryLayers.remove(t.imageryLayers.get(0)),t.scene.terrainProvider=new n.A({}),t.scene.globe.depthTestAgainstTerrain=!0;let i=new r.A({url:"//data.mars3d.cn/tile/img/{z}/{x}/{y}.jpg"});t.imageryLayers.addImageryProvider(i),o.A.fromUrl("//data.mars3d.cn/terrain",{requestWaterMask:!0,requestVertexNormals:!0}).then(e=>{t.scene.terrainProvider=e,console.log("\u5730\u5F62\u52A0\u8F7D\u6210\u529F")}).catch(e=>{console.error("\u52A0\u8F7D\u5730\u5F62\u5931\u8D25:",e)}),t.cesiumWidget.screenSpaceEventHandler.removeInputAction(a.A.LEFT_CLICK),t.cesiumWidget.screenSpaceEventHandler.removeInputAction(a.A.LEFT_DOUBLE_CLICK),new d.A(t,{enableCompass:!0,enableZoomControls:!0}),t.camera.setView({destination:l.A.fromDegrees(98.685331,27.780325,7318.6),orientation:{heading:h.A.toRadians(73),pitch:h.A.toRadians(-52.2),roll:0}});let A=new P({viewer:t,onMeasureStart:()=>{t.container.style.cursor="crosshair"},onMeasureEnd:()=>{t.container.style.cursor=""}}),u=new c.GUI;u.domElement.style.position="fixed",u.domElement.style.top="50%",u.domElement.style.transform="translateY(-50%)",u.domElement.style.left="0";let g={\u7A7A\u95F4\u8DDD\u79BB:()=>{A.measureLineSpace()},\u5730\u8868\u8DDD\u79BB:()=>{A.measureGroundDistance()},\u5730\u8868\u9762\u79EF:()=>{A.measureAreaSpace()},\u9AD8\u5EA6\u5DEE:()=>{A.measureAltitude()},\u4E09\u89D2\u6D4B\u91CF:()=>{A.measureTriangle()},\u65B9\u4F4D\u89D2:()=>{A.measureAngle()},\u6E05\u9664\u7ED3\u679C:()=>{A.clear()}},p=u.addFolder("\u6D4B\u91CF\u5DE5\u5177");return p.add(g,"\u7A7A\u95F4\u8DDD\u79BB"),p.add(g,"\u5730\u8868\u8DDD\u79BB"),p.add(g,"\u5730\u8868\u9762\u79EF"),p.add(g,"\u9AD8\u5EA6\u5DEE"),p.add(g,"\u4E09\u89D2\u6D4B\u91CF"),p.add(g,"\u65B9\u4F4D\u89D2"),p.add(g,"\u6E05\u9664\u7ED3\u679C"),p.open(),console.log("\u7A7A\u95F4\u6D4B\u91CF\u5DE5\u5177\u5DF2\u52A0\u8F7D"),console.log("\u63D0\u793A\uFF1A\u5DE6\u952E\u70B9\u51FB\u5F00\u59CB\u6D4B\u91CF\uFF0C\u53F3\u952E\u7ED3\u675F\u6D4B\u91CF"),{viewer:t,gui:u,cleanup:()=>{A.clear()}}}},52155(e,t,i){i.d(t,{A:()=>c});var s=i(6963),n=i(89466),r=i(91395),o=i(52934),a=i(14492),l=i(21509);function h(e){this._definitionChanged=new r.A,this._color=void 0,this._colorSubscription=void 0,this.color=e}Object.defineProperties(h.prototype,{isConstant:{get:function(){return l.A.isConstant(this._color)}},definitionChanged:{get:function(){return this._definitionChanged}},color:(0,a.A)("color")}),h.prototype.getType=function(e){return"PolylineArrow"};let d=new o.A;h.prototype.getValue=function(e,t){return(0,n.A)(e)||(e=o.A.now(d)),(0,n.A)(t)||(t={}),t.color=l.A.getValueOrClonedDefault(this._color,e,s.A.WHITE,t.color),t},h.prototype.equals=function(e){return this===e||e instanceof h&&l.A.equals(this._color,e._color)};let c=h},49779(e,t,i){i.d(t,{A:()=>g});var s=i(6963),n=i(24089),r=i(89466),o=i(91395),a=i(52934),l=i(14492),h=i(21509);let d=s.A.WHITE,c=s.A.TRANSPARENT;function A(e){e=e??n.A.EMPTY_OBJECT,this._definitionChanged=new o.A,this._color=void 0,this._colorSubscription=void 0,this._gapColor=void 0,this._gapColorSubscription=void 0,this._dashLength=void 0,this._dashLengthSubscription=void 0,this._dashPattern=void 0,this._dashPatternSubscription=void 0,this.color=e.color,this.gapColor=e.gapColor,this.dashLength=e.dashLength,this.dashPattern=e.dashPattern}Object.defineProperties(A.prototype,{isConstant:{get:function(){return h.A.isConstant(this._color)&&h.A.isConstant(this._gapColor)&&h.A.isConstant(this._dashLength)&&h.A.isConstant(this._dashPattern)}},definitionChanged:{get:function(){return this._definitionChanged}},color:(0,l.A)("color"),gapColor:(0,l.A)("gapColor"),dashLength:(0,l.A)("dashLength"),dashPattern:(0,l.A)("dashPattern")}),A.prototype.getType=function(e){return"PolylineDash"};let u=new a.A;A.prototype.getValue=function(e,t){return(0,r.A)(e)||(e=a.A.now(u)),(0,r.A)(t)||(t={}),t.color=h.A.getValueOrClonedDefault(this._color,e,d,t.color),t.gapColor=h.A.getValueOrClonedDefault(this._gapColor,e,c,t.gapColor),t.dashLength=h.A.getValueOrDefault(this._dashLength,e,16,t.dashLength),t.dashPattern=h.A.getValueOrDefault(this._dashPattern,e,255,t.dashPattern),t},A.prototype.equals=function(e){return this===e||e instanceof A&&h.A.equals(this._color,e._color)&&h.A.equals(this._gapColor,e._gapColor)&&h.A.equals(this._dashLength,e._dashLength)&&h.A.equals(this._dashPattern,e._dashPattern)};let g=A},31176(e,t,i){i.d(t,{A:()=>g});var s=i(6963),n=i(24089),r=i(89466),o=i(91395),a=i(52934),l=i(14492),h=i(21509);let d=s.A.WHITE,c=s.A.BLACK;function A(e){e=e??n.A.EMPTY_OBJECT,this._definitionChanged=new o.A,this._color=void 0,this._colorSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this.color=e.color,this.outlineColor=e.outlineColor,this.outlineWidth=e.outlineWidth}Object.defineProperties(A.prototype,{isConstant:{get:function(){return h.A.isConstant(this._color)&&h.A.isConstant(this._outlineColor)&&h.A.isConstant(this._outlineWidth)}},definitionChanged:{get:function(){return this._definitionChanged}},color:(0,l.A)("color"),outlineColor:(0,l.A)("outlineColor"),outlineWidth:(0,l.A)("outlineWidth")}),A.prototype.getType=function(e){return"PolylineOutline"};let u=new a.A;A.prototype.getValue=function(e,t){return(0,r.A)(e)||(e=a.A.now(u)),(0,r.A)(t)||(t={}),t.color=h.A.getValueOrClonedDefault(this._color,e,d,t.color),t.outlineColor=h.A.getValueOrClonedDefault(this._outlineColor,e,c,t.outlineColor),t.outlineWidth=h.A.getValueOrDefault(this._outlineWidth,e,1),t},A.prototype.equals=function(e){return this===e||e instanceof A&&h.A.equals(this._color,e._color)&&h.A.equals(this._outlineColor,e._outlineColor)&&h.A.equals(this._outlineWidth,e._outlineWidth)};let g=A}}]);