"use strict";(self.webpackChunkanch=self.webpackChunkanch||[]).push([["9468"],{68695(e,t,r){let i,n;r.d(t,{initViewer:()=>P});var a=r(38279),o=r(30571),s=r(7487),l=r(81509),h=r(53526),g=r(22831),d=r(77329),u=r(22661),c=r(97168),y=r(2312),p=r(90909),m=r(48251),f=r(24115),w=r(61456),x=r(32777),A=r(25676),b=r(79651),H=r(12002),v=r(91343),C=r(38501);let E={isNumber:e=>"number"==typeof e&&e.constructor===Number,isString:e=>"string"==typeof e&&e.constructor===String,extend:(e,...t)=>{for(let r of t)if(r){for(let t in r)if(Object.hasOwn(r,t)){if("caller"===t||"callee"===t||"length"===t||"arguments"===t)continue;e[t]=r[t]}}return e},getRequest:()=>{let e=location.search,t={};if(-1!==e.indexOf("?")){let r=e.substring(1).split("&");for(let e=0;e<r.length;e++)t[r[e].split("=")[0]]=decodeURI(r[e].split("=")[1])}return t},getRequestByName:e=>{let t=RegExp(`(^|&)${e}=([^&]*)(&|$)`,"i"),r=window.location.search.substring(1).match(t);return null!=r?decodeURI(r[2]):null},clone:e=>{if(null==e||"object"!=typeof e)return e;if(e instanceof Date){let t=new Date;return t.setTime(e.getTime()),t}if(Array.isArray(e)){let t=[];for(let r=0,i=e.length;r<i;++r)t[r]=(0,f.A)(e[r]);return t}if("object"==typeof e){let t={};for(let r in e)"_layer"!==r&&"_layers"!==r&&"_parent"!==r&&Object.hasOwn(e,r)&&(t[r]=(0,f.A)(e[r]));return t}return e},isPCBroswer:()=>{let e=navigator.userAgent.toLowerCase(),t=null!==e.match(/ipad/i),r=null!==e.match(/iphone/i),i=null!==e.match(/midp/i),n=null!==e.match(/rv:1.2.3.4/i),a=null!==e.match(/ucweb/i),o=null!==e.match(/android/i),s=null!==e.match(/windows ce/i),l=null!==e.match(/windows mobile/i);return!t&&!r&&!i&&!n&&!a&&!o&&!s&&!l&&!0},webglreport:()=>{var e=function(){let e=window.navigator.userAgent.toLowerCase();if(e.indexOf("msie")>=0){let t=e.match(/msie ([\d]+)/);return{type:"IE",version:t?Number(t[1]):-1}}if(e.indexOf("firefox")>=0){let t=e.match(/firefox\/([\d]+)/);return{type:"Firefox",version:t?Number(t[1]):-1}}if(e.indexOf("chrome")>=0){let t=e.match(/chrome\/([\d]+)/);return{type:"Chrome",version:t?Number(t[1]):-1}}if(e.indexOf("opera")>=0){let t=e.match(/opera.([\d]+)/);return{type:"Opera",version:t?Number(t[1]):-1}}if(e.indexOf("Safari")>=0){let t=e.match(/version\/([\d]+)/);return{type:"Safari",version:t?Number(t[1]):-1}}return{type:e,version:-1}}();if("IE"===e.type&&e.version<11)return!1;try{let e,t=document.createElement("canvas");if("undefined"!=typeof WebGL2RenderingContext&&(e=t.getContext("webgl2")||t.getContext("experimental-webgl2")||void 0),null==e&&(e=t.getContext("webgl")||t.getContext("experimental-webgl")||void 0),null==e)return!1}catch(e){return!1}return!0},terrainPolyline:async e=>{let{viewer:t,positions:r,granularity:i=1e-5,offset:n=2,callback:a}=e;if(!r||0===r.length){a&&a(r,!1);return}let o=t.scene.globe.ellipsoid,s=[];for(let e=0;e<r.length-1;e++){let t=o.cartesianToCartographic(r[e]),n=o.cartesianToCartographic(r[e+1]);if(!t||!n)continue;let a=new w.A(t,n),l=a.surfaceDistance,h=Math.max(2,Math.ceil(l*i));for(let e=0;e<h;e++){let t=e/(h-1),r=a.interpolateUsingSurfaceDistance(l*t);s.push(r)}}let l=x.A.fromCartesian(r[0])?.height??0;try{let e=await (0,A.A)(t.terrainProvider,s),r=!1,i=t.scene.verticalExaggeration??1;for(let t=0;t<e.length;t++)void 0===e[t].height||null===e[t].height?(r=!0,e[t].height=l):e[t].height=n+e[t].height*i;let h=o.cartographicArrayToCartesianArray(e);a&&a(h,r)}catch(e){console.error("\u8BA1\u7B97\u8D34\u5730\u8DEF\u7EBF\u65F6\u51FA\u9519:",e),a&&a(r,!0)}},getEllipsoidTerrain:()=>new o.A({ellipsoid:b.A.WGS84}),getTerrainProvider:async e=>("requestWaterMask"in e||(e.requestWaterMask=!0),"requestVertexNormals"in e||(e.requestVertexNormals=!0),""===e.url||null===e.url||"cesium"===e.url?await l.A.fromIonAssetId(1):"ellipsoid"===e.url||"null"===e.url?E.getEllipsoidTerrain():await l.A.fromUrl(e.url,e)),createModel:(e,t)=>{let r=g.A.fromDegrees(e.x,e.y,e.z??0),i=H.A.toRadians(e.heading??0),n=H.A.toRadians(e.pitch??0),a=H.A.toRadians(e.roll??0),o=new v.A(i,n,a),s=C.A.headingPitchRollQuaternion(r,o);return t.entities.add({name:e.name??"",position:r,orientation:s,model:{uri:e.uri,...e},properties:{tooltip:e.tooltip,popup:e.popup}})},formatDegree:e=>{let t=Math.abs(e),r=Math.floor(t),i=Math.floor((t-r)*60),n=Math.round((t-r)*3600%60);return`${r}\xb0 ${i}' ${n}"`},floatObj:(i=e=>{let t={times:1,num:0};if(Math.floor(e)===e)return t.num=e,t;let r=e.toString(),i=r.indexOf("."),n=r.substring(i+1).length,a=10**n,o=Number.parseInt(String(e*a+.5),10);return t.times=a,t.num=o,t},n=(e,t,r)=>{let n=i(e),a=i(t),o=n.num,s=a.num,l=n.times,h=a.times,g=l>h?l:h;switch(r){case"add":return(l===h?o+s:l>h?o+l/h*s:h/l*o+s)/g;case"subtract":return(l===h?o-s:l>h?o-l/h*s:h/l*o-s)/g;case"multiply":return o*s/(l*h);case"divide":return o/s*(h/l)}},{add:(e,t)=>n(e,t,"add"),subtract:(e,t)=>n(e,t,"subtract"),multiply:(e,t)=>n(e,t,"multiply"),divide:(e,t)=>n(e,t,"divide")}),randomPointsWithinBbox:(e,t,r,i,n,a)=>{if("geojson"===a){let a={type:"FeatureCollection",features:[]};for(let o=0;o<n;o++){let n={type:"Feature",properties:{value:Math.floor(1e7*Math.random())},geometry:{type:"Point",coordinates:[Math.random()*(t-e)+e,Math.random()*(i-r)+r]}};a.features.push(n)}return a}let o=[];for(let a=0;a<n;a++){let n={x:Math.random()*(t-e)+e,y:Math.random()*(i-r)+r};o.push(n)}return o},onSegment:(e,t,r)=>!!((r.x-e.x)*(t.y-e.y)==(t.x-e.x)*(r.y-e.y)&&Math.min(e.x,t.x)<=r.x&&r.x<=Math.max(e.x,t.x)&&Math.min(e.y,t.y)<=r.y&&r.y<=Math.max(e.y,t.y)),isDotInPolygon:(e,t,r=!0)=>{let i,n,a=!1,o=Array.isArray(e)?{x:e[0],y:e[1]}:{x:e.x,y:e.y};for(let e=0,s=t.length-1;e<t.length;s=e++){let l=t[e],h=t[s];if(i=Array.isArray(l)?{x:l[0],y:l[1]}:{x:l.x,y:l.y},n=Array.isArray(h)?{x:h[0],y:h[1]}:{x:h.x,y:h.y},r&&E.onSegment(i,n,o))return!0;i.y>o.y!=n.y>o.y&&o.x<(o.y-i.y)*(i.x-n.x)/(i.y-n.y)+i.x&&(a=!a)}return a},randomPointsWithinPolygon:(e,t,r)=>{let i=1/0,n=-1/0,a=1/0,o=-1/0;for(let t of e){let e=Array.isArray(t)?t[0]:t.x,r=Array.isArray(t)?t[1]:t.y;i=Math.min(i,e),n=Math.max(n,e),a=Math.min(a,r),o=Math.max(o,r)}if("geojson"===r){let r={type:"FeatureCollection",features:[]};for(let s=0;s<t;s++){let t=E.randomPointsWithinBbox(i,n,a,o,1)[0];if(E.isDotInPolygon(t,e)){let e={type:"Feature",properties:{value:Math.floor(1e7*Math.random())},geometry:{type:"Point",coordinates:[t.x,t.y]}};r.features.push(e)}else s--}return r}let s=[];for(let r=0;r<t;r++){let t=E.randomPointsWithinBbox(i,n,a,o,1)[0];E.isDotInPolygon(t,e)?s.push(t):r--}return s},getJSON:async e=>{let t=await fetch(e);if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);return await t.json()}},M=class{viewer;targetHeight;startHeight;waterHeight;adapCoordi;speed;color;changetype;speedCallback;endCallback;polygonEntity;timer;constructor(e){this.viewer=e.viewer,this.targetHeight=e.targetHeight??10,this.startHeight=e.startHeight??0,this.waterHeight=e.waterHeight??this.startHeight,this.adapCoordi=e.adapCoordi??[0,0,0,0,0,0],this.speed=e.speed??1,this.color=e.color??d.A.fromBytes(64,157,253,100),this.changetype=e.changetype??"up",this.speedCallback=e.speedCallback??(()=>{}),this.endCallback=e.endCallback??(()=>{}),this.polygonEntity=[],this.timer=null,this.viewer&&(this.createEntity(),this.updatePoly(this.adapCoordi))}createEntity(){if(this.polygonEntity.length>0)for(let e of this.polygonEntity)this.viewer.entities.remove(e);this.polygonEntity=[];let e=this.viewer.entities.add({polygon:{hierarchy:new y.A(new p.A([])),material:this.color,extrudedHeight:new m.A(()=>this.waterHeight,!1)}});this.polygonEntity.push(e)}updatePoly(e){this.adapCoordi=e;let t=this.coordsTransformation(this.adapCoordi);this.polygonEntity.length>0&&this.polygonEntity[0].polygon&&(this.polygonEntity[0].polygon.hierarchy=new y.A(new p.A(t)))}coordsTransformation(e){let t=[];if(Array.isArray(e)&&"number"==typeof e[0])return e[0]<180&&e[0]>-180&&e[1]<90&&e[1]>-90?g.A.fromDegreesArray(e):[g.A.fromArray(e)];for(let r of e){let e;if("lng"in r&&"lat"in r)e=g.A.fromDegrees(r.lng,r.lat);else{if(!("x"in r)||!("y"in r))continue;e=r.x<180&&r.x>-180&&r.y<90&&r.y>-90?g.A.fromDegrees(r.x,r.y):r}t.push(e)}return t}start(){this.timer=window.setInterval(()=>{let e=this.speed/50;"up"===this.changetype?(this.waterHeight=E.floatObj.add(this.waterHeight,e),this.waterHeight>=this.targetHeight&&(this.waterHeight=this.targetHeight,this.stop(),this.endCallback())):(this.waterHeight=E.floatObj.subtract(this.waterHeight,e),this.waterHeight<=this.targetHeight&&(this.waterHeight=this.targetHeight,this.stop(),this.endCallback())),this.speedCallback(this.waterHeight)},20)}stop(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)}clear(){for(let e of(this.stop(),this.waterHeight=this.startHeight,this.polygonEntity))this.viewer.entities.remove(e);this.polygonEntity=[]}reset(){this.stop(),this.waterHeight=this.startHeight}setTargetHeight(e){this.targetHeight=e}setSpeed(e){this.speed=e}setChangeType(e){this.changetype=e}getCurrentHeight(){return this.waterHeight}};function P(e){let t=new a.A(e,{baseLayerPicker:!1,animation:!1,timeline:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,navigationHelpButton:!1});t.scene.debugShowFramesPerSecond=!0,t.imageryLayers.remove(t.imageryLayers.get(0)),t.scene.terrainProvider=new o.A({});let r=new s.A({url:"//data.mars3d.cn/tile/img/{z}/{x}/{y}.jpg"});t.imageryLayers.addImageryProvider(r),l.A.fromUrl("https://data.mars3d.cn/terrain",{requestWaterMask:!0,requestVertexNormals:!0}).then(e=>{t.scene.terrainProvider=e,t.scene.globe.depthTestAgainstTerrain=!0}).catch(e=>{console.error("\u52A0\u8F7D\u5730\u5F62\u5931\u8D25:",e)}),t.cesiumWidget.screenSpaceEventHandler.removeInputAction(h.A.LEFT_CLICK),t.cesiumWidget.screenSpaceEventHandler.removeInputAction(h.A.LEFT_DOUBLE_CLICK),new u.A(t,{enableCompass:!0,enableZoomControls:!0});let i=new c.GUI;i.domElement.style.position="fixed",i.domElement.style.top="50%",i.domElement.style.transform="translateY(-50%)",i.domElement.style.left="0";let n=[98.676842346815,27.571578111198868,98.86252156624968,27.77444519911974,98.76756234288729,27.800244194152533,98.57088699052892,27.72492584876768,98.676842346815,27.571578111198868],y=null,p={startHeight:1e3,targetHeight:2500,speed:200,currentHeight:0,isRunning:!1,\u98DE\u884C\u5230\u533A\u57DF:()=>{t.camera.setView({destination:g.A.fromDegrees(98.71707797694049,27.677299704639537,5e4)})},\u5F00\u59CB\u6DF9\u6CA1:()=>{p.isRunning?console.warn("\u6DF9\u6CA1\u5206\u6790\u5DF2\u5728\u8FD0\u884C\u4E2D"):(y&&y.clear(),y=new M({viewer:t,targetHeight:p.targetHeight,startHeight:p.startHeight,waterHeight:p.startHeight,adapCoordi:n,speed:p.speed,color:d.A.fromBytes(64,157,253,150),changetype:"up",speedCallback:e=>{p.currentHeight=Number.parseFloat(e.toFixed(2))},endCallback:()=>{p.isRunning=!1,console.log("\u6DF9\u6CA1\u5206\u6790\u5B8C\u6210")}}),p.isRunning=!0,p.currentHeight=p.startHeight,y.start())},\u6E05\u9664:()=>{y&&(y.clear(),y=null),p.isRunning=!1,p.currentHeight=0},\u91CD\u7F6E:()=>{p.\u6E05\u9664(),p.startHeight=1e3,p.targetHeight=2500,p.speed=200,p.currentHeight=0}},m=i.addFolder("\u53C2\u6570\u8BBE\u7F6E");m.add(p,"startHeight",0,5e3,10).name("\u8D77\u59CB\u9AD8\u5EA6 (\u7C73)").listen(),m.add(p,"targetHeight",0,5e3,10).name("\u76EE\u6807\u9AD8\u5EA6 (\u7C73)").listen(),m.add(p,"speed",1,1e3,1).name("\u901F\u5EA6 (\u7C73/\u79D2)").listen(),m.open();let f=i.addFolder("\u72B6\u6001\u663E\u793A");f.add(p,"currentHeight").name("\u5F53\u524D\u9AD8\u5EA6 (\u7C73)").listen(),f.add(p,"isRunning").name("\u8FD0\u884C\u72B6\u6001").listen(),f.open();let w=i.addFolder("\u64CD\u4F5C");return w.add(p,"\u98DE\u884C\u5230\u533A\u57DF"),w.add(p,"\u5F00\u59CB\u6DF9\u6CA1"),w.add(p,"\u6E05\u9664"),w.add(p,"\u91CD\u7F6E"),w.open(),{viewer:t,gui:i,cleanup:()=>{y&&y.clear()}}}}}]);