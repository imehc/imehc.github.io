"use strict";(self.webpackChunkanch=self.webpackChunkanch||[]).push([["9665"],{33029(t,e,a){a.r(e),a.d(e,{metadata:()=>r,default:()=>p,frontMatter:()=>h,contentTitle:()=>m,toc:()=>g,assets:()=>f});var r=JSON.parse('{"id":"web/canvas/image-mosaic","title":"\u56FE\u50CF\u9A6C\u8D5B\u514B","description":"\u6838\u5FC3\u6982\u5FF5","source":"@site/docs/web/canvas/01-image-mosaic.mdx","sourceDirName":"web/canvas","slug":"/web/canvas/image-mosaic","permalink":"/web/canvas/image-mosaic","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"dependabot[bot]","lastUpdatedAt":1769646500000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"\u56FE\u50CF\u9A6C\u8D5B\u514B"},"sidebar":"webSidebar","previous":{"title":"\u9E1F","permalink":"/web/three/showcases/bird"},"next":{"title":"\u661F\u7A7A\u7C92\u5B50","permalink":"/web/canvas/particle-stars"}}'),s=a(35656),n=a(86145),l=a(57140),i=a(82044),o=a(79457);function w(t,e){let a=t.getContext("2d");return a?(t.width=e.width,t.height=e.height,a.clearRect(0,0,e.width,e.height),a.drawImage(e,0,0,e.width,e.height),a):null}function c(t,e,a="image/png"){let r=document.createElement("a");r.download=e,r.href=t.toDataURL(a),r.click()}function d(t,e){let a=t.getContext("2d");if(!a)return!1;let{width:r,height:s}=t,n=a.getImageData(0,0,r,s),l=n.data;for(let t=0;t<s;t+=e)for(let a=0;a<r;a+=e){let n=(Math.floor(t)*r+Math.floor(a))*4,i=l[n],o=l[n+1],w=l[n+2];for(let n=t;n<t+e&&n<s;n++)for(let t=a;t<a+e&&t<r;t++){let e=(Math.floor(n)*r+Math.floor(t))*4;l[e]=i,l[e+1]=o,l[e+2]=w}}return a.putImageData(n,0,0),!0}function u(){var t;let e,a,r,n=(0,l.useRef)(null),u=(0,l.useRef)(null),h=(0,l.useRef)(null),m=(0,l.useMemo)(()=>"https://picsum.photos/640/640",[]),[f,g]=(0,l.useState)(m),[x,p]=(0,l.useState)(!1),[b,j]=(0,l.useState)(!1),[v,y]=(0,l.useState)({width:0,height:0}),[N,k]=(0,l.useState)(10),[C,R]=(0,l.useState)(10),{loadImage:D,imageRef:A}=function(){let[t,e]=(0,l.useState)(!1),[a,r]=(0,l.useState)(null),s=(0,l.useRef)(null);return{loadImage:(0,l.useCallback)(t=>(e(!0),r(null),new Promise((a,n)=>{let l=new Image;l.crossOrigin="Anonymous",l.src=t,l.onload=()=>{s.current=l,e(!1),a({image:l,width:l.width,height:l.height})},l.onerror=()=>{let a=Error(`\u{56FE}\u{7247}\u{52A0}\u{8F7D}\u{5931}\u{8D25}: ${t}`);r(a),e(!1),s.current=null,n(a)}})),[]),isLoading:t,error:a,imageRef:s}}(),{fileInputRef:I,handleFileChange:M,triggerFileUpload:S}=(t=t=>{p(!1),A.current=null,g(t)},e=(0,l.useRef)(null),a=(0,l.useCallback)(e=>{let a=e.target.files?.[0];if(a){let e=new FileReader;e.onload=e=>{e.target?.result&&t(e.target.result)},e.readAsDataURL(a)}},[t]),r=(0,l.useCallback)(()=>{e.current?.click()},[]),{fileInputRef:e,handleFileChange:a,triggerFileUpload:r}),E=(0,l.useEffectEvent)(t=>{let e=u.current;e&&A.current&&(w(e,A.current),d(e,t),p(!0),j(!1))}),$=(0,l.useEffectEvent)(async t=>{j(!0),p(!1);let e=h.current,a=n.current,r=u.current;if(!a||!r||!e)return void j(!1);try{var s,l;let n,i,o,{image:c}=await D(t),u=e.clientWidth/2-8,h=e.clientHeight,m=(s=c.width,l=c.height,(o=s/l)>1?(n=u,(i=u/o)>h&&(i=h,n=h*o)):(i=h,(n=h*o)>u&&(n=u,i=u/o)),{width:Math.floor(n),height:Math.floor(i)});y(m),w(a,c),w(r,c),d(r,N),p(!0),j(!1)}catch{p(!1),j(!1),y({width:0,height:0})}});(0,l.useEffect)(()=>{$(f)},[f]);let U=()=>{k(C),j(!0),E(C)};return(0,s.jsx)(i.A,{className:"tw:flex tw:flex-col tw:sm:w-full tw:md:w-2xl tw:aspect-video tw:items-center tw:justify-center",children:(0,s.jsxs)("div",{className:"tw:w-full tw:max-w-7xl tw:flex tw:flex-col tw:h-full tw:p-4",children:[(0,s.jsxs)("div",{className:"tw:flex tw:gap-2 tw:mb-4 tw:justify-center tw:flex-wrap",children:[(0,s.jsx)("input",{type:"file",ref:I,onChange:M,accept:"image/*",className:"tw:hidden"}),(0,s.jsx)("button",{type:"button",onClick:()=>{S()},disabled:b,className:`tw:px-4 tw:py-2 tw:text-white tw:rounded tw:transition-colors ${b?"tw:bg-gray-400 tw:cursor-not-allowed":"tw:bg-primary tw:hover:bg-primary-dark"}`,children:"\u9009\u62E9\u56FE\u7247"}),(0,s.jsx)("button",{type:"button",onClick:()=>{A.current=null,$(`${m}?${Date.now()}`)},disabled:!f||b,className:`tw:px-4 tw:py-2 tw:text-white tw:rounded tw:transition-colors ${!f||b?"tw:bg-gray-400 tw:cursor-not-allowed":"tw:bg-accent tw:hover:bg-accent-dark"}`,children:"\u5237\u65B0"}),(0,s.jsx)("button",{type:"button",onClick:()=>{let t=n.current;t&&c(t,"original-image.png")},disabled:!x||b,className:`tw:px-4 tw:py-2 tw:text-white tw:rounded tw:transition-colors ${!x||b?"tw:bg-gray-400 tw:cursor-not-allowed":"tw:bg-info tw:hover:bg-info-dark"}`,children:"\u5BFC\u51FA\u539F\u59CB\u56FE\u7247"}),(0,s.jsx)("button",{type:"button",onClick:()=>{let t=u.current;t&&c(t,"mosaic-image.png")},disabled:!x||b,className:`tw:px-4 tw:py-2 tw:text-white tw:rounded tw:transition-colors ${!x||b?"tw:bg-gray-400 tw:cursor-not-allowed":"tw:bg-secondary"}`,children:"\u5BFC\u51FA\u9A6C\u8D5B\u514B\u56FE\u7247"})]}),(0,s.jsxs)("div",{className:"tw:flex tw:gap-2 tw:mb-4 tw:justify-center tw:items-center",children:[(0,s.jsx)("span",{className:"tw:text-sm tw:font-medium",children:"\u9A6C\u8D5B\u514B\u5757\u5927\u5C0F:"}),(0,s.jsx)("input",{type:"range",min:"2",max:"50",value:C,onChange:t=>{R(parseInt(t.target.value,10))},onMouseUp:U,onTouchEnd:U,disabled:b,className:"tw:range tw:range-primary tw:w-48"}),(0,s.jsxs)("span",{className:"tw:text-sm tw:font-medium tw:w-8 tw:whitespace-nowrap",children:[N,"px"]})]}),(0,s.jsxs)("div",{ref:h,className:"tw:flex tw:flex-1 tw:gap-4 tw:min-h-0",children:[(0,s.jsxs)("div",{className:"tw:flex-1 tw:flex tw:items-center tw:justify-center tw:relative",children:[(0,s.jsx)("canvas",{ref:n,style:{width:v.width||"auto",height:v.height||"auto",display:v.width?"block":"none"},className:"tw:border tw:border-secondary tw:rounded-xl tw:shadow-lg"}),!x&&(0,s.jsx)(o.A,{})]}),(0,s.jsxs)("div",{className:"tw:flex-1 tw:flex tw:items-center tw:justify-center tw:relative",children:[(0,s.jsx)("canvas",{ref:u,style:{width:v.width||"auto",height:v.height||"auto",display:v.width?"block":"none"},className:"tw:border tw:border-secondary tw:rounded-xl tw:shadow-lg"}),(!x||b)&&(0,s.jsx)(o.A,{})]})]})]})})}let h={sidebar_position:1,title:"\u56FE\u50CF\u9A6C\u8D5B\u514B"},m="\u56FE\u50CF\u9A6C\u8D5B\u514B",f={},g=[{value:"\u6838\u5FC3\u6982\u5FF5",id:"\u6838\u5FC3\u6982\u5FF5",level:2}];function x(t){let e={h1:"h1",h2:"h2",header:"header",li:"li",strong:"strong",ul:"ul",...(0,n.R)(),...t.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"\u56FE\u50CF\u9A6C\u8D5B\u514B",children:"\u56FE\u50CF\u9A6C\u8D5B\u514B"})}),"\n",(0,s.jsx)(u,{}),"\n",(0,s.jsx)(e.h2,{id:"\u6838\u5FC3\u6982\u5FF5",children:"\u6838\u5FC3\u6982\u5FF5"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Canvas 2D API"}),": \u539F\u751FWeb API\uFF0C\u7528\u4E8E\u7ED8\u52362D\u56FE\u5F62\u548C\u64CD\u4F5C\u50CF\u7D20\u6570\u636E"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"getImageData/putImageData"}),": Canvas 2D \u7684\u5173\u952E\u65B9\u6CD5\uFF0C\u7528\u4E8E\u8BFB\u53D6\u548C\u4FEE\u6539\u50CF\u7D20\u6570\u636E"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u50CF\u7D20\u5904\u7406"}),": \u901A\u8FC7\u64CD\u4F5CRGBA\u6570\u7EC4\u5B9E\u73B0\u56FE\u50CF\u6548\u679C\uFF08\u9A6C\u8D5B\u514B\u3001\u6EE4\u955C\u7B49\uFF09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5BBD\u9AD8\u6BD4"}),": \u7EF4\u6301\u56FE\u50CF\u539F\u59CB\u5BBD\u9AD8\u6BD4\uFF0C\u9002\u5E94\u4E0D\u540C\u5BB9\u5668\u5C3A\u5BF8"]}),"\n"]})]})}function p(t={}){let{wrapper:e}={...(0,n.R)(),...t.components};return e?(0,s.jsx)(e,{...t,children:(0,s.jsx)(x,{...t})}):x(t)}},79457(t,e,a){a.d(e,{A:()=>s});var r=a(35656);function s({loadText:t="Loading..."}){return(0,r.jsxs)("div",{className:"tw:absolute tw:left-1/2 tw:top-1/2 tw:-translate-1/2",children:[(0,r.jsxs)("div",{className:"tw:flex tw:flex-col tw:items-center tw:justify-center",children:[(0,r.jsxs)("div",{className:"tw:relative tw:w-20 tw:h-20 tw:mb-6",children:[(0,r.jsx)("div",{className:"tw:absolute tw:inset-0 tw:border-4 tw:border-primary tw:border-t-transparent tw:rounded-full tw:animate-spin"}),(0,r.jsx)("div",{className:"tw:absolute tw:inset-2 tw:border-4 tw:border-secondary tw:border-b-transparent tw:rounded-full animate-spin-reverse"})]}),(0,r.jsx)("div",{className:"tw:text-base-content tw:text-opacity-80 tw:text-sm tw:mb-1",children:t})]}),(0,r.jsx)("style",{children:`
					@keyframes spin-reverse {
						from {
							transform: rotate(360deg);
						}
						to {
							transform: rotate(0deg);
						}
					}
					.animate-spin-reverse {
						animation: spin-reverse 1.5s linear infinite;
					}
				`})]})}}}]);