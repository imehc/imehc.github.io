"use strict";(self.webpackChunkanch=self.webpackChunkanch||[]).push([["1292"],{33729(n,e,i){i.r(e),i.d(e,{metadata:()=>s,default:()=>x,frontMatter:()=>d,contentTitle:()=>c,toc:()=>m,assets:()=>h});var s=JSON.parse('{"id":"web/cesium/spatial-analysis/05","title":"\u89C6\u9891\u6295\u5F71","description":"\u672C\u793A\u4F8B\u5C55\u793A\u5982\u4F55\u5728 Cesium \u4E2D\u5B9E\u73B0\u4E09\u7EF4\u89C6\u9891\u6295\u5F71\u529F\u80FD\u3002\u652F\u6301\u5C06\u89C6\u9891\u5185\u5BB9\u6295\u5F71\u5230\u4E09\u7EF4\u5730\u5F62\u8868\u9762\u6216\u7279\u5B9A\u7684\u51E0\u4F55\u4F53\u4E0A\uFF0C\u53EF\u4EE5\u6A21\u62DF\u76D1\u63A7\u6444\u50CF\u5934\u89C6\u89D2\u3001\u89C6\u9891\u64AD\u653E\u5668\u6295\u5F71\u3001\u5B9E\u65F6\u76F4\u64AD\u6D41\u6295\u5F71\u7B49\u573A\u666F\u3002\u8BE5\u529F\u80FD\u5E7F\u6CDB\u5E94\u7528\u4E8E\u667A\u6167\u57CE\u5E02\u76D1\u63A7\u3001\u65E0\u4EBA\u673A\u89C6\u9891\u56DE\u4F20\u3001\u89C6\u9891\u76D1\u63A7\u7CFB\u7EDF\u3001\u865A\u62DF\u6F14\u64AD\u5385\u7B49\u9886\u57DF\uFF0C\u4E3A\u4E09\u7EF4\u573A\u666F\u4E2D\u7684\u89C6\u9891\u5C55\u793A\u63D0\u4F9B\u76F4\u89C2\u7684\u53EF\u89C6\u5316\u652F\u6301\u3002","source":"@site/docs/web/cesium/spatial-analysis/05.mdx","sourceDirName":"web/cesium/spatial-analysis","slug":"/web/cesium/spatial-analysis/05","permalink":"/web/cesium/spatial-analysis/05","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Javascript","permalink":"/tags/javascript"},{"inline":true,"label":"TypeScript","permalink":"/tags/type-script"},{"inline":true,"label":"Cesium","permalink":"/tags/cesium"}],"version":"current","lastUpdatedBy":"imehc","lastUpdatedAt":1768180953000,"sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"\u89C6\u9891\u6295\u5F71","tags":["Javascript","TypeScript","Cesium"]},"sidebar":"webSidebar","previous":{"title":"\u7A7A\u95F4\u6D4B\u91CF","permalink":"/web/cesium/spatial-analysis/04"}}'),r=i(35656),t=i(75395),l=i(57140),a=i(82044);function o(){let n=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e,s,r,t=n.current;if(t)return Promise.all([i.e("4014"),i.e("4803"),i.e("8897"),i.e("8375"),i.e("2708"),i.e("5766"),i.e("2905"),i.e("3090"),i.e("4138")]).then(i.bind(i,24817)).then(({initViewer:n})=>{let i=n(t);e=i.viewer,s=i.gui,r=i.cleanup}),()=>{r&&r(),e&&!e.isDestroyed()&&e.destroy(),s&&s.destroy()}},[]),(0,r.jsx)(a.A,{children:(0,r.jsx)("div",{className:"tw:size-full",ref:n})})}let d={sidebar_position:5,title:"\u89C6\u9891\u6295\u5F71",tags:["Javascript","TypeScript","Cesium"]},c="\u89C6\u9891\u6295\u5F71",h={},m=[{value:"\u6838\u5FC3\u529F\u80FD",id:"\u6838\u5FC3\u529F\u80FD",level:2},{value:"\u89C6\u9891\u6295\u5F71\u53EF\u89C6\u5316",id:"\u89C6\u9891\u6295\u5F71\u53EF\u89C6\u5316",level:3},{value:"\u591A\u79CD\u6295\u5F71\u6A21\u5F0F",id:"\u591A\u79CD\u6295\u5F71\u6A21\u5F0F",level:3},{value:"\u89C6\u9891\u6E90\u652F\u6301",id:"\u89C6\u9891\u6E90\u652F\u6301",level:3},{value:"\u5173\u952E\u4EE3\u7801",id:"\u5173\u952E\u4EE3\u7801",level:2},{value:"\u521D\u59CB\u5316 Viewer",id:"\u521D\u59CB\u5316-viewer",level:3},{value:"\u5E73\u9762\u89C6\u9891\u6295\u5F71",id:"\u5E73\u9762\u89C6\u9891\u6295\u5F71",level:3},{value:"\u89C6\u9525\u4F53\u6295\u5F71\u5B9E\u73B0",id:"\u89C6\u9525\u4F53\u6295\u5F71\u5B9E\u73B0",level:3},{value:"Video \u7C7B\u6838\u5FC3\u5B9E\u73B0",id:"video-\u7C7B\u6838\u5FC3\u5B9E\u73B0",level:3},{value:"\u81EA\u5B9A\u4E49\u7740\u8272\u5668\u6750\u8D28",id:"\u81EA\u5B9A\u4E49\u7740\u8272\u5668\u6750\u8D28",level:3},{value:"HLS \u76F4\u64AD\u6D41\u652F\u6301",id:"hls-\u76F4\u64AD\u6D41\u652F\u6301",level:3},{value:"\u504F\u822A\u89D2\u548C\u4FEF\u4EF0\u89D2\u8BA1\u7B97",id:"\u504F\u822A\u89D2\u548C\u4FEF\u4EF0\u89D2\u8BA1\u7B97",level:3},{value:"\u5E94\u7528\u573A\u666F",id:"\u5E94\u7528\u573A\u666F",level:2},{value:"\u667A\u6167\u57CE\u5E02\u76D1\u63A7",id:"\u667A\u6167\u57CE\u5E02\u76D1\u63A7",level:3},{value:"\u65E0\u4EBA\u673A\u5E94\u7528",id:"\u65E0\u4EBA\u673A\u5E94\u7528",level:3},{value:"\u865A\u62DF\u6F14\u64AD",id:"\u865A\u62DF\u6F14\u64AD",level:3},{value:"\u519B\u4E8B\u5E94\u7528",id:"\u519B\u4E8B\u5E94\u7528",level:3},{value:"\u5E94\u6025\u6307\u6325",id:"\u5E94\u6025\u6307\u6325",level:3},{value:"\u6027\u80FD\u4F18\u5316\u6280\u5DE7",id:"\u6027\u80FD\u4F18\u5316\u6280\u5DE7",level:2},{value:"\u89C6\u9891\u8D44\u6E90\u4F18\u5316",id:"\u89C6\u9891\u8D44\u6E90\u4F18\u5316",level:3},{value:"\u6E32\u67D3\u6027\u80FD\u4F18\u5316",id:"\u6E32\u67D3\u6027\u80FD\u4F18\u5316",level:3},{value:"\u5185\u5B58\u7BA1\u7406\u4F18\u5316",id:"\u5185\u5B58\u7BA1\u7406\u4F18\u5316",level:3},{value:"HLS \u6D41\u4F18\u5316",id:"hls-\u6D41\u4F18\u5316",level:3},{value:"\u7740\u8272\u5668\u4F18\u5316",id:"\u7740\u8272\u5668\u4F18\u5316",level:3},{value:"\u5E38\u89C1\u95EE\u9898",id:"\u5E38\u89C1\u95EE\u9898",level:2},{value:"\u89C6\u9891\u4E0D\u663E\u793A",id:"\u89C6\u9891\u4E0D\u663E\u793A",level:3},{value:"\u89C6\u9891\u64AD\u653E\u5361\u987F",id:"\u89C6\u9891\u64AD\u653E\u5361\u987F",level:3},{value:"HLS \u6D41\u65E0\u6CD5\u64AD\u653E",id:"hls-\u6D41\u65E0\u6CD5\u64AD\u653E",level:3},{value:"\u89C6\u9525\u4F53\u663E\u793A\u4E0D\u6B63\u786E",id:"\u89C6\u9525\u4F53\u663E\u793A\u4E0D\u6B63\u786E",level:3},{value:"\u5185\u5B58\u6CC4\u6F0F",id:"\u5185\u5B58\u6CC4\u6F0F",level:3},{value:"\u89C6\u9891\u65CB\u8F6C\u95EE\u9898",id:"\u89C6\u9891\u65CB\u8F6C\u95EE\u9898",level:3},{value:"\u8DE8\u57DF\u95EE\u9898",id:"\u8DE8\u57DF\u95EE\u9898",level:3},{value:"\u6CE8\u610F\u4E8B\u9879",id:"\u6CE8\u610F\u4E8B\u9879",level:2},{value:"\u53C2\u8003\u8D44\u6599",id:"\u53C2\u8003\u8D44\u6599",level:2}];function v(n){let e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"\u89C6\u9891\u6295\u5F71",children:"\u89C6\u9891\u6295\u5F71"})}),"\n",(0,r.jsx)(e.p,{children:"\u672C\u793A\u4F8B\u5C55\u793A\u5982\u4F55\u5728 Cesium \u4E2D\u5B9E\u73B0\u4E09\u7EF4\u89C6\u9891\u6295\u5F71\u529F\u80FD\u3002\u652F\u6301\u5C06\u89C6\u9891\u5185\u5BB9\u6295\u5F71\u5230\u4E09\u7EF4\u5730\u5F62\u8868\u9762\u6216\u7279\u5B9A\u7684\u51E0\u4F55\u4F53\u4E0A\uFF0C\u53EF\u4EE5\u6A21\u62DF\u76D1\u63A7\u6444\u50CF\u5934\u89C6\u89D2\u3001\u89C6\u9891\u64AD\u653E\u5668\u6295\u5F71\u3001\u5B9E\u65F6\u76F4\u64AD\u6D41\u6295\u5F71\u7B49\u573A\u666F\u3002\u8BE5\u529F\u80FD\u5E7F\u6CDB\u5E94\u7528\u4E8E\u667A\u6167\u57CE\u5E02\u76D1\u63A7\u3001\u65E0\u4EBA\u673A\u89C6\u9891\u56DE\u4F20\u3001\u89C6\u9891\u76D1\u63A7\u7CFB\u7EDF\u3001\u865A\u62DF\u6F14\u64AD\u5385\u7B49\u9886\u57DF\uFF0C\u4E3A\u4E09\u7EF4\u573A\u666F\u4E2D\u7684\u89C6\u9891\u5C55\u793A\u63D0\u4F9B\u76F4\u89C2\u7684\u53EF\u89C6\u5316\u652F\u6301\u3002"}),"\n",(0,r.jsx)(o,{}),"\n",(0,r.jsx)(e.h2,{id:"\u6838\u5FC3\u529F\u80FD",children:"\u6838\u5FC3\u529F\u80FD"}),"\n",(0,r.jsx)(e.h3,{id:"\u89C6\u9891\u6295\u5F71\u53EF\u89C6\u5316",children:"\u89C6\u9891\u6295\u5F71\u53EF\u89C6\u5316"}),"\n",(0,r.jsx)(e.p,{children:"\u4F7F\u7528 Cesium \u7684\u89C6\u9525\u4F53\uFF08Frustum\uFF09\u548C\u6750\u8D28\u7CFB\u7EDF\u521B\u5EFA\u4E09\u7EF4\u89C6\u9891\u6295\u5F71\u6548\u679C\uFF1A"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u89C6\u9525\u4F53\u6E32\u67D3"}),"\uFF1A\u901A\u8FC7 ",(0,r.jsx)(e.code,{children:"FrustumGeometry"})," \u548C ",(0,r.jsx)(e.code,{children:"FrustumOutlineGeometry"})," \u521B\u5EFA\u6444\u50CF\u673A\u89C6\u9525\u4F53"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u52A8\u6001\u6750\u8D28"}),"\uFF1A\u4F7F\u7528\u81EA\u5B9A\u4E49\u7740\u8272\u5668\u5C06\u89C6\u9891\u7EB9\u7406\u6620\u5C04\u5230\u6295\u5F71\u8868\u9762"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5B9E\u65F6\u66F4\u65B0"}),"\uFF1A\u89C6\u9891\u5E27\u5B9E\u65F6\u66F4\u65B0\u5230\u4E09\u7EF4\u573A\u666F\u4E2D"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5E73\u9762\u6295\u5F71"}),"\uFF1A\u652F\u6301\u5C06\u89C6\u9891\u6295\u5F71\u5230\u6307\u5B9A\u7684\u591A\u8FB9\u5F62\u5E73\u9762"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u89C6\u9525\u6295\u5F71"}),"\uFF1A\u652F\u6301\u521B\u5EFA\u5E26\u89C6\u9525\u4F53\u53EF\u89C6\u5316\u7684\u6295\u5F71\u6548\u679C"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u591A\u79CD\u6295\u5F71\u6A21\u5F0F",children:"\u591A\u79CD\u6295\u5F71\u6A21\u5F0F"}),"\n",(0,r.jsx)(e.p,{children:"\u7075\u6D3B\u7684\u89C6\u9891\u6295\u5F71\u65B9\u5F0F\uFF1A"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5E73\u9762\u6295\u5F71"}),"\uFF1A\u5C06\u89C6\u9891\u76F4\u63A5\u6620\u5C04\u5230\u591A\u8FB9\u5F62\u8868\u9762\uFF0C\u652F\u6301\u8D34\u5730\u548C\u79BB\u5730\u4E24\u79CD\u6A21\u5F0F"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u89C6\u9525\u4F53\u6295\u5F71"}),"\uFF1A\u521B\u5EFA\u6444\u50CF\u673A\u89C6\u9525\u4F53\uFF0C\u6A21\u62DF\u771F\u5B9E\u76D1\u63A7\u6444\u50CF\u5934\u7684\u89C6\u89D2\u8303\u56F4"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4EA4\u4E92\u5F0F\u8BBE\u7F6E"}),"\uFF1A\u652F\u6301\u901A\u8FC7\u9F20\u6807\u70B9\u51FB\u8BBE\u7F6E\u89C2\u5BDF\u70B9\u548C\u89C2\u5BDF\u7EC8\u70B9"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u53C2\u6570\u5316\u914D\u7F6E"}),"\uFF1A\u652F\u6301\u901A\u8FC7\u53C2\u6570\u76F4\u63A5\u6307\u5B9A\u89C2\u5BDF\u4F4D\u7F6E\u548C\u89C6\u89D2"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u591A\u89C6\u9891\u652F\u6301"}),"\uFF1A\u53EF\u540C\u65F6\u521B\u5EFA\u591A\u4E2A\u89C6\u9891\u6295\u5F71\u5B9E\u4F8B"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u89C6\u9891\u6E90\u652F\u6301",children:"\u89C6\u9891\u6E90\u652F\u6301"}),"\n",(0,r.jsx)(e.p,{children:"\u652F\u6301\u591A\u79CD\u89C6\u9891\u6E90\u683C\u5F0F\uFF1A"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u672C\u5730\u89C6\u9891"}),"\uFF1A\u652F\u6301 MP4\u3001WebM \u7B49\u5E38\u89C1\u89C6\u9891\u683C\u5F0F"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"HLS \u76F4\u64AD\u6D41"}),"\uFF1A\u4F7F\u7528 HLS.js \u652F\u6301 m3u8 \u683C\u5F0F\u7684\u76F4\u64AD\u6D41"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u8DE8\u57DF\u89C6\u9891"}),"\uFF1A\u652F\u6301\u8DE8\u57DF\u89C6\u9891\u8D44\u6E90\u7684\u52A0\u8F7D\u548C\u64AD\u653E"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u89C6\u9891\u63A7\u5236"}),"\uFF1A\u652F\u6301\u64AD\u653E\u3001\u6682\u505C\u3001\u5FAA\u73AF\u7B49\u89C6\u9891\u63A7\u5236\u529F\u80FD"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u81EA\u52A8\u64AD\u653E"}),"\uFF1A\u652F\u6301\u89C6\u9891\u81EA\u52A8\u64AD\u653E\u548C\u9759\u97F3\u8BBE\u7F6E"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u5173\u952E\u4EE3\u7801",children:"\u5173\u952E\u4EE3\u7801"}),"\n",(0,r.jsx)(e.h3,{id:"\u521D\u59CB\u5316-viewer",children:"\u521D\u59CB\u5316 Viewer"}),"\n",(0,r.jsx)(e.p,{children:"\u521B\u5EFA Cesium Viewer \u5E76\u914D\u7F6E\u57FA\u7840\u8BBE\u7F6E\uFF08viewer.ts\uFF09\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'export function initViewer(el: HTMLElement) {\n  const viewer = new Viewer(el, {\n    baseLayerPicker: false,\n    animation: false,\n    timeline: false,\n    fullscreenButton: false,\n    geocoder: false,\n    homeButton: false,\n    infoBox: false,\n    sceneModePicker: false,\n    selectionIndicator: false,\n    navigationHelpButton: false,\n  });\n\n  viewer.scene.debugShowFramesPerSecond = true;\n  viewer.imageryLayers.remove(viewer.imageryLayers.get(0));\n  viewer.scene.terrainProvider = new EllipsoidTerrainProvider({});\n\n  // \u5F00\u542F\u6DF1\u5EA6\u68C0\u6D4B\n  viewer.scene.globe.depthTestAgainstTerrain = true;\n\n  // \u6DFB\u52A0\u5F71\u50CF\u56FE\u5C42\n  const xyz = new UrlTemplateImageryProvider({\n    url: "//data.mars3d.cn/tile/img/{z}/{x}/{y}.jpg",\n  });\n  viewer.imageryLayers.addImageryProvider(xyz);\n\n  // \u8BBE\u7F6E\u521D\u59CB\u89C6\u89D2\n  viewer.camera.setView({\n    destination: Cartesian3.fromDegrees(114.26, 30.575, 500),\n    orientation: {\n      heading: CesiumMath.toRadians(0),\n      pitch: CesiumMath.toRadians(-45),\n      roll: 0.0,\n    },\n  });\n\n  return viewer;\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u5E73\u9762\u89C6\u9891\u6295\u5F71",children:"\u5E73\u9762\u89C6\u9891\u6295\u5F71"}),"\n",(0,r.jsx)(e.p,{children:"\u5C06\u89C6\u9891\u6295\u5F71\u5230\u591A\u8FB9\u5F62\u5E73\u9762\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// \u521B\u5EFA\u89C6\u9891\u5143\u7D20\nconst video = document.createElement("video");\nvideo.id = "video_dom";\nvideo.preload = "auto";\nvideo.autoplay = true;\nvideo.loop = true;\nvideo.muted = true;\nvideo.crossOrigin = "anonymous";\nvideo.src = "/path/to/video.mp4";\n\n// \u5E26\u9AD8\u5EA6\u7684\u591A\u8FB9\u5F62\u6295\u5F71\uFF08\u79BB\u5730\uFF09\nconst polygonWithHeight = [\n  114.25985245208585, 30.5752892693654, 14.23,\n  114.25923491594841, 30.5752027998838, 13.62,\n  114.25922774520328, 30.5752225398922, 47.51,\n  114.25985290311769, 30.5753018567495, 47.57,\n];\n\nviewer.entities.add({\n  polygon: {\n    hierarchy: Cartesian3.fromDegreesArrayHeights(polygonWithHeight),\n    material: video as unknown as MaterialProperty,\n    perPositionHeight: true,\n    outline: true,\n  },\n});\n\n// \u8D34\u5730\u591A\u8FB9\u5F62\u6295\u5F71\nconst groundPolygon = [\n  114.26109123956515, 30.575196063095532,\n  114.26002868416131, 30.575029970052253,\n  114.25995067898559, 30.575610284720895,\n  114.26093508652325, 30.57571375633287,\n];\n\nviewer.entities.add({\n  polygon: {\n    hierarchy: Cartesian3.fromDegreesArray(groundPolygon),\n    material: video as unknown as MaterialProperty,\n  },\n});\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u89C6\u9525\u4F53\u6295\u5F71\u5B9E\u73B0",children:"\u89C6\u9525\u4F53\u6295\u5F71\u5B9E\u73B0"}),"\n",(0,r.jsx)(e.p,{children:"\u521B\u5EFA\u5E26\u89C6\u9525\u4F53\u53EF\u89C6\u5316\u7684\u89C6\u9891\u6295\u5F71\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// \u89C6\u9891\u6295\u5F71\u914D\u7F6E\nconst options = {\n  horizontalViewAngle: 60,  // \u6C34\u5E73\u89C6\u89D2\n  verticalViewAngle: 40,    // \u5782\u76F4\u89C6\u89D2\n  video: "video_dom",       // \u89C6\u9891\u5143\u7D20ID\n  viewPosition: Cartesian3.fromDegrees(114.26, 30.575, 515),\n  viewPositionEnd: Cartesian3.fromDegrees(114.252, 30.576, 270),\n};\n\n// \u521B\u5EFA\u89C6\u9891\u6295\u5F71\u5B9E\u4F8B\nconst videoProjection = new Video(viewer, options);\n\n// \u5F00\u59CB\u7ED8\u5236\u89C6\u9525\u4F53\u6295\u5F71\nvideoProjection.drawVideo();\n'})}),"\n",(0,r.jsx)(e.h3,{id:"video-\u7C7B\u6838\u5FC3\u5B9E\u73B0",children:"Video \u7C7B\u6838\u5FC3\u5B9E\u73B0"}),"\n",(0,r.jsx)(e.p,{children:"\u89C6\u9891\u6295\u5F71\u7C7B\u7684\u6838\u5FC3\u5B9E\u73B0\uFF08video.ts\uFF09\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'class Video {\n  private viewer: Viewer;\n  private lightCamera: Camera;\n  private horizontalViewAngle: number;\n  private verticalViewAngle: number;\n  private viewPosition: Cartesian3;\n  private viewPositionEnd: Cartesian3;\n  private viewDistance: number;\n  private viewHeading: number;\n  private viewPitch: number;\n  private video_dom?: HTMLVideoElement;\n\n  constructor(viewer: Viewer, config: VideoConfig) {\n    this.viewer = viewer;\n    this.config = config;\n  }\n\n  // \u7ED8\u5236\u89C6\u9891\u6295\u5F71\n  public drawVideo() {\n    const {\n      horizontalViewAngle = 60.0,\n      verticalViewAngle = 40.0,\n      viewPosition,\n      viewPositionEnd,\n    } = this.config;\n\n    this.horizontalViewAngle = horizontalViewAngle;\n    this.verticalViewAngle = verticalViewAngle;\n\n    // \u83B7\u53D6\u89C6\u9891DOM\u5143\u7D20\n    if (typeof this.config.video === "string") {\n      this.video_dom = document.getElementById(\n        this.config.video\n      ) as HTMLVideoElement;\n    }\n\n    if (viewPosition && viewPositionEnd) {\n      this.viewPosition = viewPosition;\n      this.viewPositionEnd = viewPositionEnd;\n      this.viewDistance = Cartesian3.distance(\n        viewPosition,\n        viewPositionEnd\n      );\n      this.viewHeading = this.getHeading(\n        this.viewPosition,\n        this.viewPositionEnd\n      );\n      this.viewPitch = this.getPitch(\n        this.viewPosition,\n        this.viewPositionEnd\n      );\n      this.createLightCamera();\n    }\n  }\n\n  // \u521B\u5EFA\u76F8\u673A\n  private createLightCamera() {\n    this.lightCamera = new Camera(this.viewer.scene);\n    this.lightCamera.position = this.viewPosition;\n    this.lightCamera.frustum.near = this.viewDistance * 0.0001;\n    this.lightCamera.frustum.far = this.viewDistance;\n\n    const hr = CesiumMath.toRadians(this.horizontalViewAngle);\n    const vr = CesiumMath.toRadians(this.verticalViewAngle);\n    const aspectRatio =\n      (this.viewDistance * Math.tan(hr / 2) * 2) /\n      (this.viewDistance * Math.tan(vr / 2) * 2);\n\n    (this.lightCamera.frustum as PerspectiveFrustum).aspectRatio = aspectRatio;\n    (this.lightCamera.frustum as PerspectiveFrustum).fov =\n      hr > vr ? hr : vr;\n\n    this.lightCamera.setView({\n      destination: this.viewPosition,\n      orientation: {\n        heading: CesiumMath.toRadians(this.viewHeading || 0),\n        pitch: CesiumMath.toRadians(this.viewPitch || 0),\n        roll: 0,\n      },\n    });\n\n    this.drawFrustumOutline();\n  }\n\n  // \u521B\u5EFA\u89C6\u9525\u7EBF\n  private drawFrustumOutline() {\n    const scratchRight = new Cartesian3();\n    const scratchRotation = new Matrix3();\n    const scratchOrientation = new Quaternion();\n\n    const direction = this.lightCamera.directionWC;\n    const up = this.lightCamera.upWC;\n    let right = this.lightCamera.rightWC;\n    right = Cartesian3.negate(right, scratchRight);\n\n    const rotation = scratchRotation;\n    Matrix3.setColumn(rotation, 0, right, rotation);\n    Matrix3.setColumn(rotation, 1, up, rotation);\n    Matrix3.setColumn(rotation, 2, direction, rotation);\n\n    const orientation = Quaternion.fromRotationMatrix(\n      rotation,\n      scratchOrientation\n    );\n\n    // \u521B\u5EFA\u89C6\u9525\u4F53\u51E0\u4F55\n    const frustum = this.lightCamera.frustum as PerspectiveFrustum;\n    const newObj = frustum.clone();\n    newObj.near = newObj.far - 0.01;\n\n    const videoGeometryInstance = new GeometryInstance({\n      geometry: new FrustumGeometry({\n        frustum: newObj,\n        origin: this.viewPosition,\n        orientation: orientation,\n      }),\n    });\n\n    const primitive = new Primitive({\n      geometryInstances: [videoGeometryInstance],\n      appearance: this.createAppearance(),\n    });\n\n    this.viewer.scene.primitives.add(primitive);\n  }\n\n  // \u6E05\u9664\u6240\u6709\u89C6\u9891\u6295\u5F71\n  public clearAll() {\n    const entities = this.viewer.entities.values;\n    for (let i = 0; i < entities.length; i++) {\n      if (entities[i].name === "video") {\n        this.viewer.entities.remove(entities[i]);\n        i--;\n      }\n    }\n\n    this.videos.forEach((v) => {\n      if (v && !v.isDestroyed()) {\n        this.viewer.scene.primitives.remove(v);\n        v.destroy();\n      }\n    });\n    this.videos = [];\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u81EA\u5B9A\u4E49\u7740\u8272\u5668\u6750\u8D28",children:"\u81EA\u5B9A\u4E49\u7740\u8272\u5668\u6750\u8D28"}),"\n",(0,r.jsx)(e.p,{children:"\u521B\u5EFA\u89C6\u9891\u6295\u5F71\u7684\u81EA\u5B9A\u4E49\u6750\u8D28\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'private createAppearance() {\n  const source = `czm_material czm_getMaterial(czm_materialInput materialInput)\n  {\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    vec2 st = materialInput.st;\n    vec4 colorImage = texture(image, vec2(st.s, st.t));\n    vec4 maskImage = texture(tmask, vec2(st.s, st.t));\n    material.alpha = colorImage.a * color.a * maskImage.r;\n    material.diffuse = colorImage.rgb * color.rgb;\n    return material;\n  }`;\n\n  const material = new Material({\n    fabric: {\n      type: "custome_1",\n      uniforms: {\n        color: new Color(1.0, 1.0, 1.0, 1.0),\n        image: "data:image/...",  // \u9ED8\u8BA4\u7EB9\u7406\n        tmask: "data:image/...",   // \u906E\u7F69\u7EB9\u7406\n      },\n      source: source,\n    },\n  });\n\n  // \u5C06\u89C6\u9891\u8BBE\u7F6E\u4E3A\u7EB9\u7406\n  material.uniforms.image = this.video_dom;\n\n  const appearance = new EllipsoidSurfaceAppearance({\n    material: material,\n    flat: true,\n    renderState: {\n      cull: {\n        enabled: false,\n      },\n      depthTest: {\n        enabled: false,\n      },\n    },\n  });\n\n  return appearance;\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"hls-\u76F4\u64AD\u6D41\u652F\u6301",children:"HLS \u76F4\u64AD\u6D41\u652F\u6301"}),"\n",(0,r.jsx)(e.p,{children:"\u4F7F\u7528 HLS.js \u52A0\u8F7D\u76F4\u64AD\u6D41\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'function loadLiveVideo(viewer: Viewer, container: HTMLElement) {\n  const videoElement = document.createElement("video");\n  videoElement.id = "video_dom";\n  videoElement.autoplay = true;\n  videoElement.muted = true;\n\n  container.appendChild(videoElement);\n\n  const videoSrc = "https://example.com/live/stream.m3u8";\n\n  if (Hls.isSupported()) {\n    const hls = new Hls();\n    hls.loadSource(videoSrc);\n    hls.attachMedia(videoElement);\n\n    hls.on(Hls.Events.MANIFEST_PARSED, () => {\n      videoElement.play().then(() => {\n        // \u521B\u5EFA\u89C6\u9891\u6295\u5F71\n        const videoProjection = new Video(viewer, {\n          video: "video_dom",\n          viewPosition: Cartesian3.fromDegrees(114.26, 30.575, 515),\n          viewPositionEnd: Cartesian3.fromDegrees(114.252, 30.576, 270),\n        });\n        videoProjection.drawVideo();\n      });\n    });\n  } else if (videoElement.canPlayType("application/vnd.apple.mpegurl")) {\n    // Safari \u539F\u751F\u652F\u6301\n    videoElement.src = videoSrc;\n    videoElement.addEventListener("loadedmetadata", () => {\n      videoElement.play();\n    });\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u504F\u822A\u89D2\u548C\u4FEF\u4EF0\u89D2\u8BA1\u7B97",children:"\u504F\u822A\u89D2\u548C\u4FEF\u4EF0\u89D2\u8BA1\u7B97"}),"\n",(0,r.jsx)(e.p,{children:"\u8BA1\u7B97\u6444\u50CF\u673A\u7684\u65B9\u5411\u89D2\u5EA6\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:"// \u83B7\u53D6\u504F\u822A\u89D2\uFF08Heading\uFF09\nprivate getHeading(fromPosition: Cartesian3, toPosition: Cartesian3) {\n  const finalPosition = new Cartesian3();\n  const matrix4 = Transforms.eastNorthUpToFixedFrame(fromPosition);\n  Matrix4.inverse(matrix4, matrix4);\n  Matrix4.multiplyByPoint(matrix4, toPosition, finalPosition);\n  Cartesian3.normalize(finalPosition, finalPosition);\n  return CesiumMath.toDegrees(Math.atan2(finalPosition.x, finalPosition.y));\n}\n\n// \u83B7\u53D6\u4FEF\u4EF0\u89D2\uFF08Pitch\uFF09\nprivate getPitch(fromPosition: Cartesian3, toPosition: Cartesian3) {\n  const finalPosition = new Cartesian3();\n  const matrix4 = Transforms.eastNorthUpToFixedFrame(fromPosition);\n  Matrix4.inverse(matrix4, matrix4);\n  Matrix4.multiplyByPoint(matrix4, toPosition, finalPosition);\n  Cartesian3.normalize(finalPosition, finalPosition);\n  return CesiumMath.toDegrees(Math.asin(finalPosition.z));\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u5E94\u7528\u573A\u666F",children:"\u5E94\u7528\u573A\u666F"}),"\n",(0,r.jsx)(e.h3,{id:"\u667A\u6167\u57CE\u5E02\u76D1\u63A7",children:"\u667A\u6167\u57CE\u5E02\u76D1\u63A7"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u76D1\u63A7\u6444\u50CF\u5934\u53EF\u89C6\u5316"}),"\uFF1A\u663E\u793A\u57CE\u5E02\u76D1\u63A7\u6444\u50CF\u5934\u7684\u8986\u76D6\u8303\u56F4\u548C\u5B9E\u65F6\u753B\u9762"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u89C6\u9891\u76D1\u63A7\u7CFB\u7EDF"}),"\uFF1A\u96C6\u6210\u591A\u4E2A\u76D1\u63A7\u70B9\u7684\u89C6\u9891\u6D41\u5230\u4E09\u7EF4\u5730\u56FE\u4E2D"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5B89\u9632\u5DE1\u68C0"}),"\uFF1A\u53EF\u89C6\u5316\u5C55\u793A\u5B89\u9632\u6444\u50CF\u5934\u7684\u76D1\u63A7\u533A\u57DF"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4EA4\u901A\u76D1\u63A7"}),"\uFF1A\u5C55\u793A\u8DEF\u53E3\u76D1\u63A7\u6444\u50CF\u5934\u7684\u89C6\u89D2\u548C\u5B9E\u65F6\u4EA4\u901A\u72B6\u51B5"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u65E0\u4EBA\u673A\u5E94\u7528",children:"\u65E0\u4EBA\u673A\u5E94\u7528"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u65E0\u4EBA\u673A\u89C6\u9891\u56DE\u4F20"}),"\uFF1A\u5B9E\u65F6\u663E\u793A\u65E0\u4EBA\u673A\u6444\u50CF\u5934\u62CD\u6444\u7684\u753B\u9762"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u98DE\u884C\u8DEF\u5F84\u56DE\u653E"}),"\uFF1A\u56DE\u653E\u65E0\u4EBA\u673A\u98DE\u884C\u8FC7\u7A0B\u4E2D\u5F55\u5236\u7684\u89C6\u9891"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u89C6\u89D2\u6A21\u62DF"}),"\uFF1A\u6A21\u62DF\u65E0\u4EBA\u673A\u5728\u4E0D\u540C\u4F4D\u7F6E\u548C\u89D2\u5EA6\u7684\u89C6\u91CE\u8303\u56F4"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5DE1\u68C0\u8BB0\u5F55"}),"\uFF1A\u5C55\u793A\u65E0\u4EBA\u673A\u5DE1\u68C0\u8FC7\u7A0B\u4E2D\u7684\u89C6\u9891\u8BB0\u5F55"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u865A\u62DF\u6F14\u64AD",children:"\u865A\u62DF\u6F14\u64AD"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u865A\u62DF\u6F14\u64AD\u5385"}),"\uFF1A\u5728\u4E09\u7EF4\u573A\u666F\u4E2D\u6295\u5F71\u89C6\u9891\u5185\u5BB9"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5C55\u89C8\u5C55\u793A"}),"\uFF1A\u5728\u865A\u62DF\u5C55\u5385\u4E2D\u64AD\u653E\u5C55\u54C1\u89C6\u9891"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4F1A\u8BAE\u7CFB\u7EDF"}),"\uFF1A\u5728\u865A\u62DF\u4F1A\u8BAE\u5BA4\u4E2D\u6295\u5F71\u6F14\u8BB2\u8005\u753B\u9762"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6559\u80B2\u57F9\u8BAD"}),"\uFF1A\u5728\u4E09\u7EF4\u6559\u5B66\u573A\u666F\u4E2D\u64AD\u653E\u6559\u5B66\u89C6\u9891"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u519B\u4E8B\u5E94\u7528",children:"\u519B\u4E8B\u5E94\u7528"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6218\u573A\u4FA6\u5BDF"}),"\uFF1A\u663E\u793A\u4FA6\u5BDF\u8BBE\u5907\u62CD\u6444\u7684\u5B9E\u65F6\u753B\u9762"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u76EE\u6807\u8DDF\u8E2A"}),"\uFF1A\u53EF\u89C6\u5316\u8DDF\u8E2A\u76EE\u6807\u7684\u76D1\u63A7\u89C6\u9891"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6A21\u62DF\u8BAD\u7EC3"}),"\uFF1A\u5728\u8BAD\u7EC3\u573A\u666F\u4E2D\u6295\u5F71\u6A21\u62DF\u89C6\u9891"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6001\u52BF\u611F\u77E5"}),"\uFF1A\u96C6\u6210\u591A\u4E2A\u89C6\u9891\u6E90\u63D0\u5347\u6218\u573A\u6001\u52BF\u611F\u77E5"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u5E94\u6025\u6307\u6325",children:"\u5E94\u6025\u6307\u6325"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u73B0\u573A\u89C6\u9891"}),"\uFF1A\u5728\u6307\u6325\u4E2D\u5FC3\u4E09\u7EF4\u5730\u56FE\u4E0A\u663E\u793A\u73B0\u573A\u89C6\u9891"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5E94\u6025\u54CD\u5E94"}),"\uFF1A\u5B9E\u65F6\u67E5\u770B\u5E94\u6025\u73B0\u573A\u7684\u76D1\u63A7\u753B\u9762"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u707E\u5BB3\u8BC4\u4F30"}),"\uFF1A\u901A\u8FC7\u89C6\u9891\u6295\u5F71\u8BC4\u4F30\u707E\u5BB3\u5F71\u54CD\u8303\u56F4"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6551\u63F4\u6307\u6325"}),"\uFF1A\u534F\u8C03\u591A\u4E2A\u6551\u63F4\u70B9\u7684\u89C6\u9891\u4FE1\u606F"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u6027\u80FD\u4F18\u5316\u6280\u5DE7",children:"\u6027\u80FD\u4F18\u5316\u6280\u5DE7"}),"\n",(0,r.jsx)(e.h3,{id:"\u89C6\u9891\u8D44\u6E90\u4F18\u5316",children:"\u89C6\u9891\u8D44\u6E90\u4F18\u5316"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u89C6\u9891\u538B\u7F29"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// \u4F7F\u7528\u9002\u5F53\u7684\u89C6\u9891\u7F16\u7801\u548C\u5206\u8FA8\u7387\nconst videoConfig = {\n  width: 1280,      // \u4E0D\u8981\u4F7F\u7528\u8FC7\u9AD8\u7684\u5206\u8FA8\u7387\n  height: 720,\n  bitrate: 2000000, // \u63A7\u5236\u7801\u7387\n  codec: "h264",    // \u4F7F\u7528\u9AD8\u6548\u7684\u7F16\u7801\u683C\u5F0F\n};\n'})}),"\n",(0,r.jsxs)(e.ol,{start:"2",children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u89C6\u9891\u9884\u52A0\u8F7D"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// \u9884\u52A0\u8F7D\u89C6\u9891\u4EE5\u51CF\u5C11\u9996\u6B21\u64AD\u653E\u5EF6\u8FDF\nvideo.preload = "auto";\n\n// \u76D1\u542C\u52A0\u8F7D\u8FDB\u5EA6\nvideo.addEventListener("progress", (e) => {\n  const loaded = video.buffered.length > 0\n    ? video.buffered.end(0) / video.duration\n    : 0;\n  console.log(`\u52A0\u8F7D\u8FDB\u5EA6: ${(loaded * 100).toFixed(2)}%`);\n});\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u6E32\u67D3\u6027\u80FD\u4F18\u5316",children:"\u6E32\u67D3\u6027\u80FD\u4F18\u5316"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u63A7\u5236\u6295\u5F71\u6570\u91CF"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// \u274C \u907F\u514D\uFF1A\u521B\u5EFA\u8FC7\u591A\u89C6\u9891\u6295\u5F71\nfor (let i = 0; i < 100; i++) {\n  createVideoProjection();\n}\n\n// \u2705 \u63A8\u8350\uFF1A\u9650\u5236\u540C\u65F6\u663E\u793A\u7684\u6295\u5F71\u6570\u91CF\nconst MAX_PROJECTIONS = 5;\nif (currentProjections.length < MAX_PROJECTIONS) {\n  createVideoProjection();\n} else {\n  console.warn("\u8FBE\u5230\u6700\u5927\u6295\u5F71\u6570\u91CF\u9650\u5236");\n}\n'})}),"\n",(0,r.jsxs)(e.ol,{start:"2",children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u89C6\u9525\u4F53\u7B80\u5316"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// \u6839\u636E\u8DDD\u79BB\u52A8\u6001\u8C03\u6574\u89C6\u9525\u4F53\u7CBE\u5EA6\nviewer.camera.changed.addEventListener(() => {\n  const distance = Cartesian3.distance(\n    viewer.camera.position,\n    projectionPosition\n  );\n\n  if (distance > 1000) {\n    // \u8DDD\u79BB\u8FDC\u65F6\u4F7F\u7528\u7B80\u5316\u7684\u89C6\u9525\u4F53\n    updateFrustumDetail("low");\n  } else {\n    // \u8DDD\u79BB\u8FD1\u65F6\u4F7F\u7528\u8BE6\u7EC6\u7684\u89C6\u9525\u4F53\n    updateFrustumDetail("high");\n  }\n});\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u5185\u5B58\u7BA1\u7406\u4F18\u5316",children:"\u5185\u5B58\u7BA1\u7406\u4F18\u5316"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u53CA\u65F6\u6E05\u7406\u8D44\u6E90"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// \u5B8C\u6574\u7684\u6E05\u7406\u51FD\u6570\nconst cleanupVideo = () => {\n  // 1. \u505C\u6B62\u5E76\u6E05\u7406\u89C6\u9891\n  if (videoElement) {\n    videoElement.pause();\n    videoElement.src = "";\n    videoElement.load();\n    videoElement.remove();\n  }\n\n  // 2. \u9500\u6BC1HLS\u5B9E\u4F8B\n  if (hls) {\n    hls.destroy();\n    hls = null;\n  }\n\n  // 3. \u6E05\u7406\u6295\u5F71\u5B9E\u4F8B\n  if (videoProjection) {\n    videoProjection.clearAll();\n    videoProjection = null;\n  }\n\n  // 4. \u79FB\u9664\u5B9E\u4F53\n  viewer.entities.removeAll();\n};\n\n// React\u7EC4\u4EF6\u5378\u8F7D\u65F6\u6E05\u7406\nuseEffect(() => {\n  return () => {\n    cleanupVideo();\n    if (viewer && !viewer.isDestroyed()) {\n      viewer.destroy();\n    }\n  };\n}, []);\n'})}),"\n",(0,r.jsxs)(e.ol,{start:"2",children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u89C6\u9891\u5143\u7D20\u590D\u7528"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// \u2705 \u63A8\u8350\uFF1A\u590D\u7528\u89C6\u9891\u5143\u7D20\nlet videoElement: HTMLVideoElement | null = null;\n\nfunction getOrCreateVideo() {\n  if (!videoElement) {\n    videoElement = document.createElement("video");\n    videoElement.id = "video_dom";\n    // ... \u5176\u4ED6\u914D\u7F6E\n  }\n  return videoElement;\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"hls-\u6D41\u4F18\u5316",children:"HLS \u6D41\u4F18\u5316"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"HLS \u914D\u7F6E\u4F18\u5316"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:"// \u4F18\u5316HLS\u914D\u7F6E\u4EE5\u63D0\u5347\u6027\u80FD\nconst hls = new Hls({\n  maxBufferLength: 10,        // \u6700\u5927\u7F13\u51B2\u957F\u5EA6\uFF08\u79D2\uFF09\n  maxMaxBufferLength: 20,     // \u6700\u5927\u7F13\u51B2\u957F\u5EA6\u4E0A\u9650\n  maxBufferSize: 60 * 1000 * 1000,  // \u6700\u5927\u7F13\u51B2\u5927\u5C0F(\u5B57\u8282)\n  maxBufferHole: 0.5,         // \u6700\u5927\u7F13\u51B2\u95F4\u9699\n  lowLatencyMode: true,       // \u4F4E\u5EF6\u8FDF\u6A21\u5F0F\n  backBufferLength: 10,       // \u540E\u53F0\u7F13\u51B2\u957F\u5EA6\n});\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"2",children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u9519\u8BEF\u5904\u7406\u548C\u91CD\u8FDE"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'hls.on(Hls.Events.ERROR, (event, data) => {\n  if (data.fatal) {\n    switch (data.type) {\n      case Hls.ErrorTypes.NETWORK_ERROR:\n        console.log("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u5C1D\u8BD5\u6062\u590D");\n        hls.startLoad();\n        break;\n      case Hls.ErrorTypes.MEDIA_ERROR:\n        console.log("\u5A92\u4F53\u9519\u8BEF\uFF0C\u5C1D\u8BD5\u6062\u590D");\n        hls.recoverMediaError();\n        break;\n      default:\n        console.log("\u65E0\u6CD5\u6062\u590D\u7684\u9519\u8BEF");\n        hls.destroy();\n        break;\n    }\n  }\n});\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u7740\u8272\u5668\u4F18\u5316",children:"\u7740\u8272\u5668\u4F18\u5316"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u7B80\u5316\u7740\u8272\u5668\u4EE3\u7801"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:"// \u2705 \u63A8\u8350\uFF1A\u7B80\u5316\u7684\u7740\u8272\u5668\nconst simpleSource = `\nczm_material czm_getMaterial(czm_materialInput materialInput) {\n  czm_material material = czm_getDefaultMaterial(materialInput);\n  vec4 color = texture(image, materialInput.st);\n  material.diffuse = color.rgb;\n  material.alpha = color.a;\n  return material;\n}`;\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"2",children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.strong,{children:"\u907F\u514D\u4E0D\u5FC5\u8981\u7684\u8BA1\u7B97"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:"// \u274C \u907F\u514D\uFF1A\u5728\u7740\u8272\u5668\u4E2D\u8FDB\u884C\u590D\u6742\u8BA1\u7B97\n// \u2705 \u63A8\u8350\uFF1A\u5728CPU\u7AEF\u9884\u8BA1\u7B97\uFF0C\u901A\u8FC7uniform\u4F20\u9012\nmaterial.uniforms.precomputedValue = calculateValue();\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u5E38\u89C1\u95EE\u9898",children:"\u5E38\u89C1\u95EE\u9898"}),"\n",(0,r.jsx)(e.h3,{id:"\u89C6\u9891\u4E0D\u663E\u793A",children:"\u89C6\u9891\u4E0D\u663E\u793A"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u539F\u56E0"}),"\uFF1A\u89C6\u9891\u672A\u52A0\u8F7D\u5B8C\u6210\u3001\u8DE8\u57DF\u95EE\u9898\u3001\u6216\u6750\u8D28\u914D\u7F6E\u9519\u8BEF\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// 1. \u786E\u4FDD\u89C6\u9891\u52A0\u8F7D\u5B8C\u6210\nvideo.addEventListener("loadedmetadata", () => {\n  console.log("\u89C6\u9891\u5143\u6570\u636E\u5DF2\u52A0\u8F7D");\n  createVideoProjection();\n});\n\n// 2. \u68C0\u67E5\u8DE8\u57DF\u8BBE\u7F6E\nvideo.crossOrigin = "anonymous";\n\n// 3. \u786E\u4FDD\u89C6\u9891\u5143\u7D20\u6B63\u786E\u5173\u8054\nconst videoElement = document.getElementById("video_dom");\nif (!videoElement) {\n  console.error("\u89C6\u9891\u5143\u7D20\u672A\u627E\u5230");\n}\n\n// 4. \u68C0\u67E5\u6750\u8D28\u914D\u7F6E\nmaterial.uniforms.image = videoElement;\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u89C6\u9891\u64AD\u653E\u5361\u987F",children:"\u89C6\u9891\u64AD\u653E\u5361\u987F"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u539F\u56E0"}),"\uFF1A\u89C6\u9891\u7801\u7387\u8FC7\u9AD8\u3001\u7F13\u51B2\u4E0D\u8DB3\u3001\u6216\u6E32\u67D3\u6027\u80FD\u95EE\u9898\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:"// 1. \u964D\u4F4E\u89C6\u9891\u5206\u8FA8\u7387\u548C\u7801\u7387\n// \u4F7F\u7528\u5DE5\u5177\u538B\u7F29\u89C6\u9891\uFF0C\u63A8\u8350\u5206\u8FA8\u7387: 1280x720\n\n// 2. \u589E\u52A0\u7F13\u51B2\nif (Hls.isSupported()) {\n  const hls = new Hls({\n    maxBufferLength: 30,\n    maxMaxBufferLength: 60,\n  });\n}\n\n// 3. \u76D1\u63A7\u6027\u80FD\nviewer.scene.debugShowFramesPerSecond = true;\n\n// 4. \u51CF\u5C11\u6295\u5F71\u6570\u91CF\nif (fps < 30) {\n  reduceProjectionCount();\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"hls-\u6D41\u65E0\u6CD5\u64AD\u653E",children:"HLS \u6D41\u65E0\u6CD5\u64AD\u653E"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u539F\u56E0"}),"\uFF1A\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u3001\u6D41\u5730\u5740\u9519\u8BEF\u3001\u6216\u7F51\u7EDC\u95EE\u9898\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// 1. \u68C0\u67E5\u6D4F\u89C8\u5668\u652F\u6301\nif (!Hls.isSupported()) {\n  if (video.canPlayType("application/vnd.apple.mpegurl")) {\n    // Safari\u539F\u751F\u652F\u6301\n    video.src = hlsUrl;\n  } else {\n    console.error("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301HLS");\n  }\n}\n\n// 2. \u9A8C\u8BC1\u6D41\u5730\u5740\nfetch(hlsUrl)\n  .then(response => {\n    if (!response.ok) {\n      console.error("\u6D41\u5730\u5740\u65E0\u6548");\n    }\n  })\n  .catch(error => {\n    console.error("\u7F51\u7EDC\u9519\u8BEF:", error);\n  });\n\n// 3. \u6DFB\u52A0\u9519\u8BEF\u5904\u7406\nhls.on(Hls.Events.ERROR, (event, data) => {\n  console.error("HLS\u9519\u8BEF:", data);\n  if (data.fatal) {\n    handleFatalError(data);\n  }\n});\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u89C6\u9525\u4F53\u663E\u793A\u4E0D\u6B63\u786E",children:"\u89C6\u9525\u4F53\u663E\u793A\u4E0D\u6B63\u786E"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u539F\u56E0"}),"\uFF1A\u76F8\u673A\u53C2\u6570\u8BBE\u7F6E\u9519\u8BEF\u3001\u5750\u6807\u7CFB\u7EDF\u95EE\u9898\u3001\u6216\u89C6\u89D2\u8BA1\u7B97\u9519\u8BEF\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// 1. \u9A8C\u8BC1\u5750\u6807\nconsole.log("\u89C2\u5BDF\u70B9:", viewPosition);\nconsole.log("\u89C2\u5BDF\u7EC8\u70B9:", viewPositionEnd);\n\n// 2. \u68C0\u67E5\u8DDD\u79BB\nconst distance = Cartesian3.distance(viewPosition, viewPositionEnd);\nconsole.log("\u8DDD\u79BB:", distance);\nif (distance < 1 || distance > 10000) {\n  console.warn("\u8DDD\u79BB\u53EF\u80FD\u4E0D\u5408\u7406");\n}\n\n// 3. \u8C03\u6574\u89C6\u89D2\u53C2\u6570\nconst config = {\n  horizontalViewAngle: 60,  // \u5C1D\u8BD5\u4E0D\u540C\u7684\u89D2\u5EA6\n  verticalViewAngle: 40,\n};\n\n// 4. \u786E\u4FDD\u76F8\u673A\u8BBE\u7F6E\u6B63\u786E\nlightCamera.frustum.near = distance * 0.0001;\nlightCamera.frustum.far = distance;\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u5185\u5B58\u6CC4\u6F0F",children:"\u5185\u5B58\u6CC4\u6F0F"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u539F\u56E0"}),"\uFF1A\u89C6\u9891\u5143\u7D20\u672A\u6E05\u7406\u3001\u4E8B\u4EF6\u76D1\u542C\u5668\u672A\u79FB\u9664\u3001\u6216 Primitive \u672A\u9500\u6BC1\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// \u5B8C\u6574\u7684\u6E05\u7406\u6D41\u7A0B\nconst cleanup = () => {\n  // 1. \u6E05\u7406HLS\n  if (hls && !hls.destroyed) {\n    hls.destroy();\n    hls = null;\n  }\n\n  // 2. \u6E05\u7406\u89C6\u9891\u5143\u7D20\n  if (videoElement) {\n    videoElement.pause();\n    videoElement.removeAttribute("src");\n    videoElement.load();\n\n    // \u79FB\u9664\u6240\u6709\u4E8B\u4EF6\u76D1\u542C\u5668\n    const newVideo = videoElement.cloneNode(true);\n    videoElement.parentNode?.replaceChild(newVideo, videoElement);\n\n    videoElement.remove();\n    videoElement = null;\n  }\n\n  // 3. \u6E05\u7406 Primitives\n  primitives.forEach(primitive => {\n    if (!primitive.isDestroyed()) {\n      viewer.scene.primitives.remove(primitive);\n      primitive.destroy();\n    }\n  });\n  primitives = [];\n\n  // 4. \u6E05\u7406\u5B9E\u4F53\n  viewer.entities.removeAll();\n};\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u89C6\u9891\u65CB\u8F6C\u95EE\u9898",children:"\u89C6\u9891\u65CB\u8F6C\u95EE\u9898"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u539F\u56E0"}),"\uFF1A\u89C6\u9891\u65B9\u5411\u4E0D\u6B63\u786E\uFF0C\u9700\u8981\u65CB\u8F6C\u6216\u7FFB\u8F6C\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// 1. CSS\u65CB\u8F6C\nvideo.style.transform = "rotate(180deg)";\n\n// 2. \u4F7F\u7528 canvas \u5904\u7406\nconst canvas = document.createElement("canvas");\nconst ctx = canvas.getContext("2d");\ncanvas.width = video.videoWidth;\ncanvas.height = video.videoHeight;\n\nfunction drawRotatedVideo() {\n  ctx.save();\n  ctx.translate(canvas.width / 2, canvas.height / 2);\n  ctx.rotate(Math.PI); // \u65CB\u8F6C180\u5EA6\n  ctx.drawImage(video, -video.videoWidth / 2, -video.videoHeight / 2);\n  ctx.restore();\n}\n\n// \u4F7F\u7528canvas\u4F5C\u4E3A\u7EB9\u7406\nmaterial.uniforms.image = canvas;\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u8DE8\u57DF\u95EE\u9898",children:"\u8DE8\u57DF\u95EE\u9898"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u539F\u56E0"}),"\uFF1A\u89C6\u9891\u670D\u52A1\u5668\u672A\u8BBE\u7F6E\u6B63\u786E\u7684 CORS \u5934\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:'// 1. \u8BBE\u7F6E crossOrigin\nvideo.crossOrigin = "anonymous";\n\n// 2. \u670D\u52A1\u5668\u7AEF\u8BBE\u7F6E CORS \u5934\n// Access-Control-Allow-Origin: *\n// Access-Control-Allow-Methods: GET, OPTIONS\n\n// 3. \u4F7F\u7528\u4EE3\u7406\nconst proxyUrl = "/api/video-proxy?url=" + encodeURIComponent(videoUrl);\nvideo.src = proxyUrl;\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u6CE8\u610F\u4E8B\u9879",children:"\u6CE8\u610F\u4E8B\u9879"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6D4F\u89C8\u5668\u517C\u5BB9\u6027"}),"\uFF1AHLS.js \u9700\u8981\u652F\u6301 Media Source Extensions \u7684\u6D4F\u89C8\u5668\uFF0CSafari \u539F\u751F\u652F\u6301 HLS"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u89C6\u9891\u683C\u5F0F"}),"\uFF1A\u63A8\u8350\u4F7F\u7528 H.264 \u7F16\u7801\u7684 MP4 \u683C\u5F0F\uFF0C\u786E\u4FDD\u6D4F\u89C8\u5668\u517C\u5BB9\u6027"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u8DE8\u57DF\u8BBE\u7F6E"}),"\uFF1A\u52A0\u8F7D\u8DE8\u57DF\u89C6\u9891\u65F6\u5FC5\u987B\u8BBE\u7F6E ",(0,r.jsx)(e.code,{children:'crossOrigin="anonymous"'})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u81EA\u52A8\u64AD\u653E\u7B56\u7565"}),"\uFF1A\u73B0\u4EE3\u6D4F\u89C8\u5668\u9650\u5236\u81EA\u52A8\u64AD\u653E\uFF0C\u9700\u8981\u8BBE\u7F6E ",(0,r.jsx)(e.code,{children:"muted=true"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u8D44\u6E90\u6E05\u7406"}),"\uFF1A\u7EC4\u4EF6\u5378\u8F7D\u65F6\u52A1\u5FC5\u6E05\u7406\u89C6\u9891\u5143\u7D20\u3001HLS \u5B9E\u4F8B\u548C Primitive"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6027\u80FD\u8003\u8651"}),"\uFF1A\u907F\u514D\u540C\u65F6\u521B\u5EFA\u8FC7\u591A\u89C6\u9891\u6295\u5F71\uFF0C\u5EFA\u8BAE\u4E0D\u8D85\u8FC7 5 \u4E2A"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u89C6\u9891\u5206\u8FA8\u7387"}),"\uFF1A\u5EFA\u8BAE\u4F7F\u7528 1280x720 \u6216\u66F4\u4F4E\u7684\u5206\u8FA8\u7387\uFF0C\u907F\u514D\u6027\u80FD\u95EE\u9898"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6DF1\u5EA6\u68C0\u6D4B"}),"\uFF1A\u542F\u7528 ",(0,r.jsx)(e.code,{children:"depthTestAgainstTerrain"})," \u786E\u4FDD\u6295\u5F71\u6B63\u786E\u906E\u6321\u5730\u5F62"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u89C6\u9525\u4F53\u53C2\u6570"}),"\uFF1A\u5408\u7406\u8BBE\u7F6E ",(0,r.jsx)(e.code,{children:"near"})," \u548C ",(0,r.jsx)(e.code,{children:"far"})," \u53C2\u6570\uFF0C\u907F\u514D\u89C6\u9525\u4F53\u8FC7\u5927\u6216\u8FC7\u5C0F"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u76F4\u64AD\u5EF6\u8FDF"}),"\uFF1AHLS \u6D41\u901A\u5E38\u6709 3-10 \u79D2\u5EF6\u8FDF\uFF0C\u53EF\u542F\u7528\u4F4E\u5EF6\u8FDF\u6A21\u5F0F\u4F18\u5316"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u53C2\u8003\u8D44\u6599",children:"\u53C2\u8003\u8D44\u6599"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://cesium.com/learn/cesiumjs/ref-doc/Material.html",children:"Cesium Material API"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://cesium.com/learn/cesiumjs/ref-doc/FrustumGeometry.html",children:"Cesium FrustumGeometry API"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://cesium.com/learn/cesiumjs/ref-doc/Primitive.html",children:"Cesium Primitive API"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/video-dev/hls.js/",children:"HLS.js Documentation"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/jiawanlong/Cesium-Examples",children:"Cesium Examples"})}),"\n"]})]})}function x(n={}){let{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(v,{...n})}):v(n)}}}]);