"use strict";(self.webpackChunkanch=self.webpackChunkanch||[]).push([["3020"],{38934(e,n,t){t.r(n),t.d(n,{metadata:()=>s,default:()=>v,frontMatter:()=>d,contentTitle:()=>h,toc:()=>x,assets:()=>u});var s=JSON.parse('{"id":"web/canvas/text-controller","title":"\u6587\u672C\u63A7\u5236\u5668","description":"TextController \u662F\u4E00\u4E2A\u6846\u67B6\u65E0\u5173\u7684 Canvas \u6587\u672C\u6E32\u67D3\u548C\u4EA4\u4E92\u63A7\u5236\u5668\uFF0C\u7528\u4E8E\u5728 Canvas \u4E0A\u7ED8\u5236\u53EF\u62D6\u62FD\u7684\u6587\u672C\u9879\u3002","source":"@site/docs/web/canvas/03-text-controller.mdx","sourceDirName":"web/canvas","slug":"/web/canvas/text-controller","permalink":"/web/canvas/text-controller","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"semantic-release-bot","lastUpdatedAt":1768553784000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"\u6587\u672C\u63A7\u5236\u5668"},"sidebar":"webSidebar","previous":{"title":"\u661F\u7A7A\u7C92\u5B50","permalink":"/web/canvas/particle-stars"},"next":{"title":"\u5E95\u56FE","permalink":"/web/cesium/basic/01"}}'),r=t(35656),l=t(56610),i=t(57140),o=t(82044);class c{ctx=null;canvasWidth=0;canvasHeight=0;color;items;onItemsChange;dragState={itemId:null,offset:{x:0,y:0}};selectedItemId=null;tempDragPosition=null;cursorStyle="default";fontSize=14;padding=4;constructor(e={}){this.color=e.color||[0,0,0,1],this.items=e.items||[],this.onItemsChange=e.onItemsChange}setCanvas(e,n,t){this.ctx=e,this.canvasWidth=n,this.canvasHeight=t}setColor(e){this.color=[...e]}setItems(e){this.items=e.map(e=>({...e}))}getItems(){return this.items.map(e=>({...e}))}getSize(){return{width:this.canvasWidth,height:this.canvasHeight}}getCursorStyle(){return this.cursorStyle}getSelectedItemId(){return this.selectedItemId}render(){this.ctx&&(this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.items.forEach(e=>{if(e.text){let n=this.getDraggedPosition(e.id,e.position),t=this.selectedItemId===e.id;this.drawTextItem(e.text,n,t)}}))}getDraggedPosition(e,n){return this.tempDragPosition&&this.dragState.itemId===e?this.tempDragPosition:n}drawTextItem(e,n,t){if(!this.ctx)return;this.ctx.font=`normal ${this.fontSize}px sans-serif`;let s=this.ctx.measureText(e).width,r=this.fontSize;this.ctx.fillStyle="transparent",this.ctx.fillRect(n.x,n.y,s+2*this.padding,r+2*this.padding),this.ctx.fillStyle=this.colorToRgba(this.color),this.ctx.textAlign="left",this.ctx.textBaseline="top",this.ctx.fillText(e,n.x+this.padding,n.y+this.padding),this.ctx.strokeStyle=this.colorToRgba(this.color),this.ctx.lineWidth=1,this.ctx.strokeRect(n.x,n.y,s+2*this.padding,r+2*this.padding)}handleMouseDown(e,n){let t=this.clampPoint({x:e,y:n}),s=this.findClickedItem(t.x,t.y);if(s){this.selectedItemId=s.id,this.dragState={itemId:s.id,offset:{x:t.x-s.position.x,y:t.y-s.position.y}},this.tempDragPosition={...s.position};return}this.selectedItemId=null,this.dragState={itemId:null,offset:{x:0,y:0}},this.tempDragPosition=null}handleMouseMove(e,n){if(this.updateCursorStyle(e,n),null!==this.dragState.itemId){let t=this.items.find(e=>e.id===this.dragState.itemId);if(t?.text){let s=e-this.dragState.offset.x,r=n-this.dragState.offset.y,l=this.getTextBounds(t.text,{x:s,y:r});if(l){let e=Math.max(0,Math.min(this.canvasWidth-l.width,s)),n=Math.max(0,Math.min(this.canvasHeight-l.height,r));this.tempDragPosition={x:e,y:n},this.render()}}}}handleMouseUp(){if(null!==this.dragState.itemId&&this.tempDragPosition){let e=this.items.map(e=>e.id===this.dragState.itemId?{...e,position:{...this.tempDragPosition}}:e);this.items=e,this.onItemsChange?.(this.getItems())}this.dragState={itemId:null,offset:{x:0,y:0}},this.tempDragPosition=null}handleMouseLeave(){this.handleMouseUp()}updateCursorStyle(e,n){if(null!==this.dragState.itemId){this.cursorStyle="grabbing";return}if(null!==this.findClickedItem(e,n)){this.cursorStyle="grab";return}this.cursorStyle="default"}findClickedItem(e,n){for(let t of this.items){if(!t.text)continue;let s=this.getTextBounds(t.text,t.position);if(s&&this.isPointInBounds({x:e,y:n},s))return t}return null}getTextBounds(e,n){if(!this.ctx)return null;this.ctx.font=`normal ${this.fontSize}px sans-serif`;let t=this.ctx.measureText(e).width,s=this.fontSize;return{x:n.x,y:n.y,width:t+2*this.padding,height:s+2*this.padding}}isPointInBounds(e,n){return e.x>=n.x&&e.x<=n.x+n.width&&e.y>=n.y&&e.y<=n.y+n.height}clampPoint(e){return{x:Math.max(0,Math.min(this.canvasWidth,e.x)),y:Math.max(0,Math.min(this.canvasHeight,e.y))}}colorToRgba(e){return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}destroy(){this.ctx=null,this.dragState={itemId:null,offset:{x:0,y:0}},this.tempDragPosition=null}}function a(){let e=(0,i.useRef)(null),n=(0,i.useRef)(null),[t,s]=(0,i.useState)([{id:1,text:"Hello",position:{x:10,y:10}},{id:2,text:"World",position:{x:10,y:30}},{id:3,text:"Three",position:{x:10,y:50}},{id:4,text:"Four",position:{x:10,y:70}},{id:5,text:"Five",position:{x:10,y:90}},{id:6,text:"Six",position:{x:10,y:110}},{id:7,text:"Seven",position:{x:10,y:130}},{id:8,text:"Eight",position:{x:10,y:150}}]);return(0,i.useEffect)(()=>{let r=e.current;if(!r)return;let l=r.getContext("2d");if(!l)return;let i=new c({items:t,onItemsChange:s});return i.setCanvas(l,r.width,r.height),i.render(),n.current=i,()=>i.destroy()},[t]),(0,i.useEffect)(()=>{n.current&&(n.current.setItems(t),n.current.render())},[t]),(0,r.jsx)(o.A,{children:(0,r.jsx)("canvas",{ref:e,width:800,height:600,onMouseDown:t=>{let s=e.current;if(!s||!n.current)return;let r=s.getBoundingClientRect();n.current.handleMouseDown(t.clientX-r.left,t.clientY-r.top),n.current.render()},onMouseMove:t=>{let s=e.current;if(!s||!n.current)return;let r=s.getBoundingClientRect();n.current.handleMouseMove(t.clientX-r.left,t.clientY-r.top)},onMouseUp:()=>{n.current&&(n.current.handleMouseUp(),n.current.render())},style:{cursor:n.current?.getCursorStyle()||"default"}})})}let d={sidebar_position:3,title:"\u6587\u672C\u63A7\u5236\u5668"},h="Text Controller",u={},x=[{value:"\u7279\u6027",id:"\u7279\u6027",level:2},{value:"\u4F7F\u7528",id:"\u4F7F\u7528",level:2},{value:"\u6838\u5FC3\u6982\u5FF5",id:"\u6838\u5FC3\u6982\u5FF5",level:2},{value:"TextItem",id:"textitem",level:3},{value:"\u53D7\u63A7\u6A21\u5F0F",id:"\u53D7\u63A7\u6A21\u5F0F",level:3},{value:"API \u6587\u6863",id:"api-\u6587\u6863",level:2},{value:"\u6784\u9020\u51FD\u6570",id:"\u6784\u9020\u51FD\u6570",level:3},{value:"\u6838\u5FC3\u65B9\u6CD5",id:"\u6838\u5FC3\u65B9\u6CD5",level:3},{value:"setCanvas()",id:"setcanvas",level:4},{value:"setItems()",id:"setitems",level:4},{value:"render()",id:"render",level:4},{value:"\u4EA4\u4E92\u65B9\u6CD5",id:"\u4EA4\u4E92\u65B9\u6CD5",level:3},{value:"handleMouseDown()",id:"handlemousedown",level:4},{value:"handleMouseMove()",id:"handlemousemove",level:4},{value:"handleMouseUp()",id:"handlemouseup",level:4},{value:"\u5DE5\u5177\u65B9\u6CD5",id:"\u5DE5\u5177\u65B9\u6CD5",level:3},{value:"setColor()",id:"setcolor",level:4},{value:"getItems()",id:"getitems",level:4},{value:"getCursorStyle()",id:"getcursorstyle",level:4},{value:"destroy()",id:"destroy",level:4},{value:"\u4F7F\u7528\u793A\u4F8B",id:"\u4F7F\u7528\u793A\u4F8B",level:2},{value:"\u57FA\u7840\u7528\u6CD5",id:"\u57FA\u7840\u7528\u6CD5",level:3},{value:"\u54CD\u5E94\u5F0F\u66F4\u65B0",id:"\u54CD\u5E94\u5F0F\u66F4\u65B0",level:3},{value:"\u6846\u67B6\u96C6\u6210\u793A\u4F8B",id:"\u6846\u67B6\u96C6\u6210\u793A\u4F8B",level:2},{value:"Svelte \u96C6\u6210",id:"svelte-\u96C6\u6210",level:3},{value:"React \u96C6\u6210",id:"react-\u96C6\u6210",level:3},{value:"Vue \u96C6\u6210",id:"vue-\u96C6\u6210",level:3},{value:"\u6700\u4F73\u5B9E\u8DF5",id:"\u6700\u4F73\u5B9E\u8DF5",level:2},{value:"1. \u6027\u80FD\u4F18\u5316",id:"1-\u6027\u80FD\u4F18\u5316",level:3},{value:"\u907F\u514D\u9891\u7E41\u6E32\u67D3",id:"\u907F\u514D\u9891\u7E41\u6E32\u67D3",level:4},{value:"\u4F7F\u7528 requestAnimationFrame",id:"\u4F7F\u7528-requestanimationframe",level:4},{value:"2. \u5185\u5B58\u7BA1\u7406",id:"2-\u5185\u5B58\u7BA1\u7406",level:3},{value:"\u53CA\u65F6\u9500\u6BC1\u63A7\u5236\u5668",id:"\u53CA\u65F6\u9500\u6BC1\u63A7\u5236\u5668",level:4},{value:"3. \u5750\u6807\u8F6C\u6362",id:"3-\u5750\u6807\u8F6C\u6362",level:3},{value:"\u6B63\u786E\u5904\u7406 Canvas \u5750\u6807",id:"\u6B63\u786E\u5904\u7406-canvas-\u5750\u6807",level:4},{value:"\u5904\u7406\u9AD8 DPI \u5C4F\u5E55",id:"\u5904\u7406\u9AD8-dpi-\u5C4F\u5E55",level:4},{value:"4. \u72B6\u6001\u7BA1\u7406",id:"4-\u72B6\u6001\u7BA1\u7406",level:3},{value:"\u4F7F\u7528\u53D7\u63A7\u6A21\u5F0F",id:"\u4F7F\u7528\u53D7\u63A7\u6A21\u5F0F",level:4},{value:"\u5E38\u89C1\u95EE\u9898",id:"\u5E38\u89C1\u95EE\u9898",level:2},{value:"Q: \u4E3A\u4EC0\u4E48\u62D6\u62FD\u65F6\u6587\u672C\u4F4D\u7F6E\u4E0D\u66F4\u65B0\uFF1F",id:"q-\u4E3A\u4EC0\u4E48\u62D6\u62FD\u65F6\u6587\u672C\u4F4D\u7F6E\u4E0D\u66F4\u65B0",level:3},{value:"Q: \u5982\u4F55\u5904\u7406 Canvas \u5C3A\u5BF8\u53D8\u5316\uFF1F",id:"q-\u5982\u4F55\u5904\u7406-canvas-\u5C3A\u5BF8\u53D8\u5316",level:3},{value:"Q: \u5149\u6807\u6837\u5F0F\u4E0D\u66F4\u65B0\u600E\u4E48\u529E\uFF1F",id:"q-\u5149\u6807\u6837\u5F0F\u4E0D\u66F4\u65B0\u600E\u4E48\u529E",level:3},{value:"Q: \u5982\u4F55\u5B9E\u73B0\u6587\u672C\u9879\u7684\u5220\u9664\u529F\u80FD\uFF1F",id:"q-\u5982\u4F55\u5B9E\u73B0\u6587\u672C\u9879\u7684\u5220\u9664\u529F\u80FD",level:3},{value:"Q: \u5982\u4F55\u5B9E\u73B0\u64A4\u9500/\u91CD\u505A\u529F\u80FD\uFF1F",id:"q-\u5982\u4F55\u5B9E\u73B0\u64A4\u9500\u91CD\u505A\u529F\u80FD",level:3},{value:"\u9AD8\u7EA7\u7528\u6CD5",id:"\u9AD8\u7EA7\u7528\u6CD5",level:2},{value:"1. \u81EA\u5B9A\u4E49\u6E32\u67D3\u6837\u5F0F",id:"1-\u81EA\u5B9A\u4E49\u6E32\u67D3\u6837\u5F0F",level:3},{value:"2. \u5750\u6807\u5F52\u4E00\u5316",id:"2-\u5750\u6807\u5F52\u4E00\u5316",level:3},{value:"\u6545\u969C\u6392\u67E5",id:"\u6545\u969C\u6392\u67E5",level:2},{value:"\u6587\u672C\u4E0D\u663E\u793A",id:"\u6587\u672C\u4E0D\u663E\u793A",level:3},{value:"\u62D6\u62FD\u4E0D\u6D41\u7545",id:"\u62D6\u62FD\u4E0D\u6D41\u7545",level:3},{value:"\u5185\u5B58\u6CC4\u6F0F",id:"\u5185\u5B58\u6CC4\u6F0F",level:3}];function m(e){let n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"text-controller",children:"Text Controller"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"TextController"})," \u662F\u4E00\u4E2A\u6846\u67B6\u65E0\u5173\u7684 Canvas \u6587\u672C\u6E32\u67D3\u548C\u4EA4\u4E92\u63A7\u5236\u5668\uFF0C\u7528\u4E8E\u5728 Canvas \u4E0A\u7ED8\u5236\u53EF\u62D6\u62FD\u7684\u6587\u672C\u9879\u3002"]}),"\n",(0,r.jsx)(a,{}),"\n",(0,r.jsx)(n.h2,{id:"\u7279\u6027",children:"\u7279\u6027"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"\u6846\u67B6\u65E0\u5173"}),"\uFF1A\u7EAF TypeScript \u5B9E\u73B0\uFF0C\u53EF\u5728\u4EFB\u4F55 JavaScript \u73AF\u5883\u4E2D\u4F7F\u7528"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"\u4EA4\u4E92\u5F0F"}),"\uFF1A\u652F\u6301\u6587\u672C\u9879\u7684\u62D6\u62FD\u3001\u9009\u62E9\u3001\u8FB9\u754C\u68C0\u6D4B"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"\u9AD8\u6027\u80FD"}),"\uFF1A\u62D6\u62FD\u65F6\u4F7F\u7528\u4E34\u65F6\u72B6\u6001\uFF0C\u51CF\u5C11\u4E0D\u5FC5\u8981\u7684\u56DE\u8C03"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"\u7C7B\u578B\u5B89\u5168"}),"\uFF1A\u5B8C\u6574\u7684 TypeScript \u7C7B\u578B\u5B9A\u4E49"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"\u6613\u4E8E\u96C6\u6210"}),"\uFF1A\u7B80\u6D01\u7684 API \u8BBE\u8BA1\uFF0C\u6613\u4E8E\u4E0E\u4EFB\u4F55 UI \u6846\u67B6\u96C6\u6210"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u4F7F\u7528",children:"\u4F7F\u7528"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { TextController, type TextItem, type Color } from './text-controller';\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6838\u5FC3\u6982\u5FF5",children:"\u6838\u5FC3\u6982\u5FF5"}),"\n",(0,r.jsx)(n.h3,{id:"textitem",children:"TextItem"}),"\n",(0,r.jsx)(n.p,{children:"\u6587\u672C\u9879\u662F\u63A7\u5236\u5668\u5904\u7406\u7684\u57FA\u672C\u5355\u4F4D\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"type TextItem = {\n  id: string | number;  // \u552F\u4E00\u6807\u8BC6\n  text: string;         // \u6587\u672C\u5185\u5BB9\n  position: Point;      // \u4F4D\u7F6E\u5750\u6807\n};\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u53D7\u63A7\u6A21\u5F0F",children:"\u53D7\u63A7\u6A21\u5F0F"}),"\n",(0,r.jsx)(n.p,{children:"\u63A7\u5236\u5668\u91C7\u7528\u53D7\u63A7\u6A21\u5F0F\u8BBE\u8BA1\uFF1A"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5916\u90E8\u901A\u8FC7 ",(0,r.jsx)(n.code,{children:"setItems()"})," \u8BBE\u7F6E\u6587\u672C\u9879"]}),"\n",(0,r.jsxs)(n.li,{children:["\u62D6\u62FD\u7ED3\u675F\u65F6\u901A\u8FC7 ",(0,r.jsx)(n.code,{children:"onItemsChange"})," \u56DE\u8C03\u901A\u77E5\u5916\u90E8"]}),"\n",(0,r.jsx)(n.li,{children:"\u62D6\u62FD\u8FC7\u7A0B\u4E2D\u4F7F\u7528\u5185\u90E8\u4E34\u65F6\u72B6\u6001\uFF0C\u4E0D\u89E6\u53D1\u56DE\u8C03\uFF08\u6027\u80FD\u4F18\u5316\uFF09"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"api-\u6587\u6863",children:"API \u6587\u6863"}),"\n",(0,r.jsx)(n.h3,{id:"\u6784\u9020\u51FD\u6570",children:"\u6784\u9020\u51FD\u6570"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const controller = new TextController({\n  color?: Color;                      // \u6587\u672C\u989C\u8272\uFF0C\u9ED8\u8BA4 [0, 0, 0, 1]\n  items?: TextItem[];                 // \u521D\u59CB\u6587\u672C\u9879\u5217\u8868\n  onItemsChange?: (items: TextItem[]) => void;  // \u503C\u53D8\u5316\u56DE\u8C03\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u6838\u5FC3\u65B9\u6CD5",children:"\u6838\u5FC3\u65B9\u6CD5"}),"\n",(0,r.jsx)(n.h4,{id:"setcanvas",children:"setCanvas()"}),"\n",(0,r.jsx)(n.p,{children:"\u8BBE\u7F6E Canvas \u4E0A\u4E0B\u6587\u548C\u5C3A\u5BF8\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"controller.setCanvas(\n  ctx: CanvasRenderingContext2D,\n  width: number,\n  height: number\n): void\n"})}),"\n",(0,r.jsx)(n.h4,{id:"setitems",children:"setItems()"}),"\n",(0,r.jsx)(n.p,{children:"\u66F4\u65B0\u6587\u672C\u9879\u5217\u8868\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"controller.setItems(items: TextItem[]): void\n"})}),"\n",(0,r.jsx)(n.h4,{id:"render",children:"render()"}),"\n",(0,r.jsx)(n.p,{children:"\u6E32\u67D3\u6240\u6709\u6587\u672C\u9879\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"controller.render(): void\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4EA4\u4E92\u65B9\u6CD5",children:"\u4EA4\u4E92\u65B9\u6CD5"}),"\n",(0,r.jsx)(n.h4,{id:"handlemousedown",children:"handleMouseDown()"}),"\n",(0,r.jsx)(n.p,{children:"\u5904\u7406\u9F20\u6807\u6309\u4E0B\u4E8B\u4EF6\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"controller.handleMouseDown(x: number, y: number): void\n"})}),"\n",(0,r.jsx)(n.h4,{id:"handlemousemove",children:"handleMouseMove()"}),"\n",(0,r.jsx)(n.p,{children:"\u5904\u7406\u9F20\u6807\u79FB\u52A8\u4E8B\u4EF6\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"controller.handleMouseMove(x: number, y: number): void\n"})}),"\n",(0,r.jsx)(n.h4,{id:"handlemouseup",children:"handleMouseUp()"}),"\n",(0,r.jsxs)(n.p,{children:["\u5904\u7406\u9F20\u6807\u677E\u5F00\u4E8B\u4EF6\uFF08\u62D6\u62FD\u7ED3\u675F\u65F6\u89E6\u53D1 ",(0,r.jsx)(n.code,{children:"onItemsChange"}),"\uFF09\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"controller.handleMouseUp(): void\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5DE5\u5177\u65B9\u6CD5",children:"\u5DE5\u5177\u65B9\u6CD5"}),"\n",(0,r.jsx)(n.h4,{id:"setcolor",children:"setColor()"}),"\n",(0,r.jsx)(n.p,{children:"\u66F4\u65B0\u6587\u672C\u989C\u8272\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"controller.setColor(color: Color): void\n"})}),"\n",(0,r.jsx)(n.h4,{id:"getitems",children:"getItems()"}),"\n",(0,r.jsx)(n.p,{children:"\u83B7\u53D6\u5F53\u524D\u6587\u672C\u9879\u5217\u8868\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"controller.getItems(): TextItem[]\n"})}),"\n",(0,r.jsx)(n.h4,{id:"getcursorstyle",children:"getCursorStyle()"}),"\n",(0,r.jsx)(n.p,{children:"\u83B7\u53D6\u5F53\u524D\u5149\u6807\u6837\u5F0F\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"controller.getCursorStyle(): string  // 'default' | 'grab' | 'grabbing'\n"})}),"\n",(0,r.jsx)(n.h4,{id:"destroy",children:"destroy()"}),"\n",(0,r.jsx)(n.p,{children:"\u9500\u6BC1\u63A7\u5236\u5668\uFF0C\u6E05\u7406\u8D44\u6E90\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"controller.destroy(): void\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u4F7F\u7528\u793A\u4F8B",children:"\u4F7F\u7528\u793A\u4F8B"}),"\n",(0,r.jsx)(n.h3,{id:"\u57FA\u7840\u7528\u6CD5",children:"\u57FA\u7840\u7528\u6CD5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// 1. \u521B\u5EFA\u63A7\u5236\u5668\nconst controller = new TextController({\n  color: [255, 255, 255, 1],\n  items: [\n    { id: 1, text: 'Hello World', position: { x: 10, y: 10 } },\n    { id: 2, text: 'Draggable Text', position: { x: 10, y: 50 } }\n  ],\n  onItemsChange: (items) => {\n    console.log('Items changed:', items);\n    // \u66F4\u65B0\u4F60\u7684\u72B6\u6001\u7BA1\u7406\n  }\n});\n\n// 2. \u83B7\u53D6 Canvas \u4E0A\u4E0B\u6587\nconst canvas = document.getElementById('myCanvas') as HTMLCanvasElement;\nconst ctx = canvas.getContext('2d');\n\n// 3. \u8BBE\u7F6E Canvas\ncontroller.setCanvas(ctx, canvas.width, canvas.height);\n\n// 4. \u6E32\u67D3\ncontroller.render();\n\n// 5. \u7ED1\u5B9A\u4E8B\u4EF6\ncanvas.addEventListener('mousedown', (e) => {\n  const rect = canvas.getBoundingClientRect();\n  controller.handleMouseDown(e.clientX - rect.left, e.clientY - rect.top);\n  controller.render();\n});\n\ncanvas.addEventListener('mousemove', (e) => {\n  const rect = canvas.getBoundingClientRect();\n  controller.handleMouseMove(e.clientX - rect.left, e.clientY - rect.top);\n});\n\ncanvas.addEventListener('mouseup', () => {\n  controller.handleMouseUp();\n  controller.render();\n});\n\n// 6. \u66F4\u65B0\u5149\u6807\u6837\u5F0F\ncanvas.style.cursor = controller.getCursorStyle();\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u54CD\u5E94\u5F0F\u66F4\u65B0",children:"\u54CD\u5E94\u5F0F\u66F4\u65B0"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// \u5F53\u5916\u90E8\u6570\u636E\u53D8\u5316\u65F6\uFF0C\u66F4\u65B0\u63A7\u5236\u5668\nfunction updateItems(newItems: TextItem[]) {\n  controller.setItems(newItems);\n  controller.render();\n}\n\n// \u5F53\u989C\u8272\u53D8\u5316\u65F6\nfunction updateColor(newColor: Color) {\n  controller.setColor(newColor);\n  controller.render();\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6846\u67B6\u96C6\u6210\u793A\u4F8B",children:"\u6846\u67B6\u96C6\u6210\u793A\u4F8B"}),"\n",(0,r.jsx)(n.h3,{id:"svelte-\u96C6\u6210",children:"Svelte \u96C6\u6210"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-svelte",children:"<script lang=\"ts\">\n  import { onMount } from 'svelte';\n  import { TextController, type TextItem } from './text-controller';\n\n  let canvasRef: HTMLCanvasElement;\n  let items = $state<TextItem[]>([\n    { id: 1, text: 'Hello', position: { x: 10, y: 10 } }\n  ]);\n\n  const controller = new TextController({\n    items,\n    onItemsChange: (newItems) => {\n      items = newItems;\n    }\n  });\n\n  onMount(() => {\n    const ctx = canvasRef.getContext('2d');\n    if (ctx) {\n      controller.setCanvas(ctx, canvasRef.width, canvasRef.height);\n      controller.render();\n    }\n    return () => controller.destroy();\n  });\n\n  // \u76D1\u542C items \u53D8\u5316\n  $effect(() => {\n    controller.setItems(items);\n    controller.render();\n  });\n<\/script>\n\n<canvas\n  bind:this={canvasRef}\n  width={800}\n  height={600}\n  onmousedown={(e) => {\n    const rect = canvasRef.getBoundingClientRect();\n    controller.handleMouseDown(e.clientX - rect.left, e.clientY - rect.top);\n    controller.render();\n  }}\n  onmousemove={(e) => {\n    const rect = canvasRef.getBoundingClientRect();\n    controller.handleMouseMove(e.clientX - rect.left, e.clientY - rect.top);\n  }}\n  onmouseup={() => {\n    controller.handleMouseUp();\n    controller.render();\n  }}\n/>\n"})}),"\n",(0,r.jsx)(n.h3,{id:"react-\u96C6\u6210",children:"React \u96C6\u6210"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { useEffect, useRef, useState } from 'react';\nimport { TextController, type TextItem } from './text-controller';\n\nfunction CanvasTextEditor() {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const controllerRef = useRef<TextController | null>(null);\n  const [items, setItems] = useState<TextItem[]>([\n    { id: 1, text: 'Hello', position: { x: 10, y: 10 } }\n  ]);\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    // \u521B\u5EFA\u63A7\u5236\u5668\n    const controller = new TextController({\n      items,\n      onItemsChange: setItems\n    });\n\n    controller.setCanvas(ctx, canvas.width, canvas.height);\n    controller.render();\n    controllerRef.current = controller;\n\n    return () => controller.destroy();\n  }, []);\n\n  // \u5F53 items \u53D8\u5316\u65F6\u66F4\u65B0\n  useEffect(() => {\n    if (controllerRef.current) {\n      controllerRef.current.setItems(items);\n      controllerRef.current.render();\n    }\n  }, [items]);\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    const canvas = canvasRef.current;\n    if (!canvas || !controllerRef.current) return;\n\n    const rect = canvas.getBoundingClientRect();\n    controllerRef.current.handleMouseDown(\n      e.clientX - rect.left,\n      e.clientY - rect.top\n    );\n    controllerRef.current.render();\n  };\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n    const canvas = canvasRef.current;\n    if (!canvas || !controllerRef.current) return;\n\n    const rect = canvas.getBoundingClientRect();\n    controllerRef.current.handleMouseMove(\n      e.clientX - rect.left,\n      e.clientY - rect.top\n    );\n  };\n\n  const handleMouseUp = () => {\n    if (controllerRef.current) {\n      controllerRef.current.handleMouseUp();\n      controllerRef.current.render();\n    }\n  };\n\n  return (\n    <canvas\n      ref={canvasRef}\n      width={800}\n      height={600}\n      onMouseDown={handleMouseDown}\n      onMouseMove={handleMouseMove}\n      onMouseUp={handleMouseUp}\n      style={{ cursor: controllerRef.current?.getCursorStyle() || 'default' }}\n    />\n  );\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"vue-\u96C6\u6210",children:"Vue \u96C6\u6210"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-vue",children:'<template>\n  <canvas\n    ref="canvasRef"\n    :width="800"\n    :height="600"\n    :style="{ cursor: cursorStyle }"\n    @mousedown="handleMouseDown"\n    @mousemove="handleMouseMove"\n    @mouseup="handleMouseUp"\n  />\n</template>\n\n<script setup lang="ts">\nimport { ref, onMounted, onUnmounted, watch } from \'vue\';\nimport { TextController, type TextItem } from \'./text-controller\';\n\nconst canvasRef = ref<HTMLCanvasElement | null>(null);\nconst cursorStyle = ref(\'default\');\nconst items = ref<TextItem[]>([\n  { id: 1, text: \'Hello\', position: { x: 10, y: 10 } }\n]);\n\nlet controller: TextController | null = null;\n\nonMounted(() => {\n  const canvas = canvasRef.value;\n  if (!canvas) return;\n\n  const ctx = canvas.getContext(\'2d\');\n  if (!ctx) return;\n\n  controller = new TextController({\n    items: items.value,\n    onItemsChange: (newItems) => {\n      items.value = newItems;\n    }\n  });\n\n  controller.setCanvas(ctx, canvas.width, canvas.height);\n  controller.render();\n});\n\nonUnmounted(() => {\n  controller?.destroy();\n});\n\n// \u76D1\u542C items \u53D8\u5316\nwatch(items, (newItems) => {\n  if (controller) {\n    controller.setItems(newItems);\n    controller.render();\n  }\n}, { deep: true });\n\n// \u76D1\u542C\u5149\u6807\u6837\u5F0F\u53D8\u5316\nwatch(() => controller?.getCursorStyle(), (style) => {\n  if (style) cursorStyle.value = style;\n});\n\nconst handleMouseDown = (e: MouseEvent) => {\n  const canvas = canvasRef.value;\n  if (!canvas || !controller) return;\n\n  const rect = canvas.getBoundingClientRect();\n  controller.handleMouseDown(e.clientX - rect.left, e.clientY - rect.top);\n  controller.render();\n  cursorStyle.value = controller.getCursorStyle();\n};\n\nconst handleMouseMove = (e: MouseEvent) => {\n  const canvas = canvasRef.value;\n  if (!canvas || !controller) return;\n\n  const rect = canvas.getBoundingClientRect();\n  controller.handleMouseMove(e.clientX - rect.left, e.clientY - rect.top);\n  cursorStyle.value = controller.getCursorStyle();\n};\n\nconst handleMouseUp = () => {\n  if (controller) {\n    controller.handleMouseUp();\n    controller.render();\n    cursorStyle.value = controller.getCursorStyle();\n  }\n};\n<\/script>\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6700\u4F73\u5B9E\u8DF5",children:"\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,r.jsx)(n.h3,{id:"1-\u6027\u80FD\u4F18\u5316",children:"1. \u6027\u80FD\u4F18\u5316"}),"\n",(0,r.jsx)(n.h4,{id:"\u907F\u514D\u9891\u7E41\u6E32\u67D3",children:"\u907F\u514D\u9891\u7E41\u6E32\u67D3"}),"\n",(0,r.jsxs)(n.p,{children:["\u62D6\u62FD\u8FC7\u7A0B\u4E2D\uFF0C",(0,r.jsx)(n.code,{children:"handleMouseMove"})," \u4F1A\u9891\u7E41\u89E6\u53D1\u3002\u63A7\u5236\u5668\u5DF2\u7ECF\u5185\u7F6E\u4E86\u4F18\u5316\uFF0C\u53EA\u5728\u5FC5\u8981\u65F6\u8C03\u7528 ",(0,r.jsx)(n.code,{children:"render()"}),"\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// \u2705 \u597D\u7684\u505A\u6CD5\uFF1A\u53EA\u5728 mousemove \u65F6\u8C03\u7528 handleMouseMove\uFF0C\u4E0D\u8C03\u7528 render\ncanvas.addEventListener('mousemove', (e) => {\n  const rect = canvas.getBoundingClientRect();\n  controller.handleMouseMove(e.clientX - rect.left, e.clientY - rect.top);\n  // render() \u4F1A\u5728\u5185\u90E8\u81EA\u52A8\u8C03\u7528\n});\n\n// \u274C \u4E0D\u597D\u7684\u505A\u6CD5\uFF1A\u6BCF\u6B21\u90FD\u624B\u52A8\u8C03\u7528 render\ncanvas.addEventListener('mousemove', (e) => {\n  const rect = canvas.getBoundingClientRect();\n  controller.handleMouseMove(e.clientX - rect.left, e.clientY - rect.top);\n  controller.render(); // \u4E0D\u9700\u8981\uFF0ChandleMouseMove \u5185\u90E8\u5DF2\u7ECF\u5904\u7406\n});\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u4F7F\u7528-requestanimationframe",children:"\u4F7F\u7528 requestAnimationFrame"}),"\n",(0,r.jsxs)(n.p,{children:["\u5BF9\u4E8E\u590D\u6742\u573A\u666F\uFF0C\u53EF\u4EE5\u4F7F\u7528 ",(0,r.jsx)(n.code,{children:"requestAnimationFrame"})," \u6765\u8282\u6D41\u6E32\u67D3\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"let rafId: number | null = null;\n\ncanvas.addEventListener('mousemove', (e) => {\n  if (rafId !== null) return;\n\n  rafId = requestAnimationFrame(() => {\n    const rect = canvas.getBoundingClientRect();\n    controller.handleMouseMove(e.clientX - rect.left, e.clientY - rect.top);\n    rafId = null;\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-\u5185\u5B58\u7BA1\u7406",children:"2. \u5185\u5B58\u7BA1\u7406"}),"\n",(0,r.jsx)(n.h4,{id:"\u53CA\u65F6\u9500\u6BC1\u63A7\u5236\u5668",children:"\u53CA\u65F6\u9500\u6BC1\u63A7\u5236\u5668"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u7EC4\u4EF6\u5378\u8F7D\u65F6\uFF0C\u52A1\u5FC5\u8C03\u7528 ",(0,r.jsx)(n.code,{children:"destroy()"})," \u65B9\u6CD5\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// React\nuseEffect(() => {\n  const controller = new TextController({ /* ... */ });\n  return () => controller.destroy(); // \u6E05\u7406\u8D44\u6E90\n}, []);\n\n// Vue\nonUnmounted(() => {\n  controller?.destroy();\n});\n\n// Svelte\nonMount(() => {\n  const controller = new TextController({ /* ... */ });\n  return () => controller.destroy();\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-\u5750\u6807\u8F6C\u6362",children:"3. \u5750\u6807\u8F6C\u6362"}),"\n",(0,r.jsx)(n.h4,{id:"\u6B63\u786E\u5904\u7406-canvas-\u5750\u6807",children:"\u6B63\u786E\u5904\u7406 Canvas \u5750\u6807"}),"\n",(0,r.jsxs)(n.p,{children:["\u59CB\u7EC8\u4F7F\u7528 ",(0,r.jsx)(n.code,{children:"getBoundingClientRect()"})," \u6765\u8F6C\u6362\u9F20\u6807\u5750\u6807\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const handleMouseEvent = (e: MouseEvent) => {\n  const rect = canvas.getBoundingClientRect();\n  const x = e.clientX - rect.left;\n  const y = e.clientY - rect.top;\n\n  // \u4F7F\u7528\u8F6C\u6362\u540E\u7684\u5750\u6807\n  controller.handleMouseDown(x, y);\n};\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u5904\u7406\u9AD8-dpi-\u5C4F\u5E55",children:"\u5904\u7406\u9AD8 DPI \u5C4F\u5E55"}),"\n",(0,r.jsx)(n.p,{children:"\u5BF9\u4E8E\u9AD8 DPI \u5C4F\u5E55\uFF0C\u9700\u8981\u8C03\u6574 Canvas \u7684\u5206\u8FA8\u7387\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const dpr = window.devicePixelRatio || 1;\ncanvas.width = width * dpr;\ncanvas.height = height * dpr;\ncanvas.style.width = `${width}px`;\ncanvas.style.height = `${height}px`;\n\nconst ctx = canvas.getContext('2d');\nctx.scale(dpr, dpr);\n\ncontroller.setCanvas(ctx, width, height); // \u4F7F\u7528\u903B\u8F91\u5C3A\u5BF8\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-\u72B6\u6001\u7BA1\u7406",children:"4. \u72B6\u6001\u7BA1\u7406"}),"\n",(0,r.jsx)(n.h4,{id:"\u4F7F\u7528\u53D7\u63A7\u6A21\u5F0F",children:"\u4F7F\u7528\u53D7\u63A7\u6A21\u5F0F"}),"\n",(0,r.jsx)(n.p,{children:"\u63A7\u5236\u5668\u8BBE\u8BA1\u4E3A\u53D7\u63A7\u7EC4\u4EF6\uFF0C\u5916\u90E8\u72B6\u6001\u662F\u552F\u4E00\u7684\u6570\u636E\u6E90\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// \u2705 \u597D\u7684\u505A\u6CD5\uFF1A\u5916\u90E8\u72B6\u6001\u9A71\u52A8\nconst [items, setItems] = useState<TextItem[]>([]);\n\nconst controller = new TextController({\n  items,\n  onItemsChange: setItems  // \u62D6\u62FD\u7ED3\u675F\u65F6\u66F4\u65B0\u5916\u90E8\u72B6\u6001\n});\n\n// \u5F53\u5916\u90E8\u72B6\u6001\u53D8\u5316\u65F6\uFF0C\u540C\u6B65\u5230\u63A7\u5236\u5668\nuseEffect(() => {\n  controller.setItems(items);\n  controller.render();\n}, [items]);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5E38\u89C1\u95EE\u9898",children:"\u5E38\u89C1\u95EE\u9898"}),"\n",(0,r.jsx)(n.h3,{id:"q-\u4E3A\u4EC0\u4E48\u62D6\u62FD\u65F6\u6587\u672C\u4F4D\u7F6E\u4E0D\u66F4\u65B0",children:"Q: \u4E3A\u4EC0\u4E48\u62D6\u62FD\u65F6\u6587\u672C\u4F4D\u7F6E\u4E0D\u66F4\u65B0\uFF1F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," \u786E\u4FDD\u5728 ",(0,r.jsx)(n.code,{children:"mouseup"})," \u4E8B\u4EF6\u4E2D\u8C03\u7528\u4E86 ",(0,r.jsx)(n.code,{children:"handleMouseUp()"}),"\u3002\u63A7\u5236\u5668\u53EA\u5728\u62D6\u62FD\u7ED3\u675F\u65F6\u901A\u8FC7 ",(0,r.jsx)(n.code,{children:"onItemsChange"})," \u56DE\u8C03\u901A\u77E5\u5916\u90E8\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"canvas.addEventListener('mouseup', () => {\n  controller.handleMouseUp();  // \u5FC5\u987B\u8C03\u7528\n  controller.render();\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"q-\u5982\u4F55\u5904\u7406-canvas-\u5C3A\u5BF8\u53D8\u5316",children:"Q: \u5982\u4F55\u5904\u7406 Canvas \u5C3A\u5BF8\u53D8\u5316\uFF1F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," \u5F53 Canvas \u5C3A\u5BF8\u53D8\u5316\u65F6\uFF0C\u9700\u8981\u91CD\u65B0\u8BBE\u7F6E Canvas \u4E0A\u4E0B\u6587\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"window.addEventListener('resize', () => {\n  const newWidth = canvas.offsetWidth;\n  const newHeight = canvas.offsetHeight;\n\n  canvas.width = newWidth;\n  canvas.height = newHeight;\n\n  const ctx = canvas.getContext('2d');\n  controller.setCanvas(ctx, newWidth, newHeight);\n  controller.render();\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"q-\u5149\u6807\u6837\u5F0F\u4E0D\u66F4\u65B0\u600E\u4E48\u529E",children:"Q: \u5149\u6807\u6837\u5F0F\u4E0D\u66F4\u65B0\u600E\u4E48\u529E\uFF1F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," \u9700\u8981\u5728\u9F20\u6807\u4E8B\u4EF6\u4E2D\u624B\u52A8\u66F4\u65B0\u5149\u6807\u6837\u5F0F\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"canvas.addEventListener('mousemove', (e) => {\n  controller.handleMouseMove(x, y);\n  canvas.style.cursor = controller.getCursorStyle();  // \u66F4\u65B0\u5149\u6807\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"q-\u5982\u4F55\u5B9E\u73B0\u6587\u672C\u9879\u7684\u5220\u9664\u529F\u80FD",children:"Q: \u5982\u4F55\u5B9E\u73B0\u6587\u672C\u9879\u7684\u5220\u9664\u529F\u80FD\uFF1F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," \u901A\u8FC7\u8FC7\u6EE4 items \u6570\u7EC4\u6765\u5220\u9664\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"function deleteItem(id: string | number) {\n  const newItems = items.filter(item => item.id !== id);\n  controller.setItems(newItems);\n  controller.render();\n  onItemsChange?.(newItems);  // \u901A\u77E5\u5916\u90E8\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"q-\u5982\u4F55\u5B9E\u73B0\u64A4\u9500\u91CD\u505A\u529F\u80FD",children:"Q: \u5982\u4F55\u5B9E\u73B0\u64A4\u9500/\u91CD\u505A\u529F\u80FD\uFF1F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," \u7EF4\u62A4\u4E00\u4E2A\u5386\u53F2\u8BB0\u5F55\u6808\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const history: TextItem[][] = [];\nlet historyIndex = -1;\n\nfunction saveHistory(items: TextItem[]) {\n  history.splice(historyIndex + 1);\n  history.push([...items]);\n  historyIndex++;\n}\n\nfunction undo() {\n  if (historyIndex > 0) {\n    historyIndex--;\n    const items = history[historyIndex];\n    controller.setItems(items);\n    controller.render();\n  }\n}\n\nfunction redo() {\n  if (historyIndex < history.length - 1) {\n    historyIndex++;\n    const items = history[historyIndex];\n    controller.setItems(items);\n    controller.render();\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u9AD8\u7EA7\u7528\u6CD5",children:"\u9AD8\u7EA7\u7528\u6CD5"}),"\n",(0,r.jsx)(n.h3,{id:"1-\u81EA\u5B9A\u4E49\u6E32\u67D3\u6837\u5F0F",children:"1. \u81EA\u5B9A\u4E49\u6E32\u67D3\u6837\u5F0F"}),"\n",(0,r.jsx)(n.p,{children:"\u867D\u7136\u63A7\u5236\u5668\u5185\u90E8\u5904\u7406\u6E32\u67D3\uFF0C\u4F46\u4F60\u53EF\u4EE5\u901A\u8FC7\u7EE7\u627F\u6765\u81EA\u5B9A\u4E49\u6837\u5F0F\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"class CustomTextController extends TextController {\n  // \u91CD\u5199\u7ED8\u5236\u65B9\u6CD5\u4EE5\u81EA\u5B9A\u4E49\u6837\u5F0F\n  protected drawTextItem(text: string, position: Point, isSelected: boolean): void {\n    if (!this.ctx) return;\n\n    // \u81EA\u5B9A\u4E49\u5B57\u4F53\n    this.ctx.font = 'bold 16px Arial';\n\n    // \u81EA\u5B9A\u4E49\u9634\u5F71\u6548\u679C\n    this.ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';\n    this.ctx.shadowBlur = 4;\n    this.ctx.shadowOffsetX = 2;\n    this.ctx.shadowOffsetY = 2;\n\n    // \u8C03\u7528\u7236\u7C7B\u65B9\u6CD5\u6216\u5B8C\u5168\u81EA\u5B9A\u4E49\n    super.drawTextItem(text, position, isSelected);\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-\u5750\u6807\u5F52\u4E00\u5316",children:"2. \u5750\u6807\u5F52\u4E00\u5316"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u5B9E\u9645\u5E94\u7528\u4E2D\uFF0C\u901A\u5E38\u9700\u8981\u5C06\u50CF\u7D20\u5750\u6807\u8F6C\u6362\u4E3A\u5F52\u4E00\u5316\u5750\u6807\uFF080-1 \u8303\u56F4\uFF09\u4EE5\u9002\u5E94\u4E0D\u540C\u5C3A\u5BF8\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// \u5F52\u4E00\u5316\u5750\u6807\uFF08\u4FDD\u5B58\u5230\u540E\u7AEF\uFF09\nfunction normalizePosition(position: Point, size: Size): Point {\n  return {\n    x: position.x / size.width,\n    y: position.y / size.height\n  };\n}\n\n// \u53CD\u5F52\u4E00\u5316\uFF08\u4ECE\u540E\u7AEF\u52A0\u8F7D\uFF09\nfunction denormalizePosition(normalized: Point, size: Size): Point {\n  return {\n    x: normalized.x * size.width,\n    y: normalized.y * size.height\n  };\n}\n\n// \u4F7F\u7528\u793A\u4F8B\nconst controller = new TextController({\n  items: backendItems.map(item => ({\n    ...item,\n    position: denormalizePosition(item.position, canvasSize)\n  })),\n  onItemsChange: (items) => {\n    const normalizedItems = items.map(item => ({\n      ...item,\n      position: normalizePosition(item.position, canvasSize)\n    }));\n    saveToBackend(normalizedItems);\n  }\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6545\u969C\u6392\u67E5",children:"\u6545\u969C\u6392\u67E5"}),"\n",(0,r.jsx)(n.h3,{id:"\u6587\u672C\u4E0D\u663E\u793A",children:"\u6587\u672C\u4E0D\u663E\u793A"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u53EF\u80FD\u539F\u56E0\uFF1A"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Canvas \u4E0A\u4E0B\u6587\u672A\u6B63\u786E\u8BBE\u7F6E"}),"\n",(0,r.jsx)(n.li,{children:"\u6587\u672C\u989C\u8272\u4E0E\u80CC\u666F\u8272\u76F8\u540C"}),"\n",(0,r.jsx)(n.li,{children:"\u6587\u672C\u4F4D\u7F6E\u8D85\u51FA Canvas \u8FB9\u754C"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u89E3\u51B3\u65B9\u6CD5\uFF1A"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// \u68C0\u67E5 Canvas \u4E0A\u4E0B\u6587\nconst ctx = canvas.getContext('2d');\nconsole.log('Canvas context:', ctx);\n\n// \u68C0\u67E5\u6587\u672C\u9879\nconsole.log('Items:', controller.getItems());\n\n// \u68C0\u67E5\u989C\u8272\ncontroller.setColor([255, 0, 0, 1]); // \u8BBE\u7F6E\u4E3A\u7EA2\u8272\u6D4B\u8BD5\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u62D6\u62FD\u4E0D\u6D41\u7545",children:"\u62D6\u62FD\u4E0D\u6D41\u7545"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u53EF\u80FD\u539F\u56E0\uFF1A"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u9891\u7E41\u7684\u72B6\u6001\u66F4\u65B0"}),"\n",(0,r.jsx)(n.li,{children:"\u672A\u4F7F\u7528 requestAnimationFrame"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u89E3\u51B3\u65B9\u6CD5\uFF1A"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// \u4F7F\u7528\u8282\u6D41\nlet rafId: number | null = null;\ncanvas.addEventListener('mousemove', (e) => {\n  if (rafId) return;\n  rafId = requestAnimationFrame(() => {\n    controller.handleMouseMove(x, y);\n    rafId = null;\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5185\u5B58\u6CC4\u6F0F",children:"\u5185\u5B58\u6CC4\u6F0F"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u53EF\u80FD\u539F\u56E0\uFF1A"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u672A\u8C03\u7528 ",(0,r.jsx)(n.code,{children:"destroy()"})," \u65B9\u6CD5"]}),"\n",(0,r.jsx)(n.li,{children:"\u4E8B\u4EF6\u76D1\u542C\u5668\u672A\u6E05\u7406"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u89E3\u51B3\u65B9\u6CD5\uFF1A"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// \u786E\u4FDD\u6E05\u7406\u8D44\u6E90\nuseEffect(() => {\n  const controller = new TextController({ /* ... */ });\n\n  return () => {\n    controller.destroy();  // \u5FC5\u987B\u8C03\u7528\n  };\n}, []);\n"})})]})}function v(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(m,{...e})}):m(e)}}}]);