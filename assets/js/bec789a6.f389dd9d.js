(self.webpackChunkanch=self.webpackChunkanch||[]).push([["6079"],{1837(e,t,r){"use strict";r.r(t),r.d(t,{metadata:()=>a,default:()=>b,frontMatter:()=>R,contentTitle:()=>j,toc:()=>S,assets:()=>M});var n,a=JSON.parse('{"id":"web/three/advanced/squircle","title":"Squircle","description":"\u6838\u5FC3\u6982\u5FF5","source":"@site/docs/web/three/advanced/11-squircle.mdx","sourceDirName":"web/three/advanced","slug":"/web/three/advanced/squircle","permalink":"/chiyu/web/three/advanced/squircle","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Javascript","permalink":"/chiyu/tags/javascript"}],"version":"current","lastUpdatedBy":"imehc","lastUpdatedAt":1768181947000,"sidebarPosition":11,"frontMatter":{"sidebar_position":11,"title":"Squircle","tags":["Javascript"]},"sidebar":"webSidebar","previous":{"title":"\u5E73\u6ED1\u8FC7\u6E21","permalink":"/chiyu/web/three/advanced/smooth-transition"},"next":{"title":"\u7269\u6599\u62FE\u53D6","permalink":"/chiyu/web/three/advanced/material-picking"}}'),i=r(35656),c=r(75395),o=r(1340),l=r(57140),s=r(67199),u=r(45225),m=((n=m||{})[n.NONE=0]="NONE",n[n.START=1]="START",n[n.ACTIVE=2]="ACTIVE",n);let d=e=>1-Math.exp(-5*e)+.007*e,p=l.createContext(null);function h({children:e,maxDuration:t=1,margin:r=1.2,observe:n,fit:a,clip:i,interpolateFunc:c=d,onFit:o}){let h=l.useRef(null),{camera:f,size:x,invalidate:g}=(0,u.C)(),v=(0,u.C)(e=>e.controls),y=l.useRef(o);y.current=o;let P=l.useRef({camPos:new s.Pq0,camRot:new s.PTz,camZoom:1}),w=l.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),R=l.useRef(m.NONE),j=l.useRef(0),[M]=l.useState(()=>new s.NRn),S=l.useMemo(()=>{function e(){let e=M.getSize(new s.Pq0),t=M.getCenter(new s.Pq0),n=Math.max(e.x,e.y,e.z),a=f&&f.isOrthographicCamera?4*n:n/(2*Math.atan(Math.PI*f.fov/360)),i=f&&f.isOrthographicCamera?4*n:a/f.aspect;return{box:M,size:e,center:t,distance:r*Math.max(a,i)}}return{getSize:e,refresh(e){if(e&&e.isBox3)M.copy(e);else{let t=e||h.current;if(!t)return this;t.updateWorldMatrix(!0,!0),M.setFromObject(t)}if(M.isEmpty()){let e=f.position.length()||10;M.setFromCenterAndSize(new s.Pq0,new s.Pq0(e,e,e))}return P.current.camPos.copy(f.position),P.current.camRot.copy(f.quaternion),f&&f.isOrthographicCamera&&(P.current.camZoom=f.zoom),w.current.camPos=void 0,w.current.camRot=void 0,w.current.camZoom=void 0,w.current.camUp=void 0,w.current.target=void 0,this},reset(){let{center:t,distance:r}=e(),n=f.position.clone().sub(t).normalize();w.current.camPos=t.clone().addScaledVector(n,r),w.current.target=t.clone();let a=new s.kn4().lookAt(w.current.camPos,w.current.target,f.up);return w.current.camRot=new s.PTz().setFromRotationMatrix(a),R.current=m.START,j.current=0,this},moveTo(e){return w.current.camPos=Array.isArray(e)?new s.Pq0(...e):e.clone(),R.current=m.START,j.current=0,this},lookAt({target:e,up:t}){w.current.target=Array.isArray(e)?new s.Pq0(...e):e.clone(),t?w.current.camUp=Array.isArray(t)?new s.Pq0(...t):t.clone():w.current.camUp=f.up.clone();let r=new s.kn4().lookAt(w.current.camPos||f.position,w.current.target,w.current.camUp);return w.current.camRot=new s.PTz().setFromRotationMatrix(r),R.current=m.START,j.current=0,this},to({position:e,target:t}){return this.moveTo(e).lookAt({target:t})},fit(){if(!(f&&f.isOrthographicCamera))return this.reset();let e=0,t=0,n=[new s.Pq0(M.min.x,M.min.y,M.min.z),new s.Pq0(M.min.x,M.max.y,M.min.z),new s.Pq0(M.min.x,M.min.y,M.max.z),new s.Pq0(M.min.x,M.max.y,M.max.z),new s.Pq0(M.max.x,M.max.y,M.max.z),new s.Pq0(M.max.x,M.max.y,M.min.z),new s.Pq0(M.max.x,M.min.y,M.max.z),new s.Pq0(M.max.x,M.min.y,M.min.z)],a=w.current.camPos||f.position,i=w.current.target||(null==v?void 0:v.target),c=w.current.camUp||f.up,o=i?new s.kn4().lookAt(a,i,c).setPosition(a).invert():f.matrixWorldInverse;for(let r of n)r.applyMatrix4(o),e=Math.max(e,Math.abs(r.y)),t=Math.max(t,Math.abs(r.x));e*=2,t*=2;let l=(f.top-f.bottom)/e,u=(f.right-f.left)/t;return w.current.camZoom=Math.min(l,u)/r,R.current=m.START,j.current=0,y.current&&y.current(this.getSize()),this},clip(){let{distance:t}=e();return f.near=t/100,f.far=100*t,f.updateProjectionMatrix(),v&&(v.maxDistance=10*t,v.update()),g(),this}}},[M,f,v,r,g]);l.useLayoutEffect(()=>{if(v){let e=()=>{if(v&&w.current.target&&R.current!==m.NONE){let e=new s.Pq0().setFromMatrixColumn(f.matrix,2),t=P.current.camPos.distanceTo(v.target),r=(w.current.camPos||P.current.camPos).distanceTo(w.current.target),n=(1-j.current)*t+j.current*r;v.target.copy(f.position).addScaledVector(e,-n),v.update()}R.current=m.NONE};return v.addEventListener("start",e),()=>v.removeEventListener("start",e)}},[v]);let q=l.useRef(0);return l.useLayoutEffect(()=>{(n||0==q.current++)&&(S.refresh(),a&&S.reset().fit(),i&&S.clip())},[x,i,a,n,f,v]),(0,u.D)((e,r)=>{if(R.current===m.START)R.current=m.ACTIVE,g();else if(R.current===m.ACTIVE){if(j.current+=r/t,j.current>=1)w.current.camPos&&f.position.copy(w.current.camPos),w.current.camRot&&f.quaternion.copy(w.current.camRot),w.current.camUp&&f.up.copy(w.current.camUp),w.current.camZoom&&f&&f.isOrthographicCamera&&(f.zoom=w.current.camZoom),f.updateMatrixWorld(),f.updateProjectionMatrix(),v&&w.current.target&&(v.target.copy(w.current.target),v.update()),R.current=m.NONE;else{let e=c(j.current);w.current.camPos&&f.position.lerpVectors(P.current.camPos,w.current.camPos,e),w.current.camRot&&f.quaternion.slerpQuaternions(P.current.camRot,w.current.camRot,e),w.current.camUp&&f.up.set(0,1,0).applyQuaternion(f.quaternion),w.current.camZoom&&f&&f.isOrthographicCamera&&(f.zoom=(1-e)*P.current.camZoom+e*w.current.camZoom),f.updateMatrixWorld(),f.updateProjectionMatrix()}g()}}),l.createElement("group",{ref:h},l.createElement(p.Provider,{value:S},e))}var f=r(99005),x=r(6124),g=r(60140),v=r(82044),y=r(22374);let P=()=>{let[e,t]=(0,l.useState)(2),r=l.useContext(p),n=(0,l.useMemo)(()=>{let t=new s.Ufg(1,16),r=t.attributes.position.array;for(let t=0;t<r.length;t+=3){let n=new s.Pq0(r[t],r[t+1],r[t+2]);n.x=Math.tanh(n.x),n.y=Math.tanh(n.y),n.z=Math.tanh(n.z),r[t]=s.cj9.lerp(r[t],n.x,e),r[t+1]=s.cj9.lerp(r[t+1],n.y,e),r[t+2]=s.cj9.lerp(r[t+2],n.z,e)}return t},[e]);return(0,y._5)("Squircle",{segments:{value:2,min:-64,max:64,step:.1,onChange:e=>{t(e),r.refresh().fit()}}}),(0,i.jsx)("mesh",{geometry:n,"position-y":1,children:(0,i.jsx)("meshPhysicalMaterial",{metalness:0,roughness:.36,clearcoat:1,transmission:1,ior:1.53,thickness:5})})},w=()=>(0,i.jsx)(v.A,{children:(0,i.jsxs)(g.Hl,{camera:{position:[0,2,-1.5]},children:[(0,i.jsx)(o.OH,{files:"/imgs/rustig_koppie_puresky_1k.hdr",background:!0}),(0,i.jsx)(h,{fit:!0,margin:1.8,children:(0,i.jsx)(P,{})}),(0,i.jsx)(f.N,{target:[0,1,0],autoRotate:!0}),(0,i.jsx)(x.U,{})]})}),R={sidebar_position:11,title:"Squircle",tags:["Javascript"]},j="Squircle",M={},S=[{value:"\u6838\u5FC3\u6982\u5FF5",id:"\u6838\u5FC3\u6982\u5FF5",level:2}];function q(e){let t={h1:"h1",h2:"h2",header:"header",li:"li",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"squircle",children:"Squircle"})}),"\n",(0,i.jsx)(w,{}),"\n",(0,i.jsx)(t.h2,{id:"\u6838\u5FC3\u6982\u5FF5",children:"\u6838\u5FC3\u6982\u5FF5"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"\u81EA\u5B9A\u4E49\u51E0\u4F55\u4F53"}),": \u901A\u8FC7\u6570\u5B66\u51FD\u6570\u4FEE\u6539\u9876\u70B9\u4F4D\u7F6E"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"\u53CC\u66F2\u51FD\u6570"}),": Math.tanh \u521B\u9020\u5E73\u6ED1\u7684\u5F62\u72B6\u8FC7\u6E21"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"\u7269\u7406\u6750\u8D28"}),": \u73BB\u7483\u822C\u7684\u900F\u660E\u548C\u6298\u5C04\u6548\u679C"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"\u52A8\u6001\u8FB9\u754C"}),": \u4F7F\u7528 Bounds \u81EA\u52A8\u8C03\u6574\u76F8\u673A"]}),"\n"]})]})}function b(e={}){let{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(q,{...e})}):q(e)}},6124(e,t,r){"use strict";r.d(t,{U:()=>l});var n=r(57140),a=r(45225),i=r(15697),c=r.n(i);function o(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function l({showPanel:e=0,className:t,parent:r}){let i=function(e,t=[],r){let[a,i]=n.useState();return n.useLayoutEffect(()=>{let t=e();return i(t),o(void 0,t),()=>o(void 0,null)},t),a}(()=>new(c()),[]);return n.useEffect(()=>{if(i){let n=r&&r.current||document.body;i.showPanel(e),null==n||n.appendChild(i.dom);let c=(null!=t?t:"").split(" ").filter(e=>e);c.length&&i.dom.classList.add(...c);let o=(0,a.j)(()=>i.begin()),l=(0,a.k)(()=>i.end());return()=>{c.length&&i.dom.classList.remove(...c),null==n||n.removeChild(i.dom),o(),l()}}},[r,i,t,e]),null}},15697(e){var t;(t=function(){function e(e){return a.appendChild(e.dom),e}function r(e){for(var t=0;t<a.children.length;t++)a.children[t].style.display=t===e?"block":"none";n=e}var n=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",function(e){e.preventDefault(),r(++n%a.children.length)},!1);var i=(performance||Date).now(),c=i,o=0,l=e(new t.Panel("FPS","#0ff","#002")),s=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=e(new t.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:a,addPanel:e,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(s.update(e-i,200),e>c+1e3&&(l.update(1e3*o/(e-c),100),c=e,o=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:a,setMode:r}}).Panel=function(e,t,r){var n=1/0,a=0,i=Math.round,c=i(window.devicePixelRatio||1),o=80*c,l=48*c,s=3*c,u=2*c,m=3*c,d=15*c,p=74*c,h=30*c,f=document.createElement("canvas");f.width=o,f.height=l,f.style.cssText="width:80px;height:48px";var x=f.getContext("2d");return x.font="bold "+9*c+"px Helvetica,Arial,sans-serif",x.textBaseline="top",x.fillStyle=r,x.fillRect(0,0,o,l),x.fillStyle=t,x.fillText(e,s,u),x.fillRect(m,d,p,h),x.fillStyle=r,x.globalAlpha=.9,x.fillRect(m,d,p,h),{dom:f,update:function(l,g){n=Math.min(n,l),a=Math.max(a,l),x.fillStyle=r,x.globalAlpha=1,x.fillRect(0,0,o,d),x.fillStyle=t,x.fillText(i(l)+" "+e+" ("+i(n)+"-"+i(a)+")",s,u),x.drawImage(f,m+c,d,p-c,h,m,d,p-c,h),x.fillRect(m+p-c,d,c,h),x.fillStyle=r,x.globalAlpha=.9,x.fillRect(m+p-c,d,c,i((1-l/g)*h))}}},e.exports=t}}]);