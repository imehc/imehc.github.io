<!doctype html><html lang=zh-Hans dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>WebRTC 视频流服务端DEMO | Chiyu</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:image content=https://imehc.github.io/favicon.svg /><meta data-rh=true name=twitter:image content=https://imehc.github.io/favicon.svg /><meta data-rh=true property=og:url content=https://imehc.github.io/blog/WebRTC服务端DEMO /><meta data-rh=true property=og:locale content=zh_Hans /><meta data-rh=true name=docusaurus_locale content=zh-Hans /><meta data-rh=true name=docusaurus_tag content=default /><meta data-rh=true name=docsearch:language content=zh-Hans /><meta data-rh=true name=docsearch:docusaurus_tag content=default /><meta data-rh=true property=og:title content="WebRTC 视频流服务端DEMO | Chiyu"/><meta data-rh=true name=description content=DEMO概述 /><meta data-rh=true property=og:description content=DEMO概述 /><meta data-rh=true property=og:type content=article /><meta data-rh=true property=article:published_time content=2025-12-22T00:00:00.000Z /><meta data-rh=true property=article:tag content=Python,JavaScript /><link data-rh=true rel=icon href=/favicon.svg /><link data-rh=true rel=canonical href=https://imehc.github.io/blog/WebRTC服务端DEMO /><link data-rh=true rel=alternate href=https://imehc.github.io/blog/WebRTC服务端DEMO hreflang=zh-Hans /><link data-rh=true rel=alternate href=https://imehc.github.io/blog/WebRTC服务端DEMO hreflang=x-default /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://imehc.github.io/blog/WebRTC服务端DEMO","@type":"BlogPosting","author":[],"datePublished":"2025-12-22T00:00:00.000Z","description":"DEMO概述","headline":"WebRTC 视频流服务端DEMO","isPartOf":{"@id":"https://imehc.github.io/blog","@type":"Blog","name":"Blog"},"keywords":[],"mainEntityOfPage":"https://imehc.github.io/blog/WebRTC服务端DEMO","name":"WebRTC 视频流服务端DEMO","url":"https://imehc.github.io/blog/WebRTC服务端DEMO"}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Chiyu RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Chiyu Atom Feed"><link rel=stylesheet href=/assets/css/styles.56d717fd.css /><script src=/assets/js/runtime~main.42f9cc6d.js defer></script><script src=/assets/js/main.3872b97a.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/favicon.svg /><div role=region aria-label=跳到主要内容><a class=skipToContent_ANZT href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><nav aria-label=主导航 class="theme-layout-navbar navbar navbar--fixed-top navbarHideable_FRaF"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/favicon.svg alt="Chiyu Logo" class="themedComponent_WThL themedComponent--light_k7e2"/><img src=/favicon.svg alt="Chiyu Logo" class="themedComponent_WThL themedComponent--dark_ujtZ"/></div><b class="navbar__title text--truncate">Chiyu</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/blog>博客</a><a class="navbar__item navbar__link" href=/web/three/basic/basic-scene>Web</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_l3Rm colorModeToggle_jj2D"><button class="clean-btn toggleButton_KI9k toggleButtonDisabled_fftj" type=button disabled title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_X7Kz lightToggleIcon_WXt7"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_X7Kz darkToggleIcon_OSy2"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_X7Kz systemToggleIcon_sZ4c"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_ZLjB><div class="navbar__search searchBarContainer__QZ8" dir=ltr><input placeholder=搜索 aria-label=Search class="navbar__search-input searchInput_Zwu6" value="" /><div class="loadingRing_w9y9 searchBarLoadingRing_nsUJ"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_Ucc7"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_kA4u thin-scrollbar" aria-label=最近博文导航><div class="sidebarItemTitle__N4E margin-bottom--md">最近文章</div><div role=group><h3 class=yearGroupHeading_K5io>2025</h3><ul class="sidebarItemList_i7cR clean-list"><li class=sidebarItem_HAmj><a aria-current=page class="sidebarItemLink_PGR4 sidebarItemLinkActive_vIOh" href=/blog/WebRTC服务端DEMO>WebRTC 视频流服务端DEMO</a></ul></div><div role=group><h3 class=yearGroupHeading_K5io>2024</h3><ul class="sidebarItemList_i7cR clean-list"><li class=sidebarItem_HAmj><a class=sidebarItemLink_PGR4 href=/blog/下载文件踩坑>前端下载文件踩坑</a></ul></div><div role=group><h3 class=yearGroupHeading_K5io>2021</h3><ul class="sidebarItemList_i7cR clean-list"><li class=sidebarItem_HAmj><a class=sidebarItemLink_PGR4 href=/blog/nestjs基础介绍与文件说明>Nestjs基础介绍与文件说明</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_QQDC>WebRTC 视频流服务端DEMO</h1><div class="container_u76l margin-vert--md"><time datetime=2025-12-22T00:00:00.000Z>2025年12月22日</time> · <!-- -->阅读需 13 分钟</div></header><div id=__blog-post-container class=markdown><h2 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=demo概述>DEMO概述<a href=#demo概述 class=hash-link aria-label=DEMO概述的直接链接 title=DEMO概述的直接链接 translate=no>​</a></h2>
<p>这是一个基于 Python 的 WebRTC 视频流服务器，可以将本地视频文件通过 WebRTC 协议实时传输到浏览器客户端。DEMO使用了 aiohttp 作为 Web 服务器框架，aiortc 作为 WebRTC 协议实现。</p>
<h2 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=核心技术栈>核心技术栈<a href=#核心技术栈 class=hash-link aria-label=核心技术栈的直接链接 title=核心技术栈的直接链接 translate=no>​</a></h2>
<ul>
<li class=""><strong>包管理工具</strong>: uv</li>
<li class=""><strong>后端框架</strong>: aiohttp (异步 HTTP 服务器)</li>
<li class=""><strong>WebRTC 实现</strong>: aiortc (Python WebRTC 库)</li>
<li class=""><strong>跨域支持</strong>: aiohttp-cors</li>
<li class=""><strong>视频处理</strong>: FFmpeg (通过 aiortc MediaPlayer)</li>
<li class=""><strong>运行环境</strong>: Python 3.13+</li>
</ul>
<h2 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=demo结构>Demo结构<a href=#demo结构 class=hash-link aria-label=Demo结构的直接链接 title=Demo结构的直接链接 translate=no>​</a></h2>
<div class="language-text codeBlockContainer_lAG8 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_sTw8><pre tabindex=0 class="prism-code language-text codeBlock_RBBa thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_tSXF><span class=token-line style=color:#393A34><span class="token plain">webrtc-server/</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">├── main.py                      # 服务端主程序</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">├── static/</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">│   └── index.html               # Web 客户端界面</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">├── assets/</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">│   └── Sintel.mp4              # 视频文件</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">├── external-client-example.html # 外部客户端示例</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">├── canvas-no-video.html         # Canvas 渲染示例</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">└── pyproject.toml              # Demo依赖配置</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=应用场景>应用场景<a href=#应用场景 class=hash-link aria-label=应用场景的直接链接 title=应用场景的直接链接 translate=no>​</a></h2>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=1-视频文件流媒体服务>1. 视频文件流媒体服务<a href=#1-视频文件流媒体服务 class=hash-link aria-label="1. 视频文件流媒体服务的直接链接" title="1. 视频文件流媒体服务的直接链接" translate=no>​</a></h3>
<ul>
<li class="">将本地视频文件通过 WebRTC 实时传输到浏览器</li>
<li class="">支持视频循环播放</li>
<li class="">低延迟的实时视频传输</li>
</ul>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=2-跨域视频流服务>2. 跨域视频流服务<a href=#2-跨域视频流服务 class=hash-link aria-label="2. 跨域视频流服务的直接链接" title="2. 跨域视频流服务的直接链接" translate=no>​</a></h3>
<ul>
<li class="">支持 CORS，可从任何网页连接</li>
<li class="">适合嵌入到第三方网页中</li>
<li class="">可作为视频 API 服务</li>
</ul>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=3-webrtc-技术演示>3. WebRTC 技术演示<a href=#3-webrtc-技术演示 class=hash-link aria-label="3. WebRTC 技术演示的直接链接" title="3. WebRTC 技术演示的直接链接" translate=no>​</a></h3>
<ul>
<li class="">教学示例，展示 WebRTC 基本工作原理</li>
<li class="">SDP 协商过程演示</li>
<li class="">点对点连接建立演示</li>
</ul>
<hr/>
<h2 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=完整代码实现>完整代码实现<a href=#完整代码实现 class=hash-link aria-label=完整代码实现的直接链接 title=完整代码实现的直接链接 translate=no>​</a></h2>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=1-服务端代码-mainpy>1. 服务端代码 (main.py)<a href=#1-服务端代码-mainpy class=hash-link aria-label="1. 服务端代码 (main.py)的直接链接" title="1. 服务端代码 (main.py)的直接链接" translate=no>​</a></h3>
<div class="language-python codeBlockContainer_lAG8 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_sTw8><pre tabindex=0 class="prism-code language-python codeBlock_RBBa thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_tSXF><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> asyncio</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> json</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> logging</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> os</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> pathlib </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> Path</span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> aiohttp </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> web</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> aiortc </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> RTCPeerConnection</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> RTCSessionDescription</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> aiortc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">contrib</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">media </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> MediaPlayer</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> aiohttp_cors</span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 获取Demo根目录</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">ROOT </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> Path</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">__file__</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">parent</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 配置日志</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">logging</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">basicConfig</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">level</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">logging</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">INFO</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">logger </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> logging</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">getLogger</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">__name__</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 存储所有活跃的 PeerConnection</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">pcs </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token builtin">set</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>index</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token triple-quoted-string string" style=color:#e3116c>"""</span><br/></span><span class=token-line style=color:#393A34><span class="token triple-quoted-string string" style=color:#e3116c>    返回 HTML 客户端页面</span><br/></span><span class=token-line style=color:#393A34><span class="token triple-quoted-string string" style=color:#e3116c>    """</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    content </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">ROOT </span><span class="token operator" style=color:#393A34>/</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"static"</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>/</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"index.html"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"r"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">read</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> web</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Response</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">content_type</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"text/html"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> text</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">content</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>offer</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">request</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token triple-quoted-string string" style=color:#e3116c>"""</span><br/></span><span class=token-line style=color:#393A34><span class="token triple-quoted-string string" style=color:#e3116c>    处理来自客户端的 WebRTC Offer 请求</span><br/></span><span class=token-line style=color:#393A34><span class="token triple-quoted-string string" style=color:#e3116c>    """</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># 1. 接收客户端发送的 SDP Offer</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    sdp_text </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">text</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    offer </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> RTCSessionDescription</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">sdp</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">sdp_text</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token builtin">type</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"offer"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># 2. 创建 RTCPeerConnection 对象</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    pc </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> RTCPeerConnection</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    pcs</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">add</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pc</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># 3. 监听连接状态变化</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># @pc.on("connectionstatechange") 等价于 pc.on("connectionstatechange")(on_connectionstatechange)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>on_connectionstatechange</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        logger</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">info</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string-interpolation string" style=color:#e3116c>f"连接状态: </span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>{</span><span class="token string-interpolation interpolation">pc</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>.</span><span class="token string-interpolation interpolation">connectionState</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>}</span><span class="token string-interpolation string" style=color:#e3116c>"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">connectionState </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"failed"</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>or</span><span class="token plain"> pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">connectionState </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"closed"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">close</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            pcs</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">discard</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">pc</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">on</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"connectionstatechange"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">on_connectionstatechange</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># 4. 检查视频文件是否存在</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    video_path </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">ROOT </span><span class="token operator" style=color:#393A34>/</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"assets"</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>/</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sintel.mp4"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>not</span><span class="token plain"> os</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">path</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">exists</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">video_path</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        logger</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">error</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string-interpolation string" style=color:#e3116c>f"视频文件未找到: </span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>{</span><span class="token string-interpolation interpolation">video_path</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>}</span><span class="token string-interpolation string" style=color:#e3116c>"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> web</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Response</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            content_type</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"application/json"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            text</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">json</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">dumps</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token string" style=color:#e3116c>"error"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Video file not found"</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            status</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>500</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># 5. 使用 MediaPlayer 加载视频文件</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    logger</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">info</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string-interpolation string" style=color:#e3116c>f"正在加载视频: </span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>{</span><span class="token string-interpolation interpolation">video_path</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>}</span><span class="token string-interpolation string" style=color:#e3116c>"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    player </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> MediaPlayer</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">video_path</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> options</span><span class="token operator" style=color:#393A34>=</span><span class="token punctuation" style=color:#393A34>{</span><span class="token string" style=color:#e3116c>"loop"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"1"</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># 6. 将视频轨道添加到 PeerConnection</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> player</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">video</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">addTrack</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">player</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">video</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        logger</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">info</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"视频轨道已添加到 PeerConnection"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>else</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        logger</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">error</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"MediaPlayer 无法获取视频轨道"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> web</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Response</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            content_type</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"application/json"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            text</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">json</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">dumps</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token string" style=color:#e3116c>"error"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Failed to load video track"</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            status</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>500</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># 7. 设置远程描述并创建应答</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">setRemoteDescription</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">offer</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    answer </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">createAnswer</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">setLocalDescription</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">answer</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># 8. 返回 SDP Answer</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> web</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Response</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        content_type</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"application/sdp"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        text</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">localDescription</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">sdp</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>on_shutdown</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">app</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token triple-quoted-string string" style=color:#e3116c>"""</span><br/></span><span class=token-line style=color:#393A34><span class="token triple-quoted-string string" style=color:#e3116c>    服务器关闭时清理所有 PeerConnection</span><br/></span><span class=token-line style=color:#393A34><span class="token triple-quoted-string string" style=color:#e3116c>    """</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    coros </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">close</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> pc </span><span class="token keyword" style=color:#00009f>in</span><span class="token plain"> pcs</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> asyncio</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">gather</span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>*</span><span class="token plain">coros</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    pcs</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">clear</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>main</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># 创建 aiohttp 应用</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    app </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> web</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Application</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    app</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">on_shutdown</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">on_shutdown</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># 配置 CORS，允许来自任何源的请求</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    cors </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> aiohttp_cors</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">setup</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">app</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> defaults</span><span class="token operator" style=color:#393A34>=</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"*"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> aiohttp_cors</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ResourceOptions</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            allow_credentials</span><span class="token operator" style=color:#393A34>=</span><span class="token boolean" style=color:#36acaa>True</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            expose_headers</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"*"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            allow_headers</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"*"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            allow_methods</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"*"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># 添加路由</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    index_route </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> app</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">router</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">add_get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"/"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> index</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    offer_route </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> app</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">router</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">add_post</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"/offer"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> offer</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    app</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">router</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">add_static</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"/static"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> ROOT </span><span class="token operator" style=color:#393A34>/</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"static"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic># 为路由启用 CORS</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    cors</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">add</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">index_route</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    cors</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">add</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">offer_route</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    logger</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">info</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"WebRTC 服务器启动: http://localhost:8000"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    logger</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">info</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"CORS 已启用 - 接受来自任何源的请求"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    web</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">run_app</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">app</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> host</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"0.0.0.0"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> port</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>8000</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> __name__ </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"__main__"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    main</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=2-客户端代码-staticindexhtml>2. 客户端代码 (static/index.html)<a href=#2-客户端代码-staticindexhtml class=hash-link aria-label="2. 客户端代码 (static/index.html)的直接链接" title="2. 客户端代码 (static/index.html)的直接链接" translate=no>​</a></h3>
<div class="language-html codeBlockContainer_lAG8 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_sTw8><pre tabindex=0 class="prism-code language-html codeBlock_RBBa thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_tSXF><span class=token-line style=color:#393A34><span class="token doctype punctuation" style=color:#393A34;font-style:italic>&lt;!</span><span class="token doctype doctype-tag" style=color:#999988;font-style:italic>DOCTYPE</span><span class="token doctype" style=color:#999988;font-style:italic> </span><span class="token doctype name" style=color:#999988;font-style:italic>html</span><span class="token doctype punctuation" style=color:#393A34;font-style:italic>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>html</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>lang</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>zh-CN</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>head</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>meta</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>charset</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>UTF-8</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>meta</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>name</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>viewport</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>content</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>width=device-width, initial-scale=1.0</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>title</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">WebRTC 视频流演示</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>title</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>style</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector" style=color:#00009f>*</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>margin</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>0</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>padding</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>0</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>box-sizing</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> border-box</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector" style=color:#00009f>body</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>font-family</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> -apple-system</span><span class="token style language-css punctuation" style=color:#393A34>,</span><span class="token style language-css"> BlinkMacSystemFont</span><span class="token style language-css punctuation" style=color:#393A34>,</span><span class="token style language-css"> </span><span class="token style language-css string" style=color:#e3116c>'Segoe UI'</span><span class="token style language-css punctuation" style=color:#393A34>,</span><span class="token style language-css"> Roboto</span><span class="token style language-css punctuation" style=color:#393A34>,</span><span class="token style language-css"> Oxygen</span><span class="token style language-css punctuation" style=color:#393A34>,</span><span class="token style language-css"> Ubuntu</span><span class="token style language-css punctuation" style=color:#393A34>,</span><span class="token style language-css"> Cantarell</span><span class="token style language-css punctuation" style=color:#393A34>,</span><span class="token style language-css"> sans-serif</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>background</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css function" style=color:#d73a49>linear-gradient</span><span class="token style language-css punctuation" style=color:#393A34>(</span><span class="token style language-css number" style=color:#36acaa>135</span><span class="token style language-css unit">deg</span><span class="token style language-css punctuation" style=color:#393A34>,</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#667eea</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>0</span><span class="token style language-css unit">%</span><span class="token style language-css punctuation" style=color:#393A34>,</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#764ba2</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>100</span><span class="token style language-css unit">%</span><span class="token style language-css punctuation" style=color:#393A34>)</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>min-height</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>100</span><span class="token style language-css unit">vh</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>display</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> flex</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>justify-content</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> center</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>align-items</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> center</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>padding</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>20</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector class" style=color:#00009f>.container</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>background</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css color">white</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>border-radius</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>12</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>box-shadow</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>0</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>20</span><span class="token style language-css unit">px</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>60</span><span class="token style language-css unit">px</span><span class="token style language-css"> </span><span class="token style language-css color function" style=color:#d73a49>rgba</span><span class="token style language-css color punctuation" style=color:#393A34>(</span><span class="token style language-css color number" style=color:#36acaa>0</span><span class="token style language-css color punctuation" style=color:#393A34>,</span><span class="token style language-css color"> </span><span class="token style language-css color number" style=color:#36acaa>0</span><span class="token style language-css color punctuation" style=color:#393A34>,</span><span class="token style language-css color"> </span><span class="token style language-css color number" style=color:#36acaa>0</span><span class="token style language-css color punctuation" style=color:#393A34>,</span><span class="token style language-css color"> </span><span class="token style language-css color number" style=color:#36acaa>0.3</span><span class="token style language-css color punctuation" style=color:#393A34>)</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>padding</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>40</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>max-width</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>900</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>width</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>100</span><span class="token style language-css unit">%</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector" style=color:#00009f>h1</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>color</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#333</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>margin-bottom</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>10</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>font-size</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>28</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector class" style=color:#00009f>.subtitle</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>color</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#666</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>margin-bottom</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>30</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>font-size</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>14</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector class" style=color:#00009f>.video-container</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>position</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> relative</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>background</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#000</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>border-radius</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>8</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>overflow</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> hidden</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>margin-bottom</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>20</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>aspect-ratio</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>16</span><span class="token style language-css"> </span><span class="token style language-css operator" style=color:#393A34>/</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>9</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector" style=color:#00009f>video</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>width</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>100</span><span class="token style language-css unit">%</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>height</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>100</span><span class="token style language-css unit">%</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>object-fit</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> contain</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector class" style=color:#00009f>.controls</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>display</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> flex</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>gap</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>10</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>margin-bottom</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>20</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector" style=color:#00009f>button</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>flex</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>1</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>padding</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>12</span><span class="token style language-css unit">px</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>24</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>border</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> none</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>border-radius</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>6</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>font-size</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>16</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>font-weight</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>600</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>cursor</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> pointer</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>transition</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> all </span><span class="token style language-css number" style=color:#36acaa>0.3</span><span class="token style language-css unit">s</span><span class="token style language-css"> ease</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector" style=color:#00009f>button</span><span class="token style language-css selector pseudo-class" style=color:#00009f>:disabled</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>opacity</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>0.5</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>cursor</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> not-allowed</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector id" style=color:#00009f>#startBtn</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>background</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css function" style=color:#d73a49>linear-gradient</span><span class="token style language-css punctuation" style=color:#393A34>(</span><span class="token style language-css number" style=color:#36acaa>135</span><span class="token style language-css unit">deg</span><span class="token style language-css punctuation" style=color:#393A34>,</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#667eea</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>0</span><span class="token style language-css unit">%</span><span class="token style language-css punctuation" style=color:#393A34>,</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#764ba2</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>100</span><span class="token style language-css unit">%</span><span class="token style language-css punctuation" style=color:#393A34>)</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>color</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css color">white</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector id" style=color:#00009f>#startBtn</span><span class="token style language-css selector pseudo-class" style=color:#00009f>:hover</span><span class="token style language-css selector pseudo-class" style=color:#00009f>:not</span><span class="token style language-css selector punctuation" style=color:#393A34>(</span><span class="token style language-css selector pseudo-class" style=color:#00009f>:disabled</span><span class="token style language-css selector punctuation" style=color:#393A34>)</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>transform</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css function" style=color:#d73a49>translateY</span><span class="token style language-css punctuation" style=color:#393A34>(</span><span class="token style language-css number" style=color:#36acaa>-2</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>)</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>box-shadow</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>0</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>5</span><span class="token style language-css unit">px</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>15</span><span class="token style language-css unit">px</span><span class="token style language-css"> </span><span class="token style language-css color function" style=color:#d73a49>rgba</span><span class="token style language-css color punctuation" style=color:#393A34>(</span><span class="token style language-css color number" style=color:#36acaa>102</span><span class="token style language-css color punctuation" style=color:#393A34>,</span><span class="token style language-css color"> </span><span class="token style language-css color number" style=color:#36acaa>126</span><span class="token style language-css color punctuation" style=color:#393A34>,</span><span class="token style language-css color"> </span><span class="token style language-css color number" style=color:#36acaa>234</span><span class="token style language-css color punctuation" style=color:#393A34>,</span><span class="token style language-css color"> </span><span class="token style language-css color number" style=color:#36acaa>0.4</span><span class="token style language-css color punctuation" style=color:#393A34>)</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector id" style=color:#00009f>#stopBtn</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>background</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#ef4444</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>color</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css color">white</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector id" style=color:#00009f>#stopBtn</span><span class="token style language-css selector pseudo-class" style=color:#00009f>:hover</span><span class="token style language-css selector pseudo-class" style=color:#00009f>:not</span><span class="token style language-css selector punctuation" style=color:#393A34>(</span><span class="token style language-css selector pseudo-class" style=color:#00009f>:disabled</span><span class="token style language-css selector punctuation" style=color:#393A34>)</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>transform</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css function" style=color:#d73a49>translateY</span><span class="token style language-css punctuation" style=color:#393A34>(</span><span class="token style language-css number" style=color:#36acaa>-2</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>)</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>box-shadow</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>0</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>5</span><span class="token style language-css unit">px</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>15</span><span class="token style language-css unit">px</span><span class="token style language-css"> </span><span class="token style language-css color function" style=color:#d73a49>rgba</span><span class="token style language-css color punctuation" style=color:#393A34>(</span><span class="token style language-css color number" style=color:#36acaa>239</span><span class="token style language-css color punctuation" style=color:#393A34>,</span><span class="token style language-css color"> </span><span class="token style language-css color number" style=color:#36acaa>68</span><span class="token style language-css color punctuation" style=color:#393A34>,</span><span class="token style language-css color"> </span><span class="token style language-css color number" style=color:#36acaa>68</span><span class="token style language-css color punctuation" style=color:#393A34>,</span><span class="token style language-css color"> </span><span class="token style language-css color number" style=color:#36acaa>0.4</span><span class="token style language-css color punctuation" style=color:#393A34>)</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector class" style=color:#00009f>.status</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>padding</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>12</span><span class="token style language-css unit">px</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>20</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>border-radius</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>6</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>margin-bottom</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>20</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>font-size</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>14</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>font-weight</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>500</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector class" style=color:#00009f>.status</span><span class="token style language-css selector class" style=color:#00009f>.info</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>background</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#dbeafe</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>color</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#1e40af</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector class" style=color:#00009f>.status</span><span class="token style language-css selector class" style=color:#00009f>.success</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>background</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#dcfce7</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>color</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#166534</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector class" style=color:#00009f>.status</span><span class="token style language-css selector class" style=color:#00009f>.error</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>background</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#fee2e2</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>color</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#991b1b</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector class" style=color:#00009f>.info-box</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>background</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#f9fafb</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>border-left</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>4</span><span class="token style language-css unit">px</span><span class="token style language-css"> solid </span><span class="token style language-css hexcode color">#667eea</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>padding</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>15</span><span class="token style language-css unit">px</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>20</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>border-radius</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>6</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>font-size</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>14</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>color</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#555</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector class" style=color:#00009f>.info-box</span><span class="token style language-css selector" style=color:#00009f> strong</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>color</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#333</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>display</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> block</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>margin-bottom</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>5</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>style</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>head</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>body</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>div</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>class</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>container</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>h1</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">WebRTC 视频流演示</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>h1</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>p</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>class</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>subtitle</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">使用 WebRTC 从服务器流式传输视频</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>p</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>div</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>class</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>video-container</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>video</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>id</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>videoElement</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>autoplay</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>playsinline</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>video</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>div</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>class</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>controls</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>button</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>id</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>startBtn</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">开始流媒体</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>button</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>button</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>id</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>stopBtn</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>disabled</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">停止流媒体</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>button</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>div</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>id</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>status</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>class</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>status info</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">准备连接。点击"开始流媒体"开始。</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>div</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>class</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>info-box</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>strong</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">关于此演示：</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>strong</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            此演示使用 WebRTC 技术从服务器流式传输视频。服务器读取视频文件 (Sintel.mp4)，</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">            并使用点对点连接实时传输到您的浏览器。</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>script</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 获取页面元素</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> startBtn </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style=color:#36acaa>document</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>getElementById</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'startBtn'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> stopBtn </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style=color:#36acaa>document</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>getElementById</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'stopBtn'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> videoElement </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style=color:#36acaa>document</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>getElementById</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'videoElement'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> statusDiv </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style=color:#36acaa>document</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>getElementById</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'status'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// PeerConnection 对象</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>let</span><span class="token script language-javascript"> pc </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword null nil" style=color:#00009f>null</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 更新状态显示</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">message</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> type </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'info'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            statusDiv</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">textContent</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> message</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            statusDiv</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">className</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript template-string template-punctuation string" style=color:#e3116c>`</span><span class="token script language-javascript template-string string" style=color:#e3116c>status </span><span class="token script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token script language-javascript template-string interpolation">type</span><span class="token script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token script language-javascript template-string template-punctuation string" style=color:#e3116c>`</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 开始视频流</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>async</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style=color:#00009f>function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style=color:#d73a49>startStreaming</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>try</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 1. 创建 RTCPeerConnection</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'正在创建对等连接...'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'info'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                pc </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style=color:#00009f>new</span><span class="token script language-javascript"> </span><span class="token script language-javascript class-name">RTCPeerConnection</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style=color:#36acaa>iceServers</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>[</span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"> </span><span class="token script language-javascript literal-property property" style=color:#36acaa>urls</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'stun:stun.l.google.com:19302'</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>]</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 2. 监听视频轨道</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method-variable function-variable method function property-access" style=color:#d73a49>ontrack</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript parameter">event</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript arrow operator" style=color:#393A34>=></span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'正在接收视频流...'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'success'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    videoElement</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">srcObject</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> event</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">streams</span><span class="token script language-javascript punctuation" style=color:#393A34>[</span><span class="token script language-javascript number" style=color:#36acaa>0</span><span class="token script language-javascript punctuation" style=color:#393A34>]</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 3. 监听 ICE 连接状态变化</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method-variable function-variable method function property-access" style=color:#d73a49>oniceconnectionstatechange</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript arrow operator" style=color:#393A34>=></span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>log</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'ICE 连接状态:'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">iceConnectionState</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">iceConnectionState</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>===</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'connected'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                        </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'已连接！正在播放视频...'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'success'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>else</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">iceConnectionState</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>===</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'disconnected'</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>||</span><span class="token script language-javascript"> pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">iceConnectionState</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>===</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'failed'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                        </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'连接丢失，请重试'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'error'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                        </span><span class="token script language-javascript function" style=color:#d73a49>stopStreaming</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 4. 添加视频接收器（仅接收，不发送）</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>addTransceiver</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'video'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"> </span><span class="token script language-javascript literal-property property" style=color:#36acaa>direction</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'recvonly'</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 5. 创建 Offer</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'正在创建 Offer...'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'info'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> offer </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>await</span><span class="token script language-javascript"> pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>createOffer</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>await</span><span class="token script language-javascript"> pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>setLocalDescription</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">offer</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 6. 发送 Offer 到服务器</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'正在发送 Offer 到服务器...'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'info'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> response </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>await</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style=color:#d73a49>fetch</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'/offer'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style=color:#36acaa>method</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'POST'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style=color:#36acaa>headers</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"> </span><span class="token script language-javascript string-property property" style=color:#36acaa>'Content-Type'</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'application/sdp'</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style=color:#36acaa>body</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">localDescription</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">sdp</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript operator" style=color:#393A34>!</span><span class="token script language-javascript">response</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">ok</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>throw</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style=color:#00009f>new</span><span class="token script language-javascript"> </span><span class="token script language-javascript class-name">Error</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'服务器错误: '</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>+</span><span class="token script language-javascript"> response</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">statusText</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> sdpText </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>await</span><span class="token script language-javascript"> response</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>text</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 7. 设置服务器返回的 Answer</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'收到 Answer，正在建立连接...'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'info'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>await</span><span class="token script language-javascript"> pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>setRemoteDescription</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript keyword" style=color:#00009f>new</span><span class="token script language-javascript"> </span><span class="token script language-javascript class-name">RTCSessionDescription</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style=color:#36acaa>type</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'answer'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style=color:#36acaa>sdp</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> sdpText</span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 8. 更新按钮状态</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                startBtn</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">disabled</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript boolean" style=color:#36acaa>true</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                stopBtn</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">disabled</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript boolean" style=color:#36acaa>false</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>catch</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">error</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>error</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'错误:'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> error</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'错误: '</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>+</span><span class="token script language-javascript"> error</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">message</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'error'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript function" style=color:#d73a49>stopStreaming</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 停止视频流</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style=color:#d73a49>stopStreaming</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">pc</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>close</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                pc </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword null nil" style=color:#00009f>null</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            videoElement</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">srcObject</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword null nil" style=color:#00009f>null</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            startBtn</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">disabled</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript boolean" style=color:#36acaa>false</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            stopBtn</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">disabled</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript boolean" style=color:#36acaa>true</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'流已停止。点击"开始流媒体"重新连接。'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'info'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 绑定按钮事件</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        startBtn</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>addEventListener</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'click'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> startStreaming</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        stopBtn</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>addEventListener</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'click'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> stopStreaming</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>script</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>body</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>html</span><span class="token tag punctuation" style=color:#393A34>></span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=3-外部客户端示例-external-client-examplehtml>3. 外部客户端示例 (external-client-example.html)<a href=#3-外部客户端示例-external-client-examplehtml class=hash-link aria-label="3. 外部客户端示例 (external-client-example.html)的直接链接" title="3. 外部客户端示例 (external-client-example.html)的直接链接" translate=no>​</a></h3>
<div class="language-html codeBlockContainer_lAG8 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_sTw8><pre tabindex=0 class="prism-code language-html codeBlock_RBBa thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_tSXF><span class=token-line style=color:#393A34><span class="token doctype punctuation" style=color:#393A34;font-style:italic>&lt;!</span><span class="token doctype doctype-tag" style=color:#999988;font-style:italic>DOCTYPE</span><span class="token doctype" style=color:#999988;font-style:italic> </span><span class="token doctype name" style=color:#999988;font-style:italic>html</span><span class="token doctype punctuation" style=color:#393A34;font-style:italic>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>html</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>lang</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>zh-CN</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>head</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>meta</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>charset</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>UTF-8</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>meta</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>name</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>viewport</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>content</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>width=device-width, initial-scale=1.0</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>title</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">外部 WebRTC 客户端示例</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>title</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>style</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector" style=color:#00009f>body</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>font-family</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> Arial</span><span class="token style language-css punctuation" style=color:#393A34>,</span><span class="token style language-css"> sans-serif</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>max-width</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>800</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>margin</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>50</span><span class="token style language-css unit">px</span><span class="token style language-css"> auto</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>padding</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>20</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector" style=color:#00009f>video</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>width</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>100</span><span class="token style language-css unit">%</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>max-width</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>640</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>background</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#000</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>border-radius</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>8</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector" style=color:#00009f>button</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>padding</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>10</span><span class="token style language-css unit">px</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>20</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>margin</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>10</span><span class="token style language-css unit">px</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>5</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>font-size</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>16</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>cursor</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> pointer</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector id" style=color:#00009f>#status</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>padding</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>10</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>margin</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>10</span><span class="token style language-css unit">px</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>0</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>border-radius</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css number" style=color:#36acaa>4</span><span class="token style language-css unit">px</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">            </span><span class="token style language-css property" style=color:#36acaa>background</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#f0f0f0</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector class" style=color:#00009f>.error</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"> </span><span class="token style language-css property" style=color:#36acaa>background</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#ffcccc</span><span class="token style language-css"> </span><span class="token style language-css important">!important</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"> </span><span class="token style language-css property" style=color:#36acaa>color</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#cc0000</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">        </span><span class="token style language-css selector class" style=color:#00009f>.success</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>{</span><span class="token style language-css"> </span><span class="token style language-css property" style=color:#36acaa>background</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#ccffcc</span><span class="token style language-css"> </span><span class="token style language-css important">!important</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"> </span><span class="token style language-css property" style=color:#36acaa>color</span><span class="token style language-css punctuation" style=color:#393A34>:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#006600</span><span class="token style language-css punctuation" style=color:#393A34>;</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style=color:#393A34>}</span><span class="token style language-css"></span><br/></span><span class=token-line style=color:#393A34><span class="token style language-css">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>style</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>head</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>body</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>h1</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">外部 WebRTC 客户端示例</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>h1</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>p</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">此页面演示如何从任何外部 HTML 页面连接到 WebRTC 服务器。</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>p</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>label</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">服务器 URL: </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>input</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>type</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>text</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>id</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>serverUrl</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>value</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>http://localhost:8000</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag special-attr attr-name" style=color:#00a4db>style</span><span class="token tag special-attr attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag special-attr attr-value punctuation" style=color:#393A34>"</span><span class="token tag special-attr attr-value value css language-css property" style=color:#36acaa>width</span><span class="token tag special-attr attr-value value css language-css punctuation" style=color:#393A34>:</span><span class="token tag special-attr attr-value value css language-css" style=color:#e3116c> </span><span class="token tag special-attr attr-value value css language-css number" style=color:#36acaa>300</span><span class="token tag special-attr attr-value value css language-css unit" style=color:#e3116c>px</span><span class="token tag special-attr attr-value value css language-css punctuation" style=color:#393A34>;</span><span class="token tag special-attr attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>label</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>button</span><span class="token tag" style=color:#00009f> </span><span class="token tag special-attr attr-name" style=color:#00a4db>onclick</span><span class="token tag special-attr attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag special-attr attr-value punctuation" style=color:#393A34>"</span><span class="token tag special-attr attr-value value javascript language-javascript function" style=color:#d73a49>startStream</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style=color:#393A34>(</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style=color:#393A34>)</span><span class="token tag special-attr attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">开始流媒体</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>button</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>button</span><span class="token tag" style=color:#00009f> </span><span class="token tag special-attr attr-name" style=color:#00a4db>onclick</span><span class="token tag special-attr attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag special-attr attr-value punctuation" style=color:#393A34>"</span><span class="token tag special-attr attr-value value javascript language-javascript function" style=color:#d73a49>stopStream</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style=color:#393A34>(</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style=color:#393A34>)</span><span class="token tag special-attr attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">停止流媒体</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>button</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>div</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>id</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>status</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">状态: 就绪</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>video</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>id</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>video</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>autoplay</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>playsinline</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>video</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>h2</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">使用说明：</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>h2</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>ol</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>li</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">确保 WebRTC 服务器正在运行: </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>code</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">uv run python main.py</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>code</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>li</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>li</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">如果需要，更新服务器 URL（默认: http://localhost:8000）</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>li</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>li</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">点击"开始流媒体"开始接收视频</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>li</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>li</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">此页面可以从任何地方提供服务 - 甚至可以作为 file:// URL 打开</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>li</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>ol</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>h2</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">代码示例：</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>h2</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>pre</span><span class="token tag" style=color:#00009f> </span><span class="token tag special-attr attr-name" style=color:#00a4db>style</span><span class="token tag special-attr attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag special-attr attr-value punctuation" style=color:#393A34>"</span><span class="token tag special-attr attr-value value css language-css property" style=color:#36acaa>background</span><span class="token tag special-attr attr-value value css language-css punctuation" style=color:#393A34>:</span><span class="token tag special-attr attr-value value css language-css" style=color:#e3116c> </span><span class="token tag special-attr attr-value value css language-css hexcode color" style=color:#e3116c>#f5f5f5</span><span class="token tag special-attr attr-value value css language-css punctuation" style=color:#393A34>;</span><span class="token tag special-attr attr-value value css language-css" style=color:#e3116c> </span><span class="token tag special-attr attr-value value css language-css property" style=color:#36acaa>padding</span><span class="token tag special-attr attr-value value css language-css punctuation" style=color:#393A34>:</span><span class="token tag special-attr attr-value value css language-css" style=color:#e3116c> </span><span class="token tag special-attr attr-value value css language-css number" style=color:#36acaa>15</span><span class="token tag special-attr attr-value value css language-css unit" style=color:#e3116c>px</span><span class="token tag special-attr attr-value value css language-css punctuation" style=color:#393A34>;</span><span class="token tag special-attr attr-value value css language-css" style=color:#e3116c> </span><span class="token tag special-attr attr-value value css language-css property" style=color:#36acaa>border-radius</span><span class="token tag special-attr attr-value value css language-css punctuation" style=color:#393A34>:</span><span class="token tag special-attr attr-value value css language-css" style=color:#e3116c> </span><span class="token tag special-attr attr-value value css language-css number" style=color:#36acaa>5</span><span class="token tag special-attr attr-value value css language-css unit" style=color:#e3116c>px</span><span class="token tag special-attr attr-value value css language-css punctuation" style=color:#393A34>;</span><span class="token tag special-attr attr-value value css language-css" style=color:#e3116c> </span><span class="token tag special-attr attr-value value css language-css property" style=color:#36acaa>overflow-x</span><span class="token tag special-attr attr-value value css language-css punctuation" style=color:#393A34>:</span><span class="token tag special-attr attr-value value css language-css" style=color:#e3116c> auto</span><span class="token tag special-attr attr-value value css language-css punctuation" style=color:#393A34>;</span><span class="token tag special-attr attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">const pc = new RTCPeerConnection();</span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">pc.ontrack = (event) => {</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    videoElement.srcObject = event.streams[0];</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">};</span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">pc.addTransceiver('video', { direction: 'recvonly' });</span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">const offer = await pc.createOffer();</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">await pc.setLocalDescription(offer);</span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">const response = await fetch('http://localhost:8000/offer', {</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    method: 'POST',</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    headers: { 'Content-Type': 'application/sdp' },</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    body: pc.localDescription.sdp</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">});</span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">const sdpText = await response.text();</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">await pc.setRemoteDescription(new RTCSessionDescription({</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    type: 'answer',</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    sdp: sdpText</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">}));</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>pre</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>script</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// PeerConnection 对象</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>let</span><span class="token script language-javascript"> pc </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword null nil" style=color:#00009f>null</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> video </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style=color:#36acaa>document</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>getElementById</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'video'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> status </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style=color:#36acaa>document</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>getElementById</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'status'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> serverUrlInput </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style=color:#36acaa>document</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>getElementById</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'serverUrl'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 更新状态显示</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">message</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> type </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'normal'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            status</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">textContent</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'状态: '</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>+</span><span class="token script language-javascript"> message</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            status</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">className</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> type</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>log</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">message</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 开始视频流</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>async</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style=color:#00009f>function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style=color:#d73a49>startStream</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>try</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 获取服务器 URL</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> serverUrl </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> serverUrlInput</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">value</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>trim</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript operator" style=color:#393A34>!</span><span class="token script language-javascript">serverUrl</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'请输入服务器 URL'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'error'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>return</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'正在创建对等连接...'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'normal'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 创建 RTCPeerConnection</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                pc </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style=color:#00009f>new</span><span class="token script language-javascript"> </span><span class="token script language-javascript class-name">RTCPeerConnection</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style=color:#36acaa>iceServers</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>[</span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"> </span><span class="token script language-javascript literal-property property" style=color:#36acaa>urls</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'stun:stun.l.google.com:19302'</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>]</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 监听视频轨道</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method-variable function-variable method function property-access" style=color:#d73a49>ontrack</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript parameter">event</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript arrow operator" style=color:#393A34>=></span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'正在接收视频流！'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'success'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    video</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">srcObject</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> event</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">streams</span><span class="token script language-javascript punctuation" style=color:#393A34>[</span><span class="token script language-javascript number" style=color:#36acaa>0</span><span class="token script language-javascript punctuation" style=color:#393A34>]</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 监听 ICE 连接状态</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method-variable function-variable method function property-access" style=color:#d73a49>oniceconnectionstatechange</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript arrow operator" style=color:#393A34>=></span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>log</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'ICE 连接状态:'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">iceConnectionState</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">iceConnectionState</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>===</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'connected'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                        </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'已连接！正在播放视频...'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'success'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>else</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">iceConnectionState</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>===</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'disconnected'</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>||</span><span class="token script language-javascript"> pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">iceConnectionState</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>===</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'failed'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                        </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'连接丢失: '</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>+</span><span class="token script language-javascript"> pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">iceConnectionState</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'error'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 添加视频接收器</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>addTransceiver</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'video'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"> </span><span class="token script language-javascript literal-property property" style=color:#36acaa>direction</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'recvonly'</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 创建 Offer</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'正在创建 Offer...'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'normal'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> offer </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>await</span><span class="token script language-javascript"> pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>createOffer</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>await</span><span class="token script language-javascript"> pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>setLocalDescription</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">offer</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 发送 Offer 到服务器</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'正在发送 Offer 到 '</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>+</span><span class="token script language-javascript"> serverUrl </span><span class="token script language-javascript operator" style=color:#393A34>+</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'/offer...'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'normal'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> response </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>await</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style=color:#d73a49>fetch</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">serverUrl </span><span class="token script language-javascript operator" style=color:#393A34>+</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'/offer'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style=color:#36acaa>method</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'POST'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style=color:#36acaa>headers</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"> </span><span class="token script language-javascript string-property property" style=color:#36acaa>'Content-Type'</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'application/sdp'</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style=color:#36acaa>body</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">localDescription</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">sdp</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript operator" style=color:#393A34>!</span><span class="token script language-javascript">response</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">ok</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>throw</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style=color:#00009f>new</span><span class="token script language-javascript"> </span><span class="token script language-javascript class-name">Error</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript template-string template-punctuation string" style=color:#e3116c>`</span><span class="token script language-javascript template-string string" style=color:#e3116c>HTTP </span><span class="token script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token script language-javascript template-string interpolation">response</span><span class="token script language-javascript template-string interpolation punctuation" style=color:#393A34>.</span><span class="token script language-javascript template-string interpolation property-access">status</span><span class="token script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token script language-javascript template-string string" style=color:#e3116c>: </span><span class="token script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token script language-javascript template-string interpolation">response</span><span class="token script language-javascript template-string interpolation punctuation" style=color:#393A34>.</span><span class="token script language-javascript template-string interpolation property-access">statusText</span><span class="token script language-javascript template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token script language-javascript template-string template-punctuation string" style=color:#e3116c>`</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword" style=color:#00009f>const</span><span class="token script language-javascript"> sdpText </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>await</span><span class="token script language-javascript"> response</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>text</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 设置远程描述</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'正在设置远程描述...'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'normal'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>await</span><span class="token script language-javascript"> pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>setRemoteDescription</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript keyword" style=color:#00009f>new</span><span class="token script language-javascript"> </span><span class="token script language-javascript class-name">RTCSessionDescription</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style=color:#36acaa>type</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'answer'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style=color:#36acaa>sdp</span><span class="token script language-javascript operator" style=color:#393A34>:</span><span class="token script language-javascript"> sdpText</span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'等待连接...'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'normal'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>catch</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">error</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>error</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'错误:'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> error</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'错误: '</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>+</span><span class="token script language-javascript"> error</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">message</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'error'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                </span><span class="token script language-javascript function" style=color:#d73a49>stopStream</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style=color:#999988;font-style:italic>// 停止视频流</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style=color:#00009f>function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style=color:#d73a49>stopStream</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            </span><span class="token script language-javascript keyword control-flow" style=color:#00009f>if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript">pc</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style=color:#393A34>{</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                pc</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript method function property-access" style=color:#d73a49>close</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">                pc </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword null nil" style=color:#00009f>null</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            video</span><span class="token script language-javascript punctuation" style=color:#393A34>.</span><span class="token script language-javascript property-access">srcObject</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style=color:#393A34>=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword null nil" style=color:#00009f>null</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">            </span><span class="token script language-javascript function" style=color:#d73a49>updateStatus</span><span class="token script language-javascript punctuation" style=color:#393A34>(</span><span class="token script language-javascript string" style=color:#e3116c>'流已停止'</span><span class="token script language-javascript punctuation" style=color:#393A34>,</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style=color:#e3116c>'normal'</span><span class="token script language-javascript punctuation" style=color:#393A34>)</span><span class="token script language-javascript punctuation" style=color:#393A34>;</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">        </span><span class="token script language-javascript punctuation" style=color:#393A34>}</span><span class="token script language-javascript"></span><br/></span><span class=token-line style=color:#393A34><span class="token script language-javascript">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>script</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>body</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>html</span><span class="token tag punctuation" style=color:#393A34>></span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=4-demo配置-pyprojecttoml>4. Demo配置 (pyproject.toml)<a href=#4-demo配置-pyprojecttoml class=hash-link aria-label="4. Demo配置 (pyproject.toml)的直接链接" title="4. Demo配置 (pyproject.toml)的直接链接" translate=no>​</a></h3>
<div class="language-toml codeBlockContainer_lAG8 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_sTw8><pre tabindex=0 class="prism-code language-toml codeBlock_RBBa thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_tSXF><span class=token-line style=color:#393A34><span class="token plain">[project]</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">name = "webrtc-server"</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">version = "0.1.0"</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">description = "WebRTC server demo for streaming video files"</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">readme = "README.md"</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">requires-python = ">=3.13"</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">dependencies = [</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    "aiohttp>=3.9.0",</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    "aiortc>=1.6.0",</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    "aiohttp-cors>=0.7.0",</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">]</span><br/></span></code></pre></div></div>
<hr/>
<h2 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=工作原理详解>工作原理详解<a href=#工作原理详解 class=hash-link aria-label=工作原理详解的直接链接 title=工作原理详解的直接链接 translate=no>​</a></h2>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=webrtc-信令流程>WebRTC 信令流程<a href=#webrtc-信令流程 class=hash-link aria-label="WebRTC 信令流程的直接链接" title="WebRTC 信令流程的直接链接" translate=no>​</a></h3>
<!-- -->
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=核心组件说明>核心组件说明<a href=#核心组件说明 class=hash-link aria-label=核心组件说明的直接链接 title=核心组件说明的直接链接 translate=no>​</a></h3>
<h4 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=1-rtcpeerconnection>1. RTCPeerConnection<a href=#1-rtcpeerconnection class=hash-link aria-label="1. RTCPeerConnection的直接链接" title="1. RTCPeerConnection的直接链接" translate=no>​</a></h4>
<ul>
<li class="">负责建立和管理 WebRTC 点对点连接</li>
<li class="">处理 ICE 候选交换</li>
<li class="">管理媒体流的发送和接收</li>
</ul>
<h4 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=2-mediaplayer-aiortc>2. MediaPlayer (aiortc)<a href=#2-mediaplayer-aiortc class=hash-link aria-label="2. MediaPlayer (aiortc)的直接链接" title="2. MediaPlayer (aiortc)的直接链接" translate=no>​</a></h4>
<ul>
<li class="">封装 FFmpeg，用于读取和解码视频文件</li>
<li class="">提供视频帧流供 WebRTC 传输</li>
<li class="">支持循环播放选项</li>
</ul>
<h4 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=3-sdp-session-description-protocol>3. SDP (Session Description Protocol)<a href=#3-sdp-session-description-protocol class=hash-link aria-label="3. SDP (Session Description Protocol)的直接链接" title="3. SDP (Session Description Protocol)的直接链接" translate=no>​</a></h4>
<ul>
<li class="">Offer: 客户端发起的会话描述</li>
<li class="">Answer: 服务端响应的会话描述</li>
<li class="">包含媒体格式、编解码器、网络信息等</li>
</ul>
<h4 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=4-ice-interactive-connectivity-establishment>4. ICE (Interactive Connectivity Establishment)<a href=#4-ice-interactive-connectivity-establishment class=hash-link aria-label="4. ICE (Interactive Connectivity Establishment)的直接链接" title="4. ICE (Interactive Connectivity Establishment)的直接链接" translate=no>​</a></h4>
<ul>
<li class="">用于 NAT 穿透</li>
<li class="">STUN 服务器帮助发现公网 IP</li>
<li class="">确保客户端和服务端能建立连接</li>
</ul>
<hr/>
<h2 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=安装与运行>安装与运行<a href=#安装与运行 class=hash-link aria-label=安装与运行的直接链接 title=安装与运行的直接链接 translate=no>​</a></h2>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=1-安装依赖>1. 安装依赖<a href=#1-安装依赖 class=hash-link aria-label="1. 安装依赖的直接链接" title="1. 安装依赖的直接链接" translate=no>​</a></h3>
<p>使用 uv:</p>
<div class="language-bash codeBlockContainer_lAG8 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_sTw8><pre tabindex=0 class="prism-code language-bash codeBlock_RBBa thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_tSXF><span class=token-line style=color:#393A34><span class="token plain">uv sync</span><br/></span></code></pre></div></div>
<p>或使用 pip:</p>
<div class="language-bash codeBlockContainer_lAG8 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_sTw8><pre tabindex=0 class="prism-code language-bash codeBlock_RBBa thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_tSXF><span class=token-line style=color:#393A34><span class="token plain">uv add aiohttp aiortc aiohttp-cors</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=2-准备视频文件>2. 准备视频文件<a href=#2-准备视频文件 class=hash-link aria-label="2. 准备视频文件的直接链接" title="2. 准备视频文件的直接链接" translate=no>​</a></h3>
<p>将视频文件放置在 <code>assets/Sintel.mp4</code>，或修改代码中的路径。</p>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=3-启动服务器>3. 启动服务器<a href=#3-启动服务器 class=hash-link aria-label="3. 启动服务器的直接链接" title="3. 启动服务器的直接链接" translate=no>​</a></h3>
<p>或使用 uv:</p>
<div class="language-bash codeBlockContainer_lAG8 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_sTw8><pre tabindex=0 class="prism-code language-bash codeBlock_RBBa thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_tSXF><span class=token-line style=color:#393A34><span class="token plain">uv run python main.py</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=4-访问客户端>4. 访问客户端<a href=#4-访问客户端 class=hash-link aria-label="4. 访问客户端的直接链接" title="4. 访问客户端的直接链接" translate=no>​</a></h3>
<p>打开浏览器访问:</p>
<div class="language-text codeBlockContainer_lAG8 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_sTw8><pre tabindex=0 class="prism-code language-text codeBlock_RBBa thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_tSXF><span class=token-line style=color:#393A34><span class="token plain">http://localhost:8000</span><br/></span></code></pre></div></div>
<hr/>
<h2 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=api-接口说明>API 接口说明<a href=#api-接口说明 class=hash-link aria-label="API 接口说明的直接链接" title="API 接口说明的直接链接" translate=no>​</a></h2>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=get->GET /<a href=#get- class=hash-link aria-label="GET /的直接链接" title="GET /的直接链接" translate=no>​</a></h3>
<p>返回主页面 HTML 客户端界面</p>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=post-offer>POST /offer<a href=#post-offer class=hash-link aria-label="POST /offer的直接链接" title="POST /offer的直接链接" translate=no>​</a></h3>
<p>处理 WebRTC Offer 请求</p>
<p><strong>请求:</strong></p>
<ul>
<li class="">Content-Type: <code>application/sdp</code></li>
<li class="">Body: SDP Offer 文本</li>
</ul>
<p><strong>响应:</strong></p>
<ul>
<li class="">Content-Type: <code>application/sdp</code></li>
<li class="">Body: SDP Answer 文本</li>
</ul>
<p><strong>错误响应:</strong></p>
<div class="language-json codeBlockContainer_lAG8 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_sTw8><pre tabindex=0 class="prism-code language-json codeBlock_RBBa thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_tSXF><span class=token-line style=color:#393A34><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"error"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Video file not found"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<hr/>
<h2 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=关键代码解析>关键代码解析<a href=#关键代码解析 class=hash-link aria-label=关键代码解析的直接链接 title=关键代码解析的直接链接 translate=no>​</a></h2>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=服务端核心逻辑>服务端核心逻辑<a href=#服务端核心逻辑 class=hash-link aria-label=服务端核心逻辑的直接链接 title=服务端核心逻辑的直接链接 translate=no>​</a></h3>
<div class="language-python codeBlockContainer_lAG8 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_sTw8><pre tabindex=0 class="prism-code language-python codeBlock_RBBa thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_tSXF><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># 1. 接收客户端 Offer</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">sdp_text </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">text</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">offer </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> RTCSessionDescription</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">sdp</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">sdp_text</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token builtin">type</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"offer"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 2. 创建 PeerConnection</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">pc </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> RTCPeerConnection</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 3. 加载视频文件并添加到轨道</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">player </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> MediaPlayer</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">video_path</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> options</span><span class="token operator" style=color:#393A34>=</span><span class="token punctuation" style=color:#393A34>{</span><span class="token string" style=color:#e3116c>"loop"</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"1"</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">addTrack</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">player</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">video</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 4. 设置远程描述并创建应答</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">setRemoteDescription</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">offer</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">answer </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">createAnswer</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">setLocalDescription</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">answer</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 5. 返回 Answer 给客户端</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> web</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Response</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    content_type</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"application/sdp"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    text</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">localDescription</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">sdp</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=客户端核心逻辑>客户端核心逻辑<a href=#客户端核心逻辑 class=hash-link aria-label=客户端核心逻辑的直接链接 title=客户端核心逻辑的直接链接 translate=no>​</a></h3>
<div class="language-javascript codeBlockContainer_lAG8 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_sTw8><pre tabindex=0 class="prism-code language-javascript codeBlock_RBBa thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_tSXF><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// 1. 创建 PeerConnection 对象</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> pc </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">RTCPeerConnection</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token literal-property property" style=color:#36acaa>iceServers</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token literal-property property" style=color:#36acaa>urls</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'stun:stun.l.google.com:19302'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// 使用 Google STUN 服务器</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// 2. 监听视频轨道事件</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method-variable function-variable method function property-access" style=color:#d73a49>ontrack</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">event</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    videoElement</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">srcObject</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> event</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">streams</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// 将接收到的视频流绑定到 video 元素</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// 3. 添加视频接收器（仅接收，不发送）</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>addTransceiver</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'video'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token literal-property property" style=color:#36acaa>direction</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'recvonly'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// 4. 创建 Offer</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> offer </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>await</span><span class="token plain"> pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>createOffer</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword control-flow" style=color:#00009f>await</span><span class="token plain"> pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>setLocalDescription</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">offer</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// 5. 发送 Offer 到服务器</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> response </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>fetch</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'/offer'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token literal-property property" style=color:#36acaa>method</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'POST'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token literal-property property" style=color:#36acaa>headers</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token string-property property" style=color:#36acaa>'Content-Type'</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'application/sdp'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token literal-property property" style=color:#36acaa>body</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">localDescription</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">sdp</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// 6. 接收并设置服务器返回的 Answer</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> sdpText </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>await</span><span class="token plain"> response</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>text</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword control-flow" style=color:#00009f>await</span><span class="token plain"> pc</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>setRemoteDescription</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">RTCSessionDescription</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token literal-property property" style=color:#36acaa>type</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'answer'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token literal-property property" style=color:#36acaa>sdp</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> sdpText</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br/></span></code></pre></div></div>
<hr/>
<h2 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=扩展应用场景>扩展应用场景<a href=#扩展应用场景 class=hash-link aria-label=扩展应用场景的直接链接 title=扩展应用场景的直接链接 translate=no>​</a></h2>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=1-监控视频流>1. 监控视频流<a href=#1-监控视频流 class=hash-link aria-label="1. 监控视频流的直接链接" title="1. 监控视频流的直接链接" translate=no>​</a></h3>
<ul>
<li class="">将摄像头或监控设备视频通过 WebRTC 推送到浏览器</li>
<li class="">实现远程监控功能</li>
</ul>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=2-直播服务>2. 直播服务<a href=#2-直播服务 class=hash-link aria-label="2. 直播服务的直接链接" title="2. 直播服务的直接链接" translate=no>​</a></h3>
<ul>
<li class="">替换 MediaPlayer 为实时视频源</li>
<li class="">实现低延迟直播</li>
</ul>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=3-视频会议>3. 视频会议<a href=#3-视频会议 class=hash-link aria-label="3. 视频会议的直接链接" title="3. 视频会议的直接链接" translate=no>​</a></h3>
<ul>
<li class="">添加双向视频流支持</li>
<li class="">实现多人视频通话</li>
</ul>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=4-屏幕共享>4. 屏幕共享<a href=#4-屏幕共享 class=hash-link aria-label="4. 屏幕共享的直接链接" title="4. 屏幕共享的直接链接" translate=no>​</a></h3>
<ul>
<li class="">使用屏幕捕获作为视频源</li>
<li class="">实现远程演示功能</li>
</ul>
<hr/>
<h2 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=常见问题>常见问题<a href=#常见问题 class=hash-link aria-label=常见问题的直接链接 title=常见问题的直接链接 translate=no>​</a></h2>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=1-视频文件不存在>1. 视频文件不存在<a href=#1-视频文件不存在 class=hash-link aria-label="1. 视频文件不存在的直接链接" title="1. 视频文件不存在的直接链接" translate=no>​</a></h3>
<p>确保 <code>assets/Sintel.mp4</code> 文件存在，或修改代码中的路径。</p>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=2-连接失败>2. 连接失败<a href=#2-连接失败 class=hash-link aria-label="2. 连接失败的直接链接" title="2. 连接失败的直接链接" translate=no>​</a></h3>
<ul>
<li class="">检查防火墙设置</li>
<li class="">确保端口 8000 可用</li>
<li class="">检查 STUN 服务器是否可访问</li>
</ul>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=3-浏览器兼容性>3. 浏览器兼容性<a href=#3-浏览器兼容性 class=hash-link aria-label="3. 浏览器兼容性的直接链接" title="3. 浏览器兼容性的直接链接" translate=no>​</a></h3>
<p>支持的浏览器:</p>
<ul>
<li class="">Chrome/Edge (推荐)</li>
<li class="">Firefox</li>
<li class="">Safari (macOS/iOS)</li>
</ul>
<h3 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=4-cors-错误>4. CORS 错误<a href=#4-cors-错误 class=hash-link aria-label="4. CORS 错误的直接链接" title="4. CORS 错误的直接链接" translate=no>​</a></h3>
<p>服务器已配置 CORS 支持，允许所有来源访问。</p>
<hr/>
<h2 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=性能优化建议>性能优化建议<a href=#性能优化建议 class=hash-link aria-label=性能优化建议的直接链接 title=性能优化建议的直接链接 translate=no>​</a></h2>
<ol>
<li class=""><strong>视频编码</strong>: 使用 H.264 编码的视频文件以获得最佳兼容性</li>
<li class=""><strong>比特率控制</strong>: 根据网络状况调整视频比特率</li>
<li class=""><strong>连接池管理</strong>: 限制最大并发连接数</li>
<li class=""><strong>资源清理</strong>: 及时关闭断开的连接，释放资源</li>
</ol>
<hr/>
<h2 class="anchor anchorTargetHideOnScrollNavbar_uZ97" id=总结>总结<a href=#总结 class=hash-link aria-label=总结的直接链接 title=总结的直接链接 translate=no>​</a></h2>
<p>这个DEMO展示了如何使用 Python 和 aiortc 库构建一个完整的 WebRTC 视频流服务器。通过 WebRTC 协议，可以实现低延迟、高质量的实时视频传输。Demo代码简洁清晰，适合作为学习 WebRTC 技术的入门示例。</p>
<p>核心特点:</p>
<ul>
<li class="">✅ 完整的 WebRTC 实现</li>
<li class="">✅ 支持跨域访问</li>
<li class="">✅ 优雅的错误处理</li>
<li class="">✅ 资源自动清理</li>
<li class="">✅ 响应式 Web 界面</li>
<li class="">✅ 详细的日志输出</li>
</ul></div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><b>标签：</b><ul class="tags_CS2s padding--none margin-left--sm"><li class=tag_dcJ9><a rel=tag class="tag_a2Ba tagRegular_GOIy" href=/blog/tags/python>Python</a><li class=tag_dcJ9><a rel=tag class="tag_a2Ba tagRegular_GOIy" href=/blog/tags/java-script>JavaScript</a></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=博文分页导航><a class="pagination-nav__link pagination-nav__link--next" href=/blog/下载文件踩坑><div class=pagination-nav__sublabel>较旧一篇</div><div class=pagination-nav__label>前端下载文件踩坑</div></a></nav></main><div class="col col--2"><div class="tableOfContents_Oqdk thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#demo概述 class="table-of-contents__link toc-highlight">DEMO概述</a><li><a href=#核心技术栈 class="table-of-contents__link toc-highlight">核心技术栈</a><li><a href=#demo结构 class="table-of-contents__link toc-highlight">Demo结构</a><li><a href=#应用场景 class="table-of-contents__link toc-highlight">应用场景</a><ul><li><a href=#1-视频文件流媒体服务 class="table-of-contents__link toc-highlight">1. 视频文件流媒体服务</a><li><a href=#2-跨域视频流服务 class="table-of-contents__link toc-highlight">2. 跨域视频流服务</a><li><a href=#3-webrtc-技术演示 class="table-of-contents__link toc-highlight">3. WebRTC 技术演示</a></ul><li><a href=#完整代码实现 class="table-of-contents__link toc-highlight">完整代码实现</a><ul><li><a href=#1-服务端代码-mainpy class="table-of-contents__link toc-highlight">1. 服务端代码 (main.py)</a><li><a href=#2-客户端代码-staticindexhtml class="table-of-contents__link toc-highlight">2. 客户端代码 (static/index.html)</a><li><a href=#3-外部客户端示例-external-client-examplehtml class="table-of-contents__link toc-highlight">3. 外部客户端示例 (external-client-example.html)</a><li><a href=#4-demo配置-pyprojecttoml class="table-of-contents__link toc-highlight">4. Demo配置 (pyproject.toml)</a></ul><li><a href=#工作原理详解 class="table-of-contents__link toc-highlight">工作原理详解</a><ul><li><a href=#webrtc-信令流程 class="table-of-contents__link toc-highlight">WebRTC 信令流程</a><li><a href=#核心组件说明 class="table-of-contents__link toc-highlight">核心组件说明</a></ul><li><a href=#安装与运行 class="table-of-contents__link toc-highlight">安装与运行</a><ul><li><a href=#1-安装依赖 class="table-of-contents__link toc-highlight">1. 安装依赖</a><li><a href=#2-准备视频文件 class="table-of-contents__link toc-highlight">2. 准备视频文件</a><li><a href=#3-启动服务器 class="table-of-contents__link toc-highlight">3. 启动服务器</a><li><a href=#4-访问客户端 class="table-of-contents__link toc-highlight">4. 访问客户端</a></ul><li><a href=#api-接口说明 class="table-of-contents__link toc-highlight">API 接口说明</a><ul><li><a href=#get- class="table-of-contents__link toc-highlight">GET /</a><li><a href=#post-offer class="table-of-contents__link toc-highlight">POST /offer</a></ul><li><a href=#关键代码解析 class="table-of-contents__link toc-highlight">关键代码解析</a><ul><li><a href=#服务端核心逻辑 class="table-of-contents__link toc-highlight">服务端核心逻辑</a><li><a href=#客户端核心逻辑 class="table-of-contents__link toc-highlight">客户端核心逻辑</a></ul><li><a href=#扩展应用场景 class="table-of-contents__link toc-highlight">扩展应用场景</a><ul><li><a href=#1-监控视频流 class="table-of-contents__link toc-highlight">1. 监控视频流</a><li><a href=#2-直播服务 class="table-of-contents__link toc-highlight">2. 直播服务</a><li><a href=#3-视频会议 class="table-of-contents__link toc-highlight">3. 视频会议</a><li><a href=#4-屏幕共享 class="table-of-contents__link toc-highlight">4. 屏幕共享</a></ul><li><a href=#常见问题 class="table-of-contents__link toc-highlight">常见问题</a><ul><li><a href=#1-视频文件不存在 class="table-of-contents__link toc-highlight">1. 视频文件不存在</a><li><a href=#2-连接失败 class="table-of-contents__link toc-highlight">2. 连接失败</a><li><a href=#3-浏览器兼容性 class="table-of-contents__link toc-highlight">3. 浏览器兼容性</a><li><a href=#4-cors-错误 class="table-of-contents__link toc-highlight">4. CORS 错误</a></ul><li><a href=#性能优化建议 class="table-of-contents__link toc-highlight">性能优化建议</a><li><a href=#总结 class="table-of-contents__link toc-highlight">总结</a></ul></div></div></div></div></div></div></body>