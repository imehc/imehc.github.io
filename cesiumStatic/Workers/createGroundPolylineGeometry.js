import{a as e}from"./chunk-VSMOUEKV.js";import{a as t}from"./chunk-XQCNGPKC.js";import{a as n}from"./chunk-RKB2XVMW.js";import{a as i}from"./chunk-YX3VGNCD.js";import{a as r}from"./chunk-YM5K5MQ6.js";import{a as a}from"./chunk-6L5NM26F.js";import{b as o}from"./chunk-SPC72PTY.js";import{a as l}from"./chunk-HVWI7BO6.js";import{c as s,d as u}from"./chunk-BELR52CD.js";import{a as c,c as p}from"./chunk-BNHFHP3L.js";import"./chunk-4UHVCH4T.js";import{f as h,g as d,h as f,j as g}from"./chunk-4NDD6KRQ.js";import"./chunk-5ELDAYCN.js";import{a as m}from"./chunk-N6BI774S.js";import"./chunk-TI35VBH7.js";import"./chunk-6WLI3422.js";import{a as w,b as y,c as T}from"./chunk-ICY67TC6.js";import{a as k,b as _,c as O}from"./chunk-G2EMNOST.js";import{a as E}from"./chunk-4VFKVGYI.js";import{a as L,b as N}from"./chunk-3WJNS2B6.js";import{e as P}from"./chunk-XCN226AA.js";function A(e){e=e??O.EMPTY_OBJECT,this._ellipsoid=e.ellipsoid??T.default,this._rectangle=e.rectangle??g.MAX_VALUE,this._projection=new c(this._ellipsoid),this._numberOfLevelZeroTilesX=e.numberOfLevelZeroTilesX??2,this._numberOfLevelZeroTilesY=e.numberOfLevelZeroTilesY??1}Object.defineProperties(A.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),A.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},A.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},A.prototype.rectangleToNativeRectangle=function(e,t){N.defined("rectangle",e);let n=E.toDegrees(e.west),i=E.toDegrees(e.south),r=E.toDegrees(e.east),a=E.toDegrees(e.north);return P(t)?(t.west=n,t.south=i,t.east=r,t.north=a,t):new g(n,i,r,a)},A.prototype.tileXYToNativeRectangle=function(e,t,n,i){let r=this.tileXYToRectangle(e,t,n,i);return r.west=E.toDegrees(r.west),r.south=E.toDegrees(r.south),r.east=E.toDegrees(r.east),r.north=E.toDegrees(r.north),r},A.prototype.tileXYToRectangle=function(e,t,n,i){let r=this._rectangle,a=this.getNumberOfXTilesAtLevel(n),o=this.getNumberOfYTilesAtLevel(n),l=r.width/a,s=e*l+r.west,u=(e+1)*l+r.west,c=r.height/o,p=r.north-t*c,h=r.north-(t+1)*c;return P(i)||(i=new g(s,h,u,p)),i.west=s,i.south=h,i.east=u,i.north=p,i},A.prototype.positionToTileXY=function(e,t,n){let i=this._rectangle;if(!g.contains(i,e))return;let r=this.getNumberOfXTilesAtLevel(t),a=this.getNumberOfYTilesAtLevel(t),o=i.width/r,l=i.height/a,s=e.longitude;i.east<i.west&&(s+=E.TWO_PI);let u=(s-i.west)/o|0;u>=r&&(u=r-1);let c=(i.north-e.latitude)/l|0;return c>=a&&(c=a-1),P(n)?(n.x=u,n.y=c,n):new y(u,c)};var I=new k,b=new k,S=new w,j=new k,v=new k,x=new p,M=new A,C=[new w,new w,new w,new w],H=new y,D={};function z(e){w.fromRadians(e.east,e.north,0,C[0]),w.fromRadians(e.west,e.north,0,C[1]),w.fromRadians(e.east,e.south,0,C[2]),w.fromRadians(e.west,e.south,0,C[3]);let t=0,n=0,i=0,r=0,a=D._terrainHeightsMaxLevel,o;for(o=0;o<=a;++o){let e=!1;for(let t=0;t<4;++t){let n=C[t];if(M.positionToTileXY(n,o,H),0===t)i=H.x,r=H.y;else if(i!==H.x||r!==H.y){e=!0;break}}if(e)break;t=i,n=r}if(0!==o)return{x:t,y:n,level:o>a?a:o-1}}D.initialize=function(){let e=D._initPromise;return P(e)||(e=h.fetchJson(d("Assets/approximateTerrainHeights.json")).then(function(e){D._terrainHeights=e}),D._initPromise=e),e},D.getMinimumMaximumHeights=function(e,t){if(N.defined("rectangle",e),!P(D._terrainHeights))throw new L("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=t??T.default;let n=z(e),i=D._defaultMinTerrainHeight,r=D._defaultMaxTerrainHeight;if(P(n)){let a=`${n.level}-${n.x}-${n.y}`,o=D._terrainHeights[a];P(o)&&(i=o[0],r=o[1]),t.cartographicToCartesian(g.northeast(e,S),I),t.cartographicToCartesian(g.southwest(e,S),b),k.midpoint(b,I,j);let l=t.scaleToGeodeticSurface(j,v);i=P(l)?Math.min(i,-k.distance(j,l)):D._defaultMinTerrainHeight}return{minimumTerrainHeight:i=Math.max(D._defaultMinTerrainHeight,i),maximumTerrainHeight:r}},D.getBoundingSphere=function(e,t){if(N.defined("rectangle",e),!P(D._terrainHeights))throw new L("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=t??T.default;let n=z(e),i=D._defaultMaxTerrainHeight;if(P(n)){let e=`${n.level}-${n.x}-${n.y}`,t=D._terrainHeights[e];P(t)&&(i=t[1])}let r=p.fromRectangle3D(e,t,0);return p.fromRectangle3D(e,t,i,x),p.union(r,x,r)},D._terrainHeightsMaxLevel=6,D._defaultMaxTerrainHeight=9e3,D._defaultMinTerrainHeight=-1e5,D._terrainHeights=void 0,D._initPromise=void 0,Object.defineProperties(D,{initialized:{get:function(){return P(D._terrainHeights)}}});var R=[c,e],Y=R.length,B=Math.cos(E.toRadians(30)),F=Math.cos(E.toRadians(150));function X(e){let n=(e=e??O.EMPTY_OBJECT).positions;if(!P(n)||n.length<2)throw new L("At least two positions are required.");if(P(e.arcType)&&e.arcType!==t.GEODESIC&&e.arcType!==t.RHUMB)throw new L("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=e.width??1,this._positions=n,this.granularity=e.granularity??9999,this.loop=e.loop??!1,this.arcType=e.arcType??t.GEODESIC,this._ellipsoid=T.default,this._projectionIndex=0,this._workerName="createGroundPolylineGeometry",this._scene3DOnly=!1}Object.defineProperties(X.prototype,{packedLength:{get:function(){return 1+3*this._positions.length+1+1+1+T.packedLength+1+1}}}),X.setProjectionAndEllipsoid=function(e,t){let n=0;for(let e=0;e<Y;e++)if(t instanceof R[e]){n=e;break}e._projectionIndex=n,e._ellipsoid=t.ellipsoid};var V=new k,q=new k,G=new k;function U(e,t,n,i,r){let a=ee(i,e,0,V),o=ee(i,e,n,q),l=ee(i,t,0,G),s=et(o,a,q),u=et(l,a,G);return k.cross(u,s,r),k.normalize(r,r)}var W=new w,Z=new k,K=new k,$=new k;function Q(e,n,r,o,l,s,u,c,p,h,d){let f;if(0===l)return;s===t.GEODESIC?f=new i(e,n,u):s===t.RHUMB&&(f=new a(e,n,u));let g=f.surfaceDistance;if(g<l)return;let m=U(e,n,o,u,$),w=Math.ceil(g/l),y=g/w,T=y,_=w-1,O=c.length;for(let e=0;e<_;e++){let e=f.interpolateUsingSurfaceDistance(T,W),t=ee(u,e,r,Z),n=ee(u,e,o,K);k.pack(m,c,O),k.pack(t,p,O),k.pack(n,h,O),d.push(e.latitude),d.push(e.longitude),O+=3,T+=y}}var J=new w;function ee(e,t,n,i){return w.clone(t,J),J.height=n,w.toCartesian(J,e,i)}function et(e,t,n){return k.subtract(e,t,n),k.normalize(n,n),n}function en(e,t,n,i){return i=et(e,t,i),i=k.cross(i,n,i),i=k.normalize(i,i),i=k.cross(n,i,i)}X.pack=function(e,t,n){N.typeOf.object("value",e),N.defined("array",t);let i=n??0,r=e._positions,a=r.length;t[i++]=a;for(let e=0;e<a;++e){let n=r[e];k.pack(n,t,i),i+=3}return t[i++]=e.granularity,t[i++]=+!!e.loop,t[i++]=e.arcType,T.pack(e._ellipsoid,t,i),i+=T.packedLength,t[i++]=e._projectionIndex,t[i++]=+!!e._scene3DOnly,t},X.unpack=function(e,t,n){N.defined("array",e);let i=t??0,r=e[i++],a=Array(r);for(let t=0;t<r;t++)a[t]=k.unpack(e,i),i+=3;let o=e[i++],l=1===e[i++],s=e[i++],u=T.unpack(e,i);i+=T.packedLength;let c=e[i++],p=1===e[i++];return P(n)||(n=new X({positions:a})),n._positions=a,n.granularity=o,n.loop=l,n.arcType=s,n._ellipsoid=u,n._projectionIndex=c,n._scene3DOnly=p,n};var ei=new k,er=new k,ea=new k,eo=new k;function el(e,t,n,i,r){let a=et(n,t,eo),o=en(e,t,a,ei),l=en(i,t,a,er);if(E.equalsEpsilon(k.dot(o,l),-1,E.EPSILON5))return r=k.cross(a,o,r),r=k.normalize(r,r);r=k.add(l,o,r),r=k.normalize(r,r);let s=k.cross(a,r,ea);return 0>k.dot(l,s)&&(r=k.negate(r,r)),r}var es=l.fromPointNormal(k.ZERO,k.UNIT_Y),eu=new k,ec=new k,ep=new k,eh=new k,ed=new k,ef=new k,eg=new w,em=new w,ew=new w;X.createGeometry=function(e){let i=!e._scene3DOnly,l=e.loop,c=e._ellipsoid,h=e.granularity,d=e.arcType,f=new R[e._projectionIndex](c),y,T,_=e._positions,O=_.length;2===O&&(l=!1);let L,N,A,I,b=new a(void 0,void 0,c),S,j,v,x=[_[0]];for(T=0;T<O-1;T++)L=_[T],N=_[T+1],P(S=o.lineSegmentPlane(L,N,es,ef))&&!k.equalsEpsilon(S,L,E.EPSILON7)&&!k.equalsEpsilon(S,N,E.EPSILON7)&&(e.arcType===t.GEODESIC?x.push(k.clone(S)):e.arcType===t.RHUMB&&(v=c.cartesianToCartographic(S,eg).longitude,A=c.cartesianToCartographic(L,eg),I=c.cartesianToCartographic(N,em),b.setEndPoints(A,I),j=b.findIntersectionWithLongitude(v,ew),!P(S=c.cartographicToCartesian(j,ef))||k.equalsEpsilon(S,L,E.EPSILON7)||k.equalsEpsilon(S,N,E.EPSILON7)||x.push(k.clone(S)))),x.push(N);l&&(L=_[O-1],N=_[0],P(S=o.lineSegmentPlane(L,N,es,ef))&&!k.equalsEpsilon(S,L,E.EPSILON7)&&!k.equalsEpsilon(S,N,E.EPSILON7)&&(e.arcType===t.GEODESIC?x.push(k.clone(S)):e.arcType===t.RHUMB&&(v=c.cartesianToCartographic(S,eg).longitude,A=c.cartesianToCartographic(L,eg),I=c.cartesianToCartographic(N,em),b.setEndPoints(A,I),j=b.findIntersectionWithLongitude(v,ew),!P(S=c.cartographicToCartesian(j,ef))||k.equalsEpsilon(S,L,E.EPSILON7)||k.equalsEpsilon(S,N,E.EPSILON7)||x.push(k.clone(S)))));let M=x.length,C=Array(M);for(T=0;T<M;T++){let e=w.fromCartesian(x[T],c);e.height=0,C[T]=e}if((M=(C=r(C,w.equalsEpsilon)).length)<2)return;let H=[],z=[],Y=[],F=[],X=eu,V=ec,q=ep,G=eh,W=ed,Z=C[0],K=C[1];for(X=ee(c,C[M-1],0,X),G=ee(c,K,0,G),V=ee(c,Z,0,V),q=ee(c,Z,1e3,q),W=l?el(X,V,q,G,W):U(Z,K,1e3,c,W),k.pack(W,z,0),k.pack(V,Y,0),k.pack(q,F,0),H.push(Z.latitude),H.push(Z.longitude),Q(Z,K,0,1e3,h,d,c,z,Y,F,H),T=1;T<M-1;++T){X=k.clone(V,X),V=k.clone(G,V);let e=C[T];ee(c,e,1e3,q),ee(c,C[T+1],0,G),el(X,V,q,G,W),y=z.length,k.pack(W,z,y),k.pack(V,Y,y),k.pack(q,F,y),H.push(e.latitude),H.push(e.longitude),Q(C[T],C[T+1],0,1e3,h,d,c,z,Y,F,H)}let $=C[M-1],J=C[M-2];if(V=ee(c,$,0,V),q=ee(c,$,1e3,q),l){let e=C[0];W=el(X=ee(c,J,0,X),V,q,G=ee(c,e,0,G),W)}else W=U(J,$,1e3,c,W);if(y=z.length,k.pack(W,z,y),k.pack(V,Y,y),k.pack(q,F,y),H.push($.latitude),H.push($.longitude),l){for(Q($,Z,0,1e3,h,d,c,z,Y,F,H),y=z.length,T=0;T<3;++T)z[y+T]=z[T],Y[y+T]=Y[T],F[y+T]=F[T];H.push(Z.latitude),H.push(Z.longitude)}return function(e,t,i,r,a,o,l){let c,h,d,f=t._ellipsoid,w=i.length/3-1,y=8*w,T=4*y,_=36*w,O=y>65535?new Uint32Array(_):new Uint16Array(_),L=new Float64Array(3*y),N=new Float32Array(T),P=new Float32Array(T),A=new Float32Array(T),I=new Float32Array(T),b=new Float32Array(T),S,j,v,x;l&&(S=new Float32Array(T),j=new Float32Array(T),v=new Float32Array(T),x=new Float32Array(2*y));let M=o.length/2,C=0;ej.height=0,ev.height=0;let H=ex,z=eM;if(l)for(d=0,h=1;h<M;h++)ej.latitude=o[d],ej.longitude=o[d+1],ev.latitude=o[d+2],ev.longitude=o[d+3],H=t.project(ej,H),z=t.project(ev,z),C+=k.distance(H,z),d+=2;let R=r.length/3;z=k.unpack(r,0,z);let Y=0;for(d=3,h=1;h<R;h++)H=k.clone(z,H),z=k.unpack(r,d,z),Y+=k.distance(H,z),d+=3;d=3;let F=0,X=0,V=0,q=0,G=!1,U=k.unpack(i,0,eH),W=k.unpack(r,0,eM),Z=k.unpack(a,0,ez);e&&e_(Z,k.unpack(i,i.length-6,eC),U,W)&&(Z=k.negate(Z,Z));let K=0,$=0,Q=0;for(h=0;h<w;h++){let e,s,u,p,h=k.clone(U,eC),m=k.clone(W,ex),w=k.clone(Z,eD);if(G&&(w=k.negate(w,w)),U=k.unpack(i,d,eH),W=k.unpack(r,d,eM),G=e_(Z=k.unpack(a,d,ez),h,U,W),ej.latitude=o[F],ej.longitude=o[F+1],ev.latitude=o[F+2],ev.longitude=o[F+3],l){let n=function(e,t){let n=Math.abs(e.longitude),i=Math.abs(t.longitude);return E.equalsEpsilon(n,E.PI,E.EPSILON11)?(e.longitude=E.sign(t.longitude)*(n-E.EPSILON11),1):E.equalsEpsilon(i,E.PI,E.EPSILON11)?(t.longitude=E.sign(e.longitude)*(i-E.EPSILON11),2):0}(ej,ev);e=t.project(ej,eq);let i=et(s=t.project(ev,eG),e,e2);i.y=Math.abs(i.y),u=eU,p=eW,0===n||k.dot(i,k.UNIT_Y)>B?(u=eN(t,ej,w,e,eU),p=eN(t,ev,Z,s,eW)):1===n?(p=eN(t,ev,Z,s,eW),u.x=0,u.y=E.sign(ej.longitude-Math.abs(ev.longitude)),u.z=0):(u=eN(t,ej,w,e,eU),p.x=0,p.y=E.sign(ej.longitude-ev.longitude),p.z=0)}let y=k.distance(m,W),T=n.fromCartesian(h,e1),_=k.subtract(U,h,eZ),O=k.normalize(_,eQ),M=k.subtract(m,h,eK);M=k.normalize(M,M);let H=k.cross(O,M,eQ);H=k.normalize(H,H);let z=k.cross(M,w,eJ);z=k.normalize(z,z);let R=k.subtract(W,U,e$);R=k.normalize(R,R);let J=k.cross(Z,R,e0);J=k.normalize(J,J);let ee=y/Y,en=K/Y,ei=0,er,ea,eo,el=0,es=0;if(l){ei=k.distance(e,s),er=n.fromCartesian(e,e3),ea=k.subtract(s,e,e2);let t=(eo=k.normalize(ea,e6)).x;eo.x=eo.y,eo.y=-t,el=ei/C,es=$/C}for(c=0;c<8;c++){let e=q+4*c,t=X+2*c,n=e+3,i=c<4?1:-1,r=2===c||3===c||6===c||7===c?1:-1;k.pack(T.high,N,e),N[n]=_.x,k.pack(T.low,P,e),P[n]=_.y,k.pack(z,A,e),A[n]=_.z,k.pack(J,I,e),I[n]=ee*i,k.pack(H,b,e);let a=en*r;0===a&&r<0&&(a=9),b[n]=a,l&&(S[e]=er.high.x,S[e+1]=er.high.y,S[e+2]=er.low.x,S[e+3]=er.low.y,v[e]=-u.y,v[e+1]=u.x,v[e+2]=p.y,v[e+3]=-p.x,j[e]=ea.x,j[e+1]=ea.y,j[e+2]=eo.x,j[e+3]=eo.y,x[t]=el*i,0==(a=es*r)&&r<0&&(a=9),x[t+1]=a)}let eu=g.fromCartographicArray(eR,eY),ec=D.getMinimumMaximumHeights(eu,f),ep=ec.minimumTerrainHeight,eh=ec.maximumTerrainHeight;Q+=Math.abs(ep),Q+=Math.abs(eh),eI(h,m,ep,eh,eX,eB),eI(U,W,ep,eh,eV,eF);let ed=k.multiplyByScalar(H,E.EPSILON5,e5);k.add(eX,ed,eX),k.add(eV,ed,eV),k.add(eB,ed,eB),k.add(eF,ed,eF),eS(eX,eV),eS(eB,eF),k.pack(eX,L,V),k.pack(eV,L,V+3),k.pack(eF,L,V+6),k.pack(eB,L,V+9),ed=k.multiplyByScalar(H,-2*E.EPSILON5,e5),k.add(eX,ed,eX),k.add(eV,ed,eV),k.add(eB,ed,eB),k.add(eF,ed,eF),eS(eX,eV),eS(eB,eF),k.pack(eX,L,V+12),k.pack(eV,L,V+15),k.pack(eF,L,V+18),k.pack(eB,L,V+21),F+=2,d+=3,X+=16,V+=24,q+=32,K+=y,$+=ei}d=0;let J=0;for(h=0;h<w;h++){for(c=0;c<e9;c++)O[d+c]=e4[c]+J;J+=8,d+=e9}p.fromVertices(i,k.ZERO,3,e7[0]),p.fromVertices(r,k.ZERO,3,e7[1]);let ee=p.fromBoundingSpheres(e7);ee.radius+=Q/(2*w);let en={position:new u({componentDatatype:m.DOUBLE,componentsPerAttribute:3,normalize:!1,values:L}),startHiAndForwardOffsetX:e8(N),startLoAndForwardOffsetY:e8(P),startNormalAndForwardOffsetZ:e8(A),endNormalAndTextureCoordinateNormalizationX:e8(I),rightNormalAndTextureCoordinateNormalizationY:e8(b)};return l&&(en.startHiLo2D=e8(S),en.offsetAndRight2D=e8(j),en.startEndNormals2D=e8(v),en.texcoordNormalization2D=new u({componentDatatype:m.FLOAT,componentsPerAttribute:2,normalize:!1,values:x})),new s({attributes:en,indices:O,boundingSphere:ee})}(l,f,Y,F,z,H,i)};var ey=new k,eT=new _,ek=new f;function e_(e,t,n,i){let r=et(n,t,ey),a=k.dot(r,e);if(a>B||a<F){let t=et(i,n,eo),r=a<F?E.PI_OVER_TWO:-E.PI_OVER_TWO,o=f.fromAxisAngle(t,r,ek),l=_.fromQuaternion(o,eT);return _.multiplyByVector(l,e,e),!0}return!1}var eO=new w,eE=new k,eL=new k;function eN(e,t,n,i,r){let a=w.toCartesian(t,e._ellipsoid,eE),o=k.add(a,n,eL),l=!1,s=e._ellipsoid,u=s.cartesianToCartographic(o,eO);Math.abs(t.longitude-u.longitude)>E.PI_OVER_TWO&&(l=!0,o=k.subtract(a,n,eL),u=s.cartesianToCartographic(o,eO)),u.height=0;let c=e.project(u,r);return(r=k.subtract(c,i,r)).z=0,r=k.normalize(r,r),l&&k.negate(r,r),r}var eP=new k,eA=new k;function eI(e,t,n,i,r,a){let o=k.subtract(t,e,eP);k.normalize(o,o);let l=k.multiplyByScalar(o,n-0,eA);k.add(e,l,r),l=k.multiplyByScalar(o,i-1e3,eA),k.add(t,l,a)}var eb=new k;function eS(e,t){let n=l.getPointDistance(es,e),i=l.getPointDistance(es,t),r=eb;E.equalsEpsilon(n,0,E.EPSILON2)?(r=et(t,e,r),k.multiplyByScalar(r,E.EPSILON2,r),k.add(e,r,e)):E.equalsEpsilon(i,0,E.EPSILON2)&&(r=et(e,t,r),k.multiplyByScalar(r,E.EPSILON2,r),k.add(t,r,t))}var ej=new w,ev=new w,ex=new k,eM=new k,eC=new k,eH=new k,eD=new k,ez=new k,eR=[ej,ev],eY=new g,eB=new k,eF=new k,eX=new k,eV=new k,eq=new k,eG=new k,eU=new k,eW=new k,eZ=new k,eK=new k,e$=new k,eQ=new k,eJ=new k,e0=new k,e1=new n,e3=new n,e2=new k,e6=new k,e5=new k,e7=[new p,new p],e4=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],e9=e4.length;function e8(e){return new u({componentDatatype:m.FLOAT,componentsPerAttribute:4,normalize:!1,values:e})}X._projectNormal=eN;var te=function(e,t){return D.initialize().then(function(){return P(t)&&(e=X.unpack(e,t)),X.createGeometry(e)})};export{te as default};