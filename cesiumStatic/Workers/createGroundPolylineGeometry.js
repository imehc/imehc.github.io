import{a as e}from"./chunk-VJHOZLST.js";import{a as t}from"./chunk-MCM3P7ZC.js";import{a as n}from"./chunk-MUKCYY2X.js";import{a as i}from"./chunk-TULFNR3P.js";import{a as r}from"./chunk-KF74ULE7.js";import{a as a}from"./chunk-4EHG4BFI.js";import{b as o}from"./chunk-KIJM7B3H.js";import{a as l}from"./chunk-P44F6KLE.js";import{c as s,d as u}from"./chunk-UIGT6VOJ.js";import{a as c,c as p}from"./chunk-XO2FNJZK.js";import"./chunk-CM5O7VPK.js";import{f as h,g as d,h as f,j as g}from"./chunk-IB27QQGF.js";import"./chunk-RGFEE67W.js";import{a as m}from"./chunk-KXT7EZPS.js";import"./chunk-ZIOQOCPQ.js";import"./chunk-SY2GINYP.js";import{a as w,b as y,c as T}from"./chunk-KCR7AORG.js";import{a as k,b as O,c as _}from"./chunk-QDJTHWTA.js";import{a as E}from"./chunk-2YWR3G22.js";import{a as P,b as L}from"./chunk-HTSQLHXI.js";import{e as I}from"./chunk-JDAHMWM5.js";function A(e){e=e??_.EMPTY_OBJECT,this._ellipsoid=e.ellipsoid??T.default,this._rectangle=e.rectangle??g.MAX_VALUE,this._projection=new c(this._ellipsoid),this._numberOfLevelZeroTilesX=e.numberOfLevelZeroTilesX??2,this._numberOfLevelZeroTilesY=e.numberOfLevelZeroTilesY??1}Object.defineProperties(A.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),A.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},A.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},A.prototype.rectangleToNativeRectangle=function(e,t){L.defined("rectangle",e);let n=E.toDegrees(e.west),i=E.toDegrees(e.south),r=E.toDegrees(e.east),a=E.toDegrees(e.north);return I(t)?(t.west=n,t.south=i,t.east=r,t.north=a,t):new g(n,i,r,a)},A.prototype.tileXYToNativeRectangle=function(e,t,n,i){let r=this.tileXYToRectangle(e,t,n,i);return r.west=E.toDegrees(r.west),r.south=E.toDegrees(r.south),r.east=E.toDegrees(r.east),r.north=E.toDegrees(r.north),r},A.prototype.tileXYToRectangle=function(e,t,n,i){let r=this._rectangle,a=this.getNumberOfXTilesAtLevel(n),o=this.getNumberOfYTilesAtLevel(n),l=r.width/a,s=e*l+r.west,u=(e+1)*l+r.west,c=r.height/o,p=r.north-t*c,h=r.north-(t+1)*c;return I(i)||(i=new g(s,h,u,p)),i.west=s,i.south=h,i.east=u,i.north=p,i},A.prototype.positionToTileXY=function(e,t,n){let i=this._rectangle;if(!g.contains(i,e))return;let r=this.getNumberOfXTilesAtLevel(t),a=this.getNumberOfYTilesAtLevel(t),o=i.width/r,l=i.height/a,s=e.longitude;i.east<i.west&&(s+=E.TWO_PI);let u=(s-i.west)/o|0;u>=r&&(u=r-1);let c=(i.north-e.latitude)/l|0;return c>=a&&(c=a-1),I(n)?(n.x=u,n.y=c,n):new y(u,c)};var b=new k,j=new k,v=new w,N=new k,S=new k,x=new p,M=new A,H=[new w,new w,new w,new w],C=new y,D={};function z(e){w.fromRadians(e.east,e.north,0,H[0]),w.fromRadians(e.west,e.north,0,H[1]),w.fromRadians(e.east,e.south,0,H[2]),w.fromRadians(e.west,e.south,0,H[3]);let t=0,n=0,i=0,r=0,a=D._terrainHeightsMaxLevel,o;for(o=0;o<=a;++o){let e=!1;for(let t=0;t<4;++t){let n=H[t];if(M.positionToTileXY(n,o,C),0===t)i=C.x,r=C.y;else if(i!==C.x||r!==C.y){e=!0;break}}if(e)break;t=i,n=r}if(0!==o)return{x:t,y:n,level:o>a?a:o-1}}D.initialize=function(){let e=D._initPromise;return I(e)||(e=h.fetchJson(d("Assets/approximateTerrainHeights.json")).then(function(e){D._terrainHeights=e}),D._initPromise=e),e},D.getMinimumMaximumHeights=function(e,t){if(L.defined("rectangle",e),!I(D._terrainHeights))throw new P("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=t??T.default;let n=z(e),i=D._defaultMinTerrainHeight,r=D._defaultMaxTerrainHeight;if(I(n)){let a=`${n.level}-${n.x}-${n.y}`,o=D._terrainHeights[a];I(o)&&(i=o[0],r=o[1]),t.cartographicToCartesian(g.northeast(e,v),b),t.cartographicToCartesian(g.southwest(e,v),j),k.midpoint(j,b,N);let l=t.scaleToGeodeticSurface(N,S);i=I(l)?Math.min(i,-k.distance(N,l)):D._defaultMinTerrainHeight}return{minimumTerrainHeight:i=Math.max(D._defaultMinTerrainHeight,i),maximumTerrainHeight:r}},D.getBoundingSphere=function(e,t){if(L.defined("rectangle",e),!I(D._terrainHeights))throw new P("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=t??T.default;let n=z(e),i=D._defaultMaxTerrainHeight;if(I(n)){let e=`${n.level}-${n.x}-${n.y}`,t=D._terrainHeights[e];I(t)&&(i=t[1])}let r=p.fromRectangle3D(e,t,0);return p.fromRectangle3D(e,t,i,x),p.union(r,x,r)},D._terrainHeightsMaxLevel=6,D._defaultMaxTerrainHeight=9e3,D._defaultMinTerrainHeight=-1e5,D._terrainHeights=void 0,D._initPromise=void 0,Object.defineProperties(D,{initialized:{get:function(){return I(D._terrainHeights)}}});var R=[c,e],Y=R.length,F=Math.cos(E.toRadians(30)),B=Math.cos(E.toRadians(150));function G(e){let n=(e=e??_.EMPTY_OBJECT).positions;if(!I(n)||n.length<2)throw new P("At least two positions are required.");if(I(e.arcType)&&e.arcType!==t.GEODESIC&&e.arcType!==t.RHUMB)throw new P("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=e.width??1,this._positions=n,this.granularity=e.granularity??9999,this.loop=e.loop??!1,this.arcType=e.arcType??t.GEODESIC,this._ellipsoid=T.default,this._projectionIndex=0,this._workerName="createGroundPolylineGeometry",this._scene3DOnly=!1}Object.defineProperties(G.prototype,{packedLength:{get:function(){return 1+3*this._positions.length+1+1+1+T.packedLength+1+1}}}),G.setProjectionAndEllipsoid=function(e,t){let n=0;for(let e=0;e<Y;e++)if(t instanceof R[e]){n=e;break}e._projectionIndex=n,e._ellipsoid=t.ellipsoid};var X=new k,U=new k,q=new k;function Z(e,t,n,i,r){let a=ee(i,e,0,X),o=ee(i,e,n,U),l=ee(i,t,0,q),s=et(o,a,U),u=et(l,a,q);return k.cross(u,s,r),k.normalize(r,r)}var V=new w,W=new k,J=new k,K=new k;function Q(e,n,r,o,l,s,u,c,p,h,d){let f;if(0===l)return;s===t.GEODESIC?f=new i(e,n,u):s===t.RHUMB&&(f=new a(e,n,u));let g=f.surfaceDistance;if(g<l)return;let m=Z(e,n,o,u,K),w=Math.ceil(g/l),y=g/w,T=y,O=w-1,_=c.length;for(let e=0;e<O;e++){let e=f.interpolateUsingSurfaceDistance(T,V),t=ee(u,e,r,W),n=ee(u,e,o,J);k.pack(m,c,_),k.pack(t,p,_),k.pack(n,h,_),d.push(e.latitude),d.push(e.longitude),_+=3,T+=y}}var $=new w;function ee(e,t,n,i){return w.clone(t,$),$.height=n,w.toCartesian($,e,i)}function et(e,t,n){return k.subtract(e,t,n),k.normalize(n,n),n}function en(e,t,n,i){return i=et(e,t,i),i=k.cross(i,n,i),i=k.normalize(i,i),i=k.cross(n,i,i)}G.pack=function(e,t,n){L.typeOf.object("value",e),L.defined("array",t);let i=n??0,r=e._positions,a=r.length;t[i++]=a;for(let e=0;e<a;++e){let n=r[e];k.pack(n,t,i),i+=3}return t[i++]=e.granularity,t[i++]=+!!e.loop,t[i++]=e.arcType,T.pack(e._ellipsoid,t,i),i+=T.packedLength,t[i++]=e._projectionIndex,t[i++]=+!!e._scene3DOnly,t},G.unpack=function(e,t,n){L.defined("array",e);let i=t??0,r=e[i++],a=Array(r);for(let t=0;t<r;t++)a[t]=k.unpack(e,i),i+=3;let o=e[i++],l=1===e[i++],s=e[i++],u=T.unpack(e,i);i+=T.packedLength;let c=e[i++],p=1===e[i++];return I(n)||(n=new G({positions:a})),n._positions=a,n.granularity=o,n.loop=l,n.arcType=s,n._ellipsoid=u,n._projectionIndex=c,n._scene3DOnly=p,n};var ei=new k,er=new k,ea=new k,eo=new k;function el(e,t,n,i,r){let a=et(n,t,eo),o=en(e,t,a,ei),l=en(i,t,a,er);if(E.equalsEpsilon(k.dot(o,l),-1,E.EPSILON5))return r=k.cross(a,o,r),r=k.normalize(r,r);r=k.add(l,o,r),r=k.normalize(r,r);let s=k.cross(a,r,ea);return 0>k.dot(l,s)&&(r=k.negate(r,r)),r}var es=l.fromPointNormal(k.ZERO,k.UNIT_Y),eu=new k,ec=new k,ep=new k,eh=new k,ed=new k,ef=new k,eg=new w,em=new w,ew=new w;G.createGeometry=function(e){let i=!e._scene3DOnly,l=e.loop,c=e._ellipsoid,h=e.granularity,d=e.arcType,f=new R[e._projectionIndex](c),y,T,O=e._positions,_=O.length;2===_&&(l=!1);let P,L,A,b,j=new a(void 0,void 0,c),v,N,S,x=[O[0]];for(T=0;T<_-1;T++)P=O[T],L=O[T+1],I(v=o.lineSegmentPlane(P,L,es,ef))&&!k.equalsEpsilon(v,P,E.EPSILON7)&&!k.equalsEpsilon(v,L,E.EPSILON7)&&(e.arcType===t.GEODESIC?x.push(k.clone(v)):e.arcType===t.RHUMB&&(S=c.cartesianToCartographic(v,eg).longitude,A=c.cartesianToCartographic(P,eg),b=c.cartesianToCartographic(L,em),j.setEndPoints(A,b),N=j.findIntersectionWithLongitude(S,ew),!I(v=c.cartographicToCartesian(N,ef))||k.equalsEpsilon(v,P,E.EPSILON7)||k.equalsEpsilon(v,L,E.EPSILON7)||x.push(k.clone(v)))),x.push(L);l&&(P=O[_-1],L=O[0],I(v=o.lineSegmentPlane(P,L,es,ef))&&!k.equalsEpsilon(v,P,E.EPSILON7)&&!k.equalsEpsilon(v,L,E.EPSILON7)&&(e.arcType===t.GEODESIC?x.push(k.clone(v)):e.arcType===t.RHUMB&&(S=c.cartesianToCartographic(v,eg).longitude,A=c.cartesianToCartographic(P,eg),b=c.cartesianToCartographic(L,em),j.setEndPoints(A,b),N=j.findIntersectionWithLongitude(S,ew),!I(v=c.cartographicToCartesian(N,ef))||k.equalsEpsilon(v,P,E.EPSILON7)||k.equalsEpsilon(v,L,E.EPSILON7)||x.push(k.clone(v)))));let M=x.length,H=Array(M);for(T=0;T<M;T++){let e=w.fromCartesian(x[T],c);e.height=0,H[T]=e}if((M=(H=r(H,w.equalsEpsilon)).length)<2)return;let C=[],z=[],Y=[],B=[],G=eu,X=ec,U=ep,q=eh,V=ed,W=H[0],J=H[1];for(G=ee(c,H[M-1],0,G),q=ee(c,J,0,q),X=ee(c,W,0,X),U=ee(c,W,1e3,U),V=l?el(G,X,U,q,V):Z(W,J,1e3,c,V),k.pack(V,z,0),k.pack(X,Y,0),k.pack(U,B,0),C.push(W.latitude),C.push(W.longitude),Q(W,J,0,1e3,h,d,c,z,Y,B,C),T=1;T<M-1;++T){G=k.clone(X,G),X=k.clone(q,X);let e=H[T];ee(c,e,1e3,U),ee(c,H[T+1],0,q),el(G,X,U,q,V),y=z.length,k.pack(V,z,y),k.pack(X,Y,y),k.pack(U,B,y),C.push(e.latitude),C.push(e.longitude),Q(H[T],H[T+1],0,1e3,h,d,c,z,Y,B,C)}let K=H[M-1],$=H[M-2];if(X=ee(c,K,0,X),U=ee(c,K,1e3,U),l){let e=H[0];V=el(G=ee(c,$,0,G),X,U,q=ee(c,e,0,q),V)}else V=Z($,K,1e3,c,V);if(y=z.length,k.pack(V,z,y),k.pack(X,Y,y),k.pack(U,B,y),C.push(K.latitude),C.push(K.longitude),l){for(Q(K,W,0,1e3,h,d,c,z,Y,B,C),y=z.length,T=0;T<3;++T)z[y+T]=z[T],Y[y+T]=Y[T],B[y+T]=B[T];C.push(W.latitude),C.push(W.longitude)}return function(e,t,i,r,a,o,l){let c,h,d,f=t._ellipsoid,w=i.length/3-1,y=8*w,T=4*y,O=36*w,_=y>65535?new Uint32Array(O):new Uint16Array(O),P=new Float64Array(3*y),L=new Float32Array(T),I=new Float32Array(T),A=new Float32Array(T),b=new Float32Array(T),j=new Float32Array(T),v,N,S,x;l&&(v=new Float32Array(T),N=new Float32Array(T),S=new Float32Array(T),x=new Float32Array(2*y));let M=o.length/2,H=0;eN.height=0,eS.height=0;let C=ex,z=eM;if(l)for(d=0,h=1;h<M;h++)eN.latitude=o[d],eN.longitude=o[d+1],eS.latitude=o[d+2],eS.longitude=o[d+3],C=t.project(eN,C),z=t.project(eS,z),H+=k.distance(C,z),d+=2;let R=r.length/3;z=k.unpack(r,0,z);let Y=0;for(d=3,h=1;h<R;h++)C=k.clone(z,C),z=k.unpack(r,d,z),Y+=k.distance(C,z),d+=3;d=3;let B=0,G=0,X=0,U=0,q=!1,Z=k.unpack(i,0,eC),V=k.unpack(r,0,eM),W=k.unpack(a,0,ez);e&&eO(W,k.unpack(i,i.length-6,eH),Z,V)&&(W=k.negate(W,W));let J=0,K=0,Q=0;for(h=0;h<w;h++){let e,s,u,p,h=k.clone(Z,eH),m=k.clone(V,ex),w=k.clone(W,eD);if(q&&(w=k.negate(w,w)),Z=k.unpack(i,d,eC),V=k.unpack(r,d,eM),q=eO(W=k.unpack(a,d,ez),h,Z,V),eN.latitude=o[B],eN.longitude=o[B+1],eS.latitude=o[B+2],eS.longitude=o[B+3],l){let n=function(e,t){let n=Math.abs(e.longitude),i=Math.abs(t.longitude);return E.equalsEpsilon(n,E.PI,E.EPSILON11)?(e.longitude=E.sign(t.longitude)*(n-E.EPSILON11),1):E.equalsEpsilon(i,E.PI,E.EPSILON11)?(t.longitude=E.sign(e.longitude)*(i-E.EPSILON11),2):0}(eN,eS);e=t.project(eN,eU);let i=et(s=t.project(eS,eq),e,e2);i.y=Math.abs(i.y),u=eZ,p=eV,0===n||k.dot(i,k.UNIT_Y)>F?(u=eL(t,eN,w,e,eZ),p=eL(t,eS,W,s,eV)):1===n?(p=eL(t,eS,W,s,eV),u.x=0,u.y=E.sign(eN.longitude-Math.abs(eS.longitude)),u.z=0):(u=eL(t,eN,w,e,eZ),p.x=0,p.y=E.sign(eN.longitude-eS.longitude),p.z=0)}let y=k.distance(m,V),T=n.fromCartesian(h,e1),O=k.subtract(Z,h,eW),_=k.normalize(O,eQ),M=k.subtract(m,h,eJ);M=k.normalize(M,M);let C=k.cross(_,M,eQ);C=k.normalize(C,C);let z=k.cross(M,w,e$);z=k.normalize(z,z);let R=k.subtract(V,Z,eK);R=k.normalize(R,R);let $=k.cross(W,R,e0);$=k.normalize($,$);let ee=y/Y,en=J/Y,ei=0,er,ea,eo,el=0,es=0;if(l){ei=k.distance(e,s),er=n.fromCartesian(e,e3),ea=k.subtract(s,e,e2);let t=(eo=k.normalize(ea,e7)).x;eo.x=eo.y,eo.y=-t,el=ei/H,es=K/H}for(c=0;c<8;c++){let e=U+4*c,t=G+2*c,n=e+3,i=c<4?1:-1,r=2===c||3===c||6===c||7===c?1:-1;k.pack(T.high,L,e),L[n]=O.x,k.pack(T.low,I,e),I[n]=O.y,k.pack(z,A,e),A[n]=O.z,k.pack($,b,e),b[n]=ee*i,k.pack(C,j,e);let a=en*r;0===a&&r<0&&(a=9),j[n]=a,l&&(v[e]=er.high.x,v[e+1]=er.high.y,v[e+2]=er.low.x,v[e+3]=er.low.y,S[e]=-u.y,S[e+1]=u.x,S[e+2]=p.y,S[e+3]=-p.x,N[e]=ea.x,N[e+1]=ea.y,N[e+2]=eo.x,N[e+3]=eo.y,x[t]=el*i,0==(a=es*r)&&r<0&&(a=9),x[t+1]=a)}let eu=g.fromCartographicArray(eR,eY),ec=D.getMinimumMaximumHeights(eu,f),ep=ec.minimumTerrainHeight,eh=ec.maximumTerrainHeight;Q+=Math.abs(ep),Q+=Math.abs(eh),eb(h,m,ep,eh,eG,eF),eb(Z,V,ep,eh,eX,eB);let ed=k.multiplyByScalar(C,E.EPSILON5,e5);k.add(eG,ed,eG),k.add(eX,ed,eX),k.add(eF,ed,eF),k.add(eB,ed,eB),ev(eG,eX),ev(eF,eB),k.pack(eG,P,X),k.pack(eX,P,X+3),k.pack(eB,P,X+6),k.pack(eF,P,X+9),ed=k.multiplyByScalar(C,-2*E.EPSILON5,e5),k.add(eG,ed,eG),k.add(eX,ed,eX),k.add(eF,ed,eF),k.add(eB,ed,eB),ev(eG,eX),ev(eF,eB),k.pack(eG,P,X+12),k.pack(eX,P,X+15),k.pack(eB,P,X+18),k.pack(eF,P,X+21),B+=2,d+=3,G+=16,X+=24,U+=32,J+=y,K+=ei}d=0;let $=0;for(h=0;h<w;h++){for(c=0;c<e9;c++)_[d+c]=e4[c]+$;$+=8,d+=e9}p.fromVertices(i,k.ZERO,3,e6[0]),p.fromVertices(r,k.ZERO,3,e6[1]);let ee=p.fromBoundingSpheres(e6);ee.radius+=Q/(2*w);let en={position:new u({componentDatatype:m.DOUBLE,componentsPerAttribute:3,normalize:!1,values:P}),startHiAndForwardOffsetX:e8(L),startLoAndForwardOffsetY:e8(I),startNormalAndForwardOffsetZ:e8(A),endNormalAndTextureCoordinateNormalizationX:e8(b),rightNormalAndTextureCoordinateNormalizationY:e8(j)};return l&&(en.startHiLo2D=e8(v),en.offsetAndRight2D=e8(N),en.startEndNormals2D=e8(S),en.texcoordNormalization2D=new u({componentDatatype:m.FLOAT,componentsPerAttribute:2,normalize:!1,values:x})),new s({attributes:en,indices:_,boundingSphere:ee})}(l,f,Y,B,z,C,i)};var ey=new k,eT=new O,ek=new f;function eO(e,t,n,i){let r=et(n,t,ey),a=k.dot(r,e);if(a>F||a<B){let t=et(i,n,eo),r=a<B?E.PI_OVER_TWO:-E.PI_OVER_TWO,o=f.fromAxisAngle(t,r,ek),l=O.fromQuaternion(o,eT);return O.multiplyByVector(l,e,e),!0}return!1}var e_=new w,eE=new k,eP=new k;function eL(e,t,n,i,r){let a=w.toCartesian(t,e._ellipsoid,eE),o=k.add(a,n,eP),l=!1,s=e._ellipsoid,u=s.cartesianToCartographic(o,e_);Math.abs(t.longitude-u.longitude)>E.PI_OVER_TWO&&(l=!0,o=k.subtract(a,n,eP),u=s.cartesianToCartographic(o,e_)),u.height=0;let c=e.project(u,r);return(r=k.subtract(c,i,r)).z=0,r=k.normalize(r,r),l&&k.negate(r,r),r}var eI=new k,eA=new k;function eb(e,t,n,i,r,a){let o=k.subtract(t,e,eI);k.normalize(o,o);let l=k.multiplyByScalar(o,n-0,eA);k.add(e,l,r),l=k.multiplyByScalar(o,i-1e3,eA),k.add(t,l,a)}var ej=new k;function ev(e,t){let n=l.getPointDistance(es,e),i=l.getPointDistance(es,t),r=ej;E.equalsEpsilon(n,0,E.EPSILON2)?(r=et(t,e,r),k.multiplyByScalar(r,E.EPSILON2,r),k.add(e,r,e)):E.equalsEpsilon(i,0,E.EPSILON2)&&(r=et(e,t,r),k.multiplyByScalar(r,E.EPSILON2,r),k.add(t,r,t))}var eN=new w,eS=new w,ex=new k,eM=new k,eH=new k,eC=new k,eD=new k,ez=new k,eR=[eN,eS],eY=new g,eF=new k,eB=new k,eG=new k,eX=new k,eU=new k,eq=new k,eZ=new k,eV=new k,eW=new k,eJ=new k,eK=new k,eQ=new k,e$=new k,e0=new k,e1=new n,e3=new n,e2=new k,e7=new k,e5=new k,e6=[new p,new p],e4=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],e9=e4.length;function e8(e){return new u({componentDatatype:m.FLOAT,componentsPerAttribute:4,normalize:!1,values:e})}G._projectNormal=eL;var te=function(e,t){return D.initialize().then(function(){return I(t)&&(e=G.unpack(e,t)),G.createGeometry(e)})};export{te as default};