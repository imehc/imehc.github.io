import{a as e}from"./chunk-ILB4KG4E.js";import{a as t}from"./chunk-NPKIHRIX.js";import{a as r}from"./chunk-GSMLTRAL.js";import{c as s,j as a}from"./chunk-IB27QQGF.js";import"./chunk-RGFEE67W.js";import"./chunk-KXT7EZPS.js";import"./chunk-ZIOQOCPQ.js";import"./chunk-SY2GINYP.js";import{a as n,c as i}from"./chunk-KCR7AORG.js";import{a as o}from"./chunk-QDJTHWTA.js";import{a as l}from"./chunk-2YWR3G22.js";import"./chunk-HTSQLHXI.js";import"./chunk-JDAHMWM5.js";var d=Math.cos(l.toRadians(150)),f=new n,c=new o,h=new n,u=new n;function p(e){let t=8*e,s=3*t,a=4*t;this.startEllipsoidNormals=new Float32Array(s),this.endEllipsoidNormals=new Float32Array(s),this.startPositionAndHeights=new Float32Array(a),this.startFaceNormalAndVertexCornerIds=new Float32Array(a),this.endPositionAndHeights=new Float32Array(a),this.endFaceNormalAndHalfWidths=new Float32Array(a),this.vertexBatchIds=new Uint16Array(t),this.indices=r.createTypedArray(t,36*e),this.vec3Offset=0,this.vec4Offset=0,this.batchIdOffset=0,this.indexOffset=0,this.volumeStartIndex=0}var m=new o,A=new o;function w(e,t,r,s,a){let n=o.subtract(r,t,A),i=o.subtract(t,e,m);return o.normalize(n,n),o.normalize(i,i),o.dot(n,i)<d&&(i=o.multiplyByScalar(i,-1,m)),o.add(n,i,a),o.equals(a,o.ZERO)&&(a=o.subtract(e,t)),o.cross(a,s,a),o.cross(s,a,a),o.normalize(a,a),a}var k=[0,2,6,0,6,4,0,1,3,0,3,2,0,4,5,0,5,1,5,3,1,5,7,3,7,5,4,7,4,6,7,6,2,7,2,3],b=k.length,N=new o,g=new o,I=new o,y=new o,E=new o;p.prototype.addVolume=function(e,t,r,s,a,n,i,l,d,f){let c=o.add(t,d,N),h=f.geodeticSurfaceNormal(c,g);c=o.add(r,d,N);let u=f.geodeticSurfaceNormal(c,y),p=w(e,t,r,h,I),m=w(s,r,t,u,E),A=this.startEllipsoidNormals,F=this.endEllipsoidNormals,H=this.startPositionAndHeights,x=this.startFaceNormalAndVertexCornerIds,v=this.endPositionAndHeights,O=this.endFaceNormalAndHalfWidths,P=this.vertexBatchIds,j=this.batchIdOffset,S=this.vec3Offset,R=this.vec4Offset,T;for(T=0;T<8;T++)o.pack(h,A,S),o.pack(u,F,S),o.pack(t,H,R),H[R+3]=a,o.pack(r,v,R),v[R+3]=n,o.pack(p,x,R),x[R+3]=T,o.pack(m,O,R),O[R+3]=i,P[j++]=l,S+=3,R+=4;this.batchIdOffset=j,this.vec3Offset=S,this.vec4Offset=R;let B=this.indices,G=this.volumeStartIndex,U=this.indexOffset;for(T=0;T<b;T++)B[U+T]=k[T]+G;this.volumeStartIndex+=8,this.indexOffset+=b};var F=new a,H=new i,x=new o,v=new o,O=new o,P=new o,j=new o,S=e(function(e,d){let m=new Uint16Array(e.positions),A=new Uint16Array(e.widths),w=new Uint32Array(e.counts),k=new Uint16Array(e.batchIds),b=new Float64Array(e.packedBuffer),N=0,g=b[N++],I=b[N++];a.unpack(b,N,F),N+=a.packedLength,i.unpack(b,N,H),N+=i.packedLength,o.unpack(b,N,x);let y,E=m.length/3,S=m.subarray(0,E),R=m.subarray(E,2*E),T=m.subarray(2*E,3*E);t.zigZagDeltaDecode(S,R,T),function(e,t,r,s){let a=s.length,i=e.length,o=new Uint8Array(i),l=0;for(let r=0;r<a;r++){let a=s[r],i=a;for(let r=1;r<a;r++){let s=l+r,a=s-1;u.longitude=e[s],u.latitude=t[s],h.longitude=e[a],h.latitude=t[a],n.equals(u,h)&&(i--,o[a]=1)}s[r]=i,l+=a}let d=0;for(let s=0;s<i;s++)1!==o[s]&&(e[d]=e[s],t[d]=t[s],r[d]=r[s],d++)}(S,R,T,w);let B=w.length,G=0;for(y=0;y<B;y++)G+=w[y]-1;let U=new p(G),W=function(e,t,r,s,a,i,d){let h=e.length,u=new Float64Array(3*h);for(let p=0;p<h;++p){let h=e[p],m=t[p],A=r[p],w=l.lerp(s.west,s.east,h/32767),k=l.lerp(s.south,s.north,m/32767),b=l.lerp(a,i,A/32767),N=n.fromRadians(w,k,b,f),g=d.cartographicToCartesian(N,c);o.pack(g,u,3*p)}return u}(S,R,T,F,g,I,H,x),C=new Float32Array(3*(E=S.length));for(y=0;y<E;++y)C[3*y]=W[3*y]-x.x,C[3*y+1]=W[3*y+1]-x.y,C[3*y+2]=W[3*y+2]-x.z;let D=0,V=0;for(y=0;y<B;y++){let e=w[y]-1,t=.5*A[y],r=k[y],s=D;for(let a=0;a<e;a++){let n=o.unpack(C,D,O),i=o.unpack(C,D+3,P),d=T[V],f=T[V+1];d=l.lerp(g,I,d/32767),f=l.lerp(g,I,f/32767),V++;let c=v,h=j;if(0===a){let t=s+3*e,r=o.unpack(C,t,v);if(o.equals(r,n))o.unpack(C,t-3,c);else{let e=o.subtract(n,i,v);c=o.add(e,n,v)}}else o.unpack(C,D-3,c);if(a===e-1){let e=o.unpack(C,s,j);if(o.equals(e,i))o.unpack(C,s+3,h);else{let e=o.subtract(i,n,j);h=o.add(e,i,j)}}else o.unpack(C,D+6,h);U.addVolume(c,n,i,h,d,f,t,r,x,H),D+=3}D+=3,V++}let L=U.indices;d.push(U.startEllipsoidNormals.buffer),d.push(U.endEllipsoidNormals.buffer),d.push(U.startPositionAndHeights.buffer),d.push(U.startFaceNormalAndVertexCornerIds.buffer),d.push(U.endPositionAndHeights.buffer),d.push(U.endFaceNormalAndHalfWidths.buffer),d.push(U.vertexBatchIds.buffer),d.push(L.buffer);let Q={indexDatatype:2===L.BYTES_PER_ELEMENT?r.UNSIGNED_SHORT:r.UNSIGNED_INT,startEllipsoidNormals:U.startEllipsoidNormals.buffer,endEllipsoidNormals:U.endEllipsoidNormals.buffer,startPositionAndHeights:U.startPositionAndHeights.buffer,startFaceNormalAndVertexCornerIds:U.startFaceNormalAndVertexCornerIds.buffer,endPositionAndHeights:U.endPositionAndHeights.buffer,endFaceNormalAndHalfWidths:U.endFaceNormalAndHalfWidths.buffer,vertexBatchIds:U.vertexBatchIds.buffer,indices:L.buffer};if(e.keepDecodedPositions){let e=function(e){let t=e.length,r=new Uint32Array(t+1),s=0;for(let a=0;a<t;++a)r[a]=s,s+=e[a];return r[t]=s,r}(w);d.push(W.buffer,e.buffer),Q=s(Q,{decodedPositions:W.buffer,decodedPositionOffsets:e.buffer})}return Q});export{S as default};