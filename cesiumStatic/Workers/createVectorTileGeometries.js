import{a as e}from"./chunk-U27UHDI4.js";import{a as t}from"./chunk-7BUFXQJD.js";import"./chunk-CNXDJ4X4.js";import{a as n}from"./chunk-GGEG3PLU.js";import{a as r}from"./chunk-ILB4KG4E.js";import{a as o}from"./chunk-LU2BFLKF.js";import"./chunk-MABAS5D2.js";import"./chunk-PXD6ATBI.js";import{a as i}from"./chunk-GSMLTRAL.js";import"./chunk-IUX576XK.js";import"./chunk-UIGT6VOJ.js";import{c as s}from"./chunk-XO2FNJZK.js";import"./chunk-CM5O7VPK.js";import"./chunk-IB27QQGF.js";import{b as a}from"./chunk-RGFEE67W.js";import"./chunk-KXT7EZPS.js";import"./chunk-ZIOQOCPQ.js";import"./chunk-SY2GINYP.js";import"./chunk-KCR7AORG.js";import{a as c}from"./chunk-QDJTHWTA.js";import"./chunk-2YWR3G22.js";import"./chunk-HTSQLHXI.js";import{e as l}from"./chunk-JDAHMWM5.js";var u=function(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds},d=new c,f=a.packedLength+c.packedLength,h=a.packedLength+2,p=a.packedLength+c.packedLength,m=c.packedLength+1,b={modelMatrix:new a,boundingVolume:new s};function k(e,t){let n=t*f,r=c.unpack(e,n,d);n+=c.packedLength;let o=a.unpack(e,n,b.modelMatrix);a.multiplyByScale(o,r,o);let i=b.boundingVolume;return c.clone(c.ZERO,i.center),i.radius=Math.sqrt(3),b}function g(e,t){let n=t*h,r=e[n++],o=e[n++],i=c.fromElements(r,r,o,d),s=a.unpack(e,n,b.modelMatrix);a.multiplyByScale(s,i,s);let l=b.boundingVolume;return c.clone(c.ZERO,l.center),l.radius=Math.sqrt(2),b}function I(e,t){let n=t*p,r=c.unpack(e,n,d);n+=c.packedLength;let o=a.unpack(e,n,b.modelMatrix);a.multiplyByScale(o,r,o);let i=b.boundingVolume;return c.clone(c.ZERO,i.center),i.radius=1,b}function y(e,t){let n=t*m,r=e[n++],o=c.unpack(e,n,d),i=a.fromTranslation(o,b.modelMatrix);a.multiplyByUniformScale(i,r,i);let s=b.boundingVolume;return c.clone(c.ZERO,s.center),s.radius=1,b}var x=new c;function A(t,n,r,o,i){if(!l(n))return;let d=r.length,f=o.attributes.position.values,h=o.indices,p=t.positions,m=t.vertexBatchIds,b=t.indices,k=t.batchIds,g=t.batchTableColors,I=t.batchedIndices,y=t.indexOffsets,A=t.indexCounts,B=t.boundingVolumes,j=t.modelMatrix,w=t.center,O=t.positionOffset,L=t.batchIdIndex,U=t.indexOffset,v=t.batchedIndicesOffset;for(let t=0;t<d;++t){let o=i(n,t),l=o.modelMatrix;a.multiply(j,l,l);let d=r[t],E=f.length;for(let e=0;e<E;e+=3){let t=c.unpack(f,e,x);a.multiplyByPoint(l,t,t),c.subtract(t,w,t),c.pack(t,p,3*O+e),m[L++]=d}let M=h.length;for(let e=0;e<M;++e)b[U+e]=h[e]+O;let T=t+v;I[T]=new u({offset:U,count:M,color:e.fromRgba(g[d]),batchIds:[d]}),k[T]=d,y[T]=U,A[T]=M,B[T]=s.transform(o.boundingVolume,l),O+=E/3,U+=M}t.positionOffset=O,t.batchIdIndex=L,t.indexOffset=U,t.batchedIndicesOffset+=d}var B=new c,j=new a,w=r(function(r,u){let d,f,h=l(r.boxes)?new Float32Array(r.boxes):void 0,p=l(r.boxBatchIds)?new Uint16Array(r.boxBatchIds):void 0,m=l(r.cylinders)?new Float32Array(r.cylinders):void 0,b=l(r.cylinderBatchIds)?new Uint16Array(r.cylinderBatchIds):void 0,x=l(r.ellipsoids)?new Float32Array(r.ellipsoids):void 0,w=l(r.ellipsoidBatchIds)?new Uint16Array(r.ellipsoidBatchIds):void 0,O=l(r.spheres)?new Float32Array(r.spheres):void 0,L=l(r.sphereBatchIds)?new Uint16Array(r.sphereBatchIds):void 0,U=l(h)?p.length:0,v=l(m)?b.length:0,E=l(x)?w.length:0,M=l(O)?L.length:0,T=o.getUnitBox(),F=t.getUnitCylinder(),C=n.getUnitEllipsoid(),G=T.attributes.position.values,R=F.attributes.position.values,S=C.attributes.position.values,V=G.length*U;V+=R.length*v+S.length*(E+M);let X=T.indices,P=F.indices,D=C.indices,K=X.length*U;K+=P.length*v+D.length*(E+M);let Q=new Float32Array(V),Z=new Uint16Array(V/3),J=i.createTypedArray(V/3,K),H=U+v+E+M,N=new Uint16Array(H),W=Array(H),Y=new Uint32Array(H),q=new Uint32Array(H),_=Array(H);d=new Float64Array(r.packedBuffer),f=0,c.unpack(d,f,B),f+=c.packedLength,a.unpack(d,f,j);let z={batchTableColors:new Uint32Array(r.batchTableColors),positions:Q,vertexBatchIds:Z,indices:J,batchIds:N,batchedIndices:W,indexOffsets:Y,indexCounts:q,boundingVolumes:_,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:j,center:B};A(z,h,p,T,k),A(z,m,b,F,g),A(z,x,w,C,I),A(z,O,L,C,y);let $=function(t,n,r){let o=r.length,i=new Float64Array(2+o*s.packedLength+1+function(t){let n=t.length,r=0;for(let o=0;o<n;++o)r+=e.packedLength+3+t[o].batchIds.length;return r}(n)),a=0;i[a++]=t,i[a++]=o;for(let e=0;e<o;++e)s.pack(r[e],i,a),a+=s.packedLength;let c=n.length;i[a++]=c;for(let t=0;t<c;++t){let r=n[t];e.pack(r.color,i,a),a+=e.packedLength,i[a++]=r.offset,i[a++]=r.count;let o=r.batchIds,s=o.length;i[a++]=s;for(let e=0;e<s;++e)i[a++]=o[e]}return i}(J.BYTES_PER_ELEMENT,W,_);return u.push(Q.buffer,Z.buffer,J.buffer),u.push(N.buffer,Y.buffer,q.buffer),u.push($.buffer),{positions:Q.buffer,vertexBatchIds:Z.buffer,indices:J.buffer,indexOffsets:Y.buffer,indexCounts:q.buffer,batchIds:N.buffer,packedBuffer:$.buffer}});export{w as default};