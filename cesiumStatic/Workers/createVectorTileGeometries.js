import{a as e}from"./chunk-MHP75ZQC.js";import{a as t}from"./chunk-PFHBYMB6.js";import"./chunk-ONEFQVVP.js";import{a as n}from"./chunk-WAIPHB3N.js";import{a as r}from"./chunk-ITDFUUP5.js";import{a as o}from"./chunk-EPLYHGYW.js";import"./chunk-IBQZCWHF.js";import"./chunk-ZXZD7KWX.js";import{a as i}from"./chunk-KSX6TRAS.js";import"./chunk-GMTHOMGW.js";import"./chunk-BELR52CD.js";import{c as s}from"./chunk-BNHFHP3L.js";import"./chunk-4UHVCH4T.js";import"./chunk-4NDD6KRQ.js";import{b as a}from"./chunk-5ELDAYCN.js";import"./chunk-N6BI774S.js";import"./chunk-TI35VBH7.js";import"./chunk-6WLI3422.js";import"./chunk-ICY67TC6.js";import{a as c}from"./chunk-G2EMNOST.js";import"./chunk-4VFKVGYI.js";import"./chunk-3WJNS2B6.js";import{e as l}from"./chunk-XCN226AA.js";var u=function(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds},d=new c,f=a.packedLength+c.packedLength,h=a.packedLength+2,p=a.packedLength+c.packedLength,m=c.packedLength+1,b={modelMatrix:new a,boundingVolume:new s};function k(e,t){let n=t*f,r=c.unpack(e,n,d);n+=c.packedLength;let o=a.unpack(e,n,b.modelMatrix);a.multiplyByScale(o,r,o);let i=b.boundingVolume;return c.clone(c.ZERO,i.center),i.radius=Math.sqrt(3),b}function g(e,t){let n=t*h,r=e[n++],o=e[n++],i=c.fromElements(r,r,o,d),s=a.unpack(e,n,b.modelMatrix);a.multiplyByScale(s,i,s);let l=b.boundingVolume;return c.clone(c.ZERO,l.center),l.radius=Math.sqrt(2),b}function I(e,t){let n=t*p,r=c.unpack(e,n,d);n+=c.packedLength;let o=a.unpack(e,n,b.modelMatrix);a.multiplyByScale(o,r,o);let i=b.boundingVolume;return c.clone(c.ZERO,i.center),i.radius=1,b}function y(e,t){let n=t*m,r=e[n++],o=c.unpack(e,n,d),i=a.fromTranslation(o,b.modelMatrix);a.multiplyByUniformScale(i,r,i);let s=b.boundingVolume;return c.clone(c.ZERO,s.center),s.radius=1,b}var x=new c;function B(t,n,r,o,i){if(!l(n))return;let d=r.length,f=o.attributes.position.values,h=o.indices,p=t.positions,m=t.vertexBatchIds,b=t.indices,k=t.batchIds,g=t.batchTableColors,I=t.batchedIndices,y=t.indexOffsets,B=t.indexCounts,A=t.boundingVolumes,j=t.modelMatrix,w=t.center,O=t.positionOffset,L=t.batchIdIndex,v=t.indexOffset,E=t.batchedIndicesOffset;for(let t=0;t<d;++t){let o=i(n,t),l=o.modelMatrix;a.multiply(j,l,l);let d=r[t],M=f.length;for(let e=0;e<M;e+=3){let t=c.unpack(f,e,x);a.multiplyByPoint(l,t,t),c.subtract(t,w,t),c.pack(t,p,3*O+e),m[L++]=d}let U=h.length;for(let e=0;e<U;++e)b[v+e]=h[e]+O;let C=t+E;I[C]=new u({offset:v,count:U,color:e.fromRgba(g[d]),batchIds:[d]}),k[C]=d,y[C]=v,B[C]=U,A[C]=s.transform(o.boundingVolume,l),O+=M/3,v+=U}t.positionOffset=O,t.batchIdIndex=L,t.indexOffset=v,t.batchedIndicesOffset+=d}var A=new c,j=new a,w=r(function(r,u){let d,f,h=l(r.boxes)?new Float32Array(r.boxes):void 0,p=l(r.boxBatchIds)?new Uint16Array(r.boxBatchIds):void 0,m=l(r.cylinders)?new Float32Array(r.cylinders):void 0,b=l(r.cylinderBatchIds)?new Uint16Array(r.cylinderBatchIds):void 0,x=l(r.ellipsoids)?new Float32Array(r.ellipsoids):void 0,w=l(r.ellipsoidBatchIds)?new Uint16Array(r.ellipsoidBatchIds):void 0,O=l(r.spheres)?new Float32Array(r.spheres):void 0,L=l(r.sphereBatchIds)?new Uint16Array(r.sphereBatchIds):void 0,v=l(h)?p.length:0,E=l(m)?b.length:0,M=l(x)?w.length:0,U=l(O)?L.length:0,C=o.getUnitBox(),T=t.getUnitCylinder(),V=n.getUnitEllipsoid(),F=C.attributes.position.values,H=T.attributes.position.values,N=V.attributes.position.values,S=F.length*v;S+=H.length*E+N.length*(M+U);let P=C.indices,R=T.indices,Z=V.indices,W=P.length*v;W+=R.length*E+Z.length*(M+U);let Y=new Float32Array(S),D=new Uint16Array(S/3),G=i.createTypedArray(S/3,W),K=v+E+M+U,Q=new Uint16Array(K),X=Array(K),q=new Uint32Array(K),_=new Uint32Array(K),J=Array(K);d=new Float64Array(r.packedBuffer),f=0,c.unpack(d,f,A),f+=c.packedLength,a.unpack(d,f,j);let z={batchTableColors:new Uint32Array(r.batchTableColors),positions:Y,vertexBatchIds:D,indices:G,batchIds:Q,batchedIndices:X,indexOffsets:q,indexCounts:_,boundingVolumes:J,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:j,center:A};B(z,h,p,C,k),B(z,m,b,T,g),B(z,x,w,V,I),B(z,O,L,V,y);let $=function(t,n,r){let o=r.length,i=new Float64Array(2+o*s.packedLength+1+function(t){let n=t.length,r=0;for(let o=0;o<n;++o)r+=e.packedLength+3+t[o].batchIds.length;return r}(n)),a=0;i[a++]=t,i[a++]=o;for(let e=0;e<o;++e)s.pack(r[e],i,a),a+=s.packedLength;let c=n.length;i[a++]=c;for(let t=0;t<c;++t){let r=n[t];e.pack(r.color,i,a),a+=e.packedLength,i[a++]=r.offset,i[a++]=r.count;let o=r.batchIds,s=o.length;i[a++]=s;for(let e=0;e<s;++e)i[a++]=o[e]}return i}(G.BYTES_PER_ELEMENT,X,J);return u.push(Y.buffer,D.buffer,G.buffer),u.push(Q.buffer,q.buffer,_.buffer),u.push($.buffer),{positions:Y.buffer,vertexBatchIds:D.buffer,indices:G.buffer,indexOffsets:q.buffer,indexCounts:_.buffer,batchIds:Q.buffer,packedBuffer:$.buffer}});export{w as default};