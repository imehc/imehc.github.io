import{a as e}from"./chunk-U27UHDI4.js";import{a as t}from"./chunk-ILB4KG4E.js";import{a as n}from"./chunk-RNCQLKJ3.js";import{a as r}from"./chunk-NPKIHRIX.js";import"./chunk-33M5C4LG.js";import"./chunk-X2JOWFTB.js";import"./chunk-KIJM7B3H.js";import"./chunk-P44F6KLE.js";import{a as a}from"./chunk-GSMLTRAL.js";import"./chunk-XO2FNJZK.js";import"./chunk-CM5O7VPK.js";import{j as o}from"./chunk-IB27QQGF.js";import"./chunk-RGFEE67W.js";import"./chunk-KXT7EZPS.js";import"./chunk-ZIOQOCPQ.js";import"./chunk-SY2GINYP.js";import{a as i,c as s}from"./chunk-KCR7AORG.js";import{a as f}from"./chunk-QDJTHWTA.js";import{a as c}from"./chunk-2YWR3G22.js";import"./chunk-HTSQLHXI.js";import{e as h}from"./chunk-JDAHMWM5.js";var l=new f,u=new s,p=new o,m={min:void 0,max:void 0,indexBytesPerElement:void 0},d=new f,g=new f,k=new f,y=new f,w=new f,b=new i,A=new o,x=t(function(t,x){let L,j,I;j=new Float64Array(t.packedBuffer),I=0,m.indexBytesPerElement=j[I++],m.min=j[I++],m.max=j[I++],f.unpack(j,I,l),I+=f.packedLength,s.unpack(j,I,u),I+=s.packedLength,o.unpack(j,I,p),L=2===m.indexBytesPerElement?new Uint16Array(t.indices):new Uint32Array(t.indices);let E=new Uint16Array(t.positions),O=new Uint32Array(t.counts),T=new Uint32Array(t.indexCounts),U=new Uint32Array(t.batchIds),B=new Uint32Array(t.batchTableColors),P=Array(O.length),R=p,S=m.min,F=m.max,G=t.minimumHeights,M=t.maximumHeights;h(G)&&h(M)&&(G=new Float32Array(G),M=new Float32Array(M));let N,C,H,K=E.length/2,D=E.subarray(0,K),J=E.subarray(K,2*K);r.zigZagDeltaDecode(D,J);let Q=new Float64Array(3*K);for(N=0;N<K;++N){let e=D[N],t=J[N],n=c.lerp(R.west,R.east,e/32767),r=c.lerp(R.south,R.north,t/32767),a=i.fromRadians(n,r,0,b),o=u.cartographicToCartesian(a,d);f.pack(o,Q,3*N)}let W=O.length,X=Array(W),v=Array(W),Y=0,Z=0;for(N=0;N<W;++N)X[N]=Y,v[N]=Z,Y+=O[N],Z+=T[N];let _=new Float32Array(3*K*2),z=new Uint16Array(2*K),V=new Uint32Array(v.length),q=new Uint32Array(T.length),$=[],ee={};for(N=0;N<W;++N)h(ee[H=B[N]])?(ee[H].positionLength+=O[N],ee[H].indexLength+=T[N],ee[H].batchIds.push(N)):ee[H]={positionLength:O[N],indexLength:T[N],offset:0,indexOffset:0,batchIds:[N]};let et,en=0,er=0;for(H in ee)if(ee.hasOwnProperty(H)){(et=ee[H]).offset=en,et.indexOffset=er;let e=2*et.positionLength,t=2*et.indexLength+6*et.positionLength;en+=e,er+=t,et.indexLength=t}let ea=[];for(H in ee)ee.hasOwnProperty(H)&&(et=ee[H],ea.push({color:e.fromRgba(parseInt(H)),offset:et.indexOffset,count:et.indexLength,batchIds:et.batchIds}));for(N=0;N<W;++N){let e=(et=ee[H=B[N]]).offset,t=3*e,r=e,a=X[N],o=O[N],i=U[N],s=S,c=F;h(G)&&h(M)&&(s=G[N],c=M[N]);let p=1/0,m=-1/0,x=1/0,j=-1/0;for(C=0;C<o;++C){let e=f.unpack(Q,3*a+3*C,d);u.scaleToGeodeticSurface(e,e);let n=u.cartesianToCartographic(e,b),o=n.latitude,h=n.longitude;p=Math.min(o,p),m=Math.max(o,m),x=Math.min(h,x),j=Math.max(h,j);let A=u.geodeticSurfaceNormal(e,g),L=f.multiplyByScalar(A,s,k),I=f.add(e,L,y);L=f.multiplyByScalar(A,c,L);let E=f.add(e,L,w);f.subtract(E,l,E),f.subtract(I,l,I),f.pack(E,_,t),f.pack(I,_,t+3),z[r]=i,z[r+1]=i,t+=6,r+=2}(R=A).west=x,R.east=j,R.south=p,R.north=m,P[N]=n.fromRectangle(R,S,F,u);let I=et.indexOffset,E=v[N],K=T[N];for(V[N]=I,C=0;C<K;C+=3){let t=L[E+C]-a,n=L[E+C+1]-a,r=L[E+C+2]-a;$[I++]=2*t+e,$[I++]=2*n+e,$[I++]=2*r+e,$[I++]=2*r+1+e,$[I++]=2*n+1+e,$[I++]=2*t+1+e}for(C=0;C<o;++C){let t=C,n=(C+1)%o;$[I++]=2*t+1+e,$[I++]=2*n+e,$[I++]=2*t+e,$[I++]=2*t+1+e,$[I++]=2*n+1+e,$[I++]=2*n+e}et.offset+=2*o,et.indexOffset=I,q[N]=I-V[N]}$=a.createTypedArray(_.length/3,$);let eo=ea.length;for(let e=0;e<eo;++e){let t=ea[e].batchIds,n=0,r=t.length;for(let e=0;e<r;++e)n+=q[t[e]];ea[e].count=n}let ei=function(t,r,a){let o=r.length,i=new Float64Array(2+o*n.packedLength+1+function(t){let n=t.length,r=0;for(let a=0;a<n;++a)r+=e.packedLength+3+t[a].batchIds.length;return r}(a)),s=0;i[s++]=t,i[s++]=o;for(let e=0;e<o;++e)n.pack(r[e],i,s),s+=n.packedLength;let f=a.length;i[s++]=f;for(let t=0;t<f;++t){let n=a[t];e.pack(n.color,i,s),s+=e.packedLength,i[s++]=n.offset,i[s++]=n.count;let r=n.batchIds,o=r.length;i[s++]=o;for(let e=0;e<o;++e)i[s++]=r[e]}return i}(2===$.BYTES_PER_ELEMENT?a.UNSIGNED_SHORT:a.UNSIGNED_INT,P,ea);return x.push(_.buffer,$.buffer,V.buffer,q.buffer,z.buffer,ei.buffer),{positions:_.buffer,indices:$.buffer,indexOffsets:V.buffer,indexCounts:q.buffer,batchIds:z.buffer,packedBuffer:ei.buffer}});export{x as default};