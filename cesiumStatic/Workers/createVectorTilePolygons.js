import{a as e}from"./chunk-MHP75ZQC.js";import{a as t}from"./chunk-ITDFUUP5.js";import{a as n}from"./chunk-AZKYNZOH.js";import{a as r}from"./chunk-DAX2P4DI.js";import"./chunk-SI3KZUTO.js";import"./chunk-QM7HI6IF.js";import"./chunk-SPC72PTY.js";import"./chunk-HVWI7BO6.js";import{a as a}from"./chunk-KSX6TRAS.js";import"./chunk-BNHFHP3L.js";import"./chunk-4UHVCH4T.js";import{j as o}from"./chunk-4NDD6KRQ.js";import"./chunk-5ELDAYCN.js";import"./chunk-N6BI774S.js";import"./chunk-TI35VBH7.js";import"./chunk-6WLI3422.js";import{a as i,c as s}from"./chunk-ICY67TC6.js";import{a as f}from"./chunk-G2EMNOST.js";import{a as c}from"./chunk-4VFKVGYI.js";import"./chunk-3WJNS2B6.js";import{e as h}from"./chunk-XCN226AA.js";var l=new f,u=new s,p=new o,m={min:void 0,max:void 0,indexBytesPerElement:void 0},d=new f,g=new f,k=new f,y=new f,w=new f,b=new i,A=new o,I=t(function(t,I){let x,j,L;j=new Float64Array(t.packedBuffer),L=0,m.indexBytesPerElement=j[L++],m.min=j[L++],m.max=j[L++],f.unpack(j,L,l),L+=f.packedLength,s.unpack(j,L,u),L+=s.packedLength,o.unpack(j,L,p),x=2===m.indexBytesPerElement?new Uint16Array(t.indices):new Uint32Array(t.indices);let T=new Uint16Array(t.positions),U=new Uint32Array(t.counts),N=new Uint32Array(t.indexCounts),S=new Uint32Array(t.batchIds),B=new Uint32Array(t.batchTableColors),O=Array(U.length),C=p,E=m.min,H=m.max,P=t.minimumHeights,D=t.maximumHeights;h(P)&&h(D)&&(P=new Float32Array(P),D=new Float32Array(D));let F,M,R,Y=T.length/2,G=T.subarray(0,Y),K=T.subarray(Y,2*Y);r.zigZagDeltaDecode(G,K);let V=new Float64Array(3*Y);for(F=0;F<Y;++F){let e=G[F],t=K[F],n=c.lerp(C.west,C.east,e/32767),r=c.lerp(C.south,C.north,t/32767),a=i.fromRadians(n,r,0,b),o=u.cartographicToCartesian(a,d);f.pack(o,V,3*F)}let Z=U.length,v=Array(Z),_=Array(Z),Q=0,W=0;for(F=0;F<Z;++F)v[F]=Q,_[F]=W,Q+=U[F],W+=N[F];let X=new Float32Array(3*Y*2),J=new Uint16Array(2*Y),z=new Uint32Array(_.length),q=new Uint32Array(N.length),$=[],ee={};for(F=0;F<Z;++F)h(ee[R=B[F]])?(ee[R].positionLength+=U[F],ee[R].indexLength+=N[F],ee[R].batchIds.push(F)):ee[R]={positionLength:U[F],indexLength:N[F],offset:0,indexOffset:0,batchIds:[F]};let et,en=0,er=0;for(R in ee)if(ee.hasOwnProperty(R)){(et=ee[R]).offset=en,et.indexOffset=er;let e=2*et.positionLength,t=2*et.indexLength+6*et.positionLength;en+=e,er+=t,et.indexLength=t}let ea=[];for(R in ee)ee.hasOwnProperty(R)&&(et=ee[R],ea.push({color:e.fromRgba(parseInt(R)),offset:et.indexOffset,count:et.indexLength,batchIds:et.batchIds}));for(F=0;F<Z;++F){let e=(et=ee[R=B[F]]).offset,t=3*e,r=e,a=v[F],o=U[F],i=S[F],s=E,c=H;h(P)&&h(D)&&(s=P[F],c=D[F]);let p=1/0,m=-1/0,I=1/0,j=-1/0;for(M=0;M<o;++M){let e=f.unpack(V,3*a+3*M,d);u.scaleToGeodeticSurface(e,e);let n=u.cartesianToCartographic(e,b),o=n.latitude,h=n.longitude;p=Math.min(o,p),m=Math.max(o,m),I=Math.min(h,I),j=Math.max(h,j);let A=u.geodeticSurfaceNormal(e,g),x=f.multiplyByScalar(A,s,k),L=f.add(e,x,y);x=f.multiplyByScalar(A,c,x);let T=f.add(e,x,w);f.subtract(T,l,T),f.subtract(L,l,L),f.pack(T,X,t),f.pack(L,X,t+3),J[r]=i,J[r+1]=i,t+=6,r+=2}(C=A).west=I,C.east=j,C.south=p,C.north=m,O[F]=n.fromRectangle(C,E,H,u);let L=et.indexOffset,T=_[F],Y=N[F];for(z[F]=L,M=0;M<Y;M+=3){let t=x[T+M]-a,n=x[T+M+1]-a,r=x[T+M+2]-a;$[L++]=2*t+e,$[L++]=2*n+e,$[L++]=2*r+e,$[L++]=2*r+1+e,$[L++]=2*n+1+e,$[L++]=2*t+1+e}for(M=0;M<o;++M){let t=M,n=(M+1)%o;$[L++]=2*t+1+e,$[L++]=2*n+e,$[L++]=2*t+e,$[L++]=2*t+1+e,$[L++]=2*n+1+e,$[L++]=2*n+e}et.offset+=2*o,et.indexOffset=L,q[F]=L-z[F]}$=a.createTypedArray(X.length/3,$);let eo=ea.length;for(let e=0;e<eo;++e){let t=ea[e].batchIds,n=0,r=t.length;for(let e=0;e<r;++e)n+=q[t[e]];ea[e].count=n}let ei=function(t,r,a){let o=r.length,i=new Float64Array(2+o*n.packedLength+1+function(t){let n=t.length,r=0;for(let a=0;a<n;++a)r+=e.packedLength+3+t[a].batchIds.length;return r}(a)),s=0;i[s++]=t,i[s++]=o;for(let e=0;e<o;++e)n.pack(r[e],i,s),s+=n.packedLength;let f=a.length;i[s++]=f;for(let t=0;t<f;++t){let n=a[t];e.pack(n.color,i,s),s+=e.packedLength,i[s++]=n.offset,i[s++]=n.count;let r=n.batchIds,o=r.length;i[s++]=o;for(let e=0;e<o;++e)i[s++]=r[e]}return i}(2===$.BYTES_PER_ELEMENT?a.UNSIGNED_SHORT:a.UNSIGNED_INT,O,ea);return I.push(X.buffer,$.buffer,z.buffer,q.buffer,J.buffer,ei.buffer),{positions:X.buffer,indices:$.buffer,indexOffsets:z.buffer,indexCounts:q.buffer,batchIds:J.buffer,packedBuffer:ei.buffer}});export{I as default};