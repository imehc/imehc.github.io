import{a as t,c as e}from"./chunk-OUPSOZ4F.js";import{a as i}from"./chunk-ILB4KG4E.js";import{a as n}from"./chunk-VJHOZLST.js";import{a as o}from"./chunk-RNCQLKJ3.js";import"./chunk-NPKIHRIX.js";import"./chunk-33M5C4LG.js";import{a as r}from"./chunk-X2JOWFTB.js";import"./chunk-KIJM7B3H.js";import"./chunk-P44F6KLE.js";import{c as a}from"./chunk-XO2FNJZK.js";import"./chunk-CM5O7VPK.js";import{i as s,j as l}from"./chunk-IB27QQGF.js";import{b as u}from"./chunk-RGFEE67W.js";import"./chunk-KXT7EZPS.js";import"./chunk-ZIOQOCPQ.js";import{a as h}from"./chunk-SY2GINYP.js";import{a as c,b as d,c as m}from"./chunk-KCR7AORG.js";import{a as g}from"./chunk-QDJTHWTA.js";import{a as p}from"./chunk-2YWR3G22.js";import"./chunk-HTSQLHXI.js";import{e as f}from"./chunk-JDAHMWM5.js";var E=Uint16Array.BYTES_PER_ELEMENT,T=Int32Array.BYTES_PER_ELEMENT,x=Uint32Array.BYTES_PER_ELEMENT,S=Float32Array.BYTES_PER_ELEMENT,I=Float64Array.BYTES_PER_ELEMENT;function k(t,e,i){i=i??p;let n=t.length;for(let o=0;o<n;++o)if(i.equalsEpsilon(t[o],e,p.EPSILON12))return o;return -1}var R=new c,M=new g,P=new g,y=new g,B=new u;function w(t,e,i,n,o,r,a,s,l,h,m){let E=s.length;for(let T=0;T<E;++T){let x=s[T],S=x.cartographic,I=x.index,k=t.length,P=S.longitude,y=S.latitude;y=p.clamp(y,-p.PI_OVER_TWO,p.PI_OVER_TWO);let B=S.height-a.skirtHeight;a.hMin=Math.min(a.hMin,B),c.fromRadians(P,y,B,R),h&&(R.longitude+=l),h?T===E-1?R.latitude+=m:0===T&&(R.latitude-=m):R.latitude+=l;let w=a.ellipsoid.cartographicToCartesian(R);t.push(w),e.push(B),i.push(d.clone(i[I])),n.length>0&&n.push(n[I]),o.length>0&&o.push(o[I]),u.multiplyByPoint(a.toENU,w,M);let v=a.minimum,j=a.maximum;g.minimumByComponent(M,v,v),g.maximumByComponent(M,j,j);let A=a.lastBorderPoint;if(f(A)){let t=A.index;r.push(t,k-1,k,k,I,t)}a.lastBorderPoint=x}}var v=i(function(i,v){i.ellipsoid=m.clone(i.ellipsoid),i.rectangle=l.clone(i.rectangle);let j=function(i,l,m,v,j,A,N,W,C,b,F){let H,L,O,_,U,K;f(v)?(H=v.west,L=v.south,O=v.east,_=v.north,U=v.width,K=v.height):(H=p.toRadians(j.west),L=p.toRadians(j.south),O=p.toRadians(j.east),_=p.toRadians(j.north),U=p.toRadians(v.width),K=p.toRadians(v.height));let Y=[L,_],G=[H,O],J=s.eastNorthUpToFixedFrame(l,m),Q=u.inverseTransformation(J,B),D,V;C&&(D=n.geodeticLatitudeToMercatorAngle(L),V=1/(n.geodeticLatitudeToMercatorAngle(_)-D));let X=1!==A,Z=new DataView(i),z=1/0,q=-1/0;P.x=1/0,P.y=1/0,P.z=1/0,y.x=-1/0,y.y=-1/0,y.z=-1/0;let $=0,tt=0,te=0,ti,tn;for(tn=0;tn<4;++tn){let t=$;ti=Z.getUint32(t,!0),t+=x;let e=p.toRadians(180*Z.getFloat64(t,!0));t+=I,-1===k(G,e)&&G.push(e);let i=p.toRadians(180*Z.getFloat64(t,!0));t+=I,-1===k(Y,i)&&Y.push(i),t+=2*I;let n=Z.getInt32(t,!0);t+=T,tt+=n,te+=3*(n=Z.getInt32(t,!0)),$+=ti+x}let to=[],tr=[],ta=Array(tt),ts=Array(tt),tl=Array(tt),tu=C?Array(tt):[],th=X?Array(tt):[],tc=Array(te),td=[],tm=[],tg=[],tp=[],tf=0,tE=0;for($=0,tn=0;tn<4;++tn){ti=Z.getUint32($,!0);let t=$+=x,e=p.toRadians(180*Z.getFloat64($,!0));$+=I;let i=p.toRadians(180*Z.getFloat64($,!0));$+=I;let o=p.toRadians(180*Z.getFloat64($,!0)),r=.5*o;$+=I;let a=p.toRadians(180*Z.getFloat64($,!0)),s=.5*a;$+=I;let l=Z.getInt32($,!0);$+=T;let f=Z.getInt32($,!0);$+=T,$+=T;let B=Array(l);for(let t=0;t<l;++t){let l=e+Z.getUint8($++)*o;R.longitude=l;let h=i+Z.getUint8($++)*a;R.latitude=h;let f=Z.getFloat32($,!0);if($+=S,0!==f&&f<F&&(f*=-Math.pow(2,b)),R.height=f*=6371010,-1!==k(G,l)||-1!==k(Y,h)){let e=k(to,R,c);if(-1===e)to.push(c.clone(R)),tr.push(tf);else{B[t]=tr[e];continue}}B[t]=tf,Math.abs(l-H)<r?td.push({index:tf,cartographic:c.clone(R)}):Math.abs(l-O)<r?tg.push({index:tf,cartographic:c.clone(R)}):Math.abs(h-L)<s?tm.push({index:tf,cartographic:c.clone(R)}):Math.abs(h-_)<s&&tp.push({index:tf,cartographic:c.clone(R)}),z=Math.min(f,z),q=Math.max(f,q),tl[tf]=f;let E=m.cartographicToCartesian(R);if(ta[tf]=E,C&&(tu[tf]=(n.geodeticLatitudeToMercatorAngle(h)-D)*V),X){let t=m.geodeticSurfaceNormal(E);th[tf]=t}u.multiplyByPoint(Q,E,M),g.minimumByComponent(M,P,P),g.maximumByComponent(M,y,y);let T=(l-H)/(O-H);T=p.clamp(T,0,1);let x=(h-L)/(_-L);x=p.clamp(x,0,1),ts[tf]=new d(T,x),++tf}let w=3*f;for(let t=0;t<w;++t,++tE)tc[tE]=B[Z.getUint16($,!0)],$+=E;if(ti!==$-t)throw new h("Invalid terrain tile.")}ta.length=tf,ts.length=tf,tl.length=tf,C&&(tu.length=tf),X&&(th.length=tf);let tT=tf,tx=tE,tS={hMin:z,lastBorderPoint:void 0,skirtHeight:W,toENU:Q,ellipsoid:m,minimum:P,maximum:y};if(td.sort(function(t,e){return e.cartographic.latitude-t.cartographic.latitude}),tm.sort(function(t,e){return t.cartographic.longitude-e.cartographic.longitude}),tg.sort(function(t,e){return t.cartographic.latitude-e.cartographic.latitude}),tp.sort(function(t,e){return e.cartographic.longitude-t.cartographic.longitude}),w(ta,tl,ts,tu,th,tc,tS,td,-1e-5*U,!0,-1e-5*K),w(ta,tl,ts,tu,th,tc,tS,tm,-1e-5*K,!1),w(ta,tl,ts,tu,th,tc,tS,tg,1e-5*U,!0,1e-5*K),w(ta,tl,ts,tu,th,tc,tS,tp,1e-5*K,!1),td.length>0&&tp.length>0){let t=td[0].index,e=tp[tp.length-1].index,i=ta.length-1;tc.push(e,i,tT,tT,t,e)}tt=ta.length;let tI=a.fromPoints(ta),tk;f(v)&&(tk=o.fromRectangle(v,z,q,m));let tR=new t(m).computeHorizonCullingPointPossiblyUnderEllipsoid(l,ta,z),tM=new r(P,y,l),tP=new e(l,tM,tS.hMin,q,J,!1,C,X,A,N),ty=new Float32Array(tt*tP.stride),tB=0;for(let t=0;t<tt;++t)tB=tP.encode(ty,tB,ta[t],ts[t],tl[t],void 0,tu[t],th[t]);let tw=td.map(function(t){return t.index}).reverse(),tv=tm.map(function(t){return t.index}).reverse(),tj=tg.map(function(t){return t.index}).reverse(),tA=tp.map(function(t){return t.index}).reverse();return tv.unshift(tj[tj.length-1]),tv.push(tw[0]),tA.unshift(tw[tw.length-1]),tA.push(tj[0]),{vertices:ty,indices:new Uint16Array(tc),maximumHeight:q,minimumHeight:z,encoding:tP,boundingSphere3D:tI,orientedBoundingBox:tk,occludeePointInScaledSpace:tR,vertexCountWithoutSkirts:tT,indexCountWithoutSkirts:tx,westIndicesSouthToNorth:tw,southIndicesEastToWest:tv,eastIndicesNorthToSouth:tj,northIndicesWestToEast:tA}}(i.buffer,i.relativeToCenter,i.ellipsoid,i.rectangle,i.nativeRectangle,i.exaggeration,i.exaggerationRelativeHeight,i.skirtHeight,i.includeWebMercatorT,i.negativeAltitudeExponentBias,i.negativeElevationThreshold),A=j.vertices;v.push(A.buffer);let N=j.indices;return v.push(N.buffer),{vertices:A.buffer,indices:N.buffer,numberOfAttributes:j.encoding.stride,minimumHeight:j.minimumHeight,maximumHeight:j.maximumHeight,boundingSphere3D:j.boundingSphere3D,orientedBoundingBox:j.orientedBoundingBox,occludeePointInScaledSpace:j.occludeePointInScaledSpace,encoding:j.encoding,vertexCountWithoutSkirts:j.vertexCountWithoutSkirts,indexCountWithoutSkirts:j.indexCountWithoutSkirts,westIndicesSouthToNorth:j.westIndicesSouthToNorth,southIndicesEastToWest:j.southIndicesEastToWest,eastIndicesNorthToSouth:j.eastIndicesNorthToSouth,northIndicesWestToEast:j.northIndicesWestToEast}});export{v as default};