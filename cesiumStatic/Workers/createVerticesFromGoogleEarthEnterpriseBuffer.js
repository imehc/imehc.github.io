import{a as t,c as e}from"./chunk-33IJ66H2.js";import{a as i}from"./chunk-ITDFUUP5.js";import{a as n}from"./chunk-VSMOUEKV.js";import{a as o}from"./chunk-AZKYNZOH.js";import"./chunk-DAX2P4DI.js";import"./chunk-SI3KZUTO.js";import{a as r}from"./chunk-QM7HI6IF.js";import"./chunk-SPC72PTY.js";import"./chunk-HVWI7BO6.js";import{c as a}from"./chunk-BNHFHP3L.js";import"./chunk-4UHVCH4T.js";import{i as s,j as l}from"./chunk-4NDD6KRQ.js";import{b as u}from"./chunk-5ELDAYCN.js";import"./chunk-N6BI774S.js";import"./chunk-TI35VBH7.js";import{a as h}from"./chunk-6WLI3422.js";import{a as c,b as d,c as m}from"./chunk-ICY67TC6.js";import{a as g}from"./chunk-G2EMNOST.js";import{a as p}from"./chunk-4VFKVGYI.js";import"./chunk-3WJNS2B6.js";import{e as f}from"./chunk-XCN226AA.js";var E=Uint16Array.BYTES_PER_ELEMENT,T=Int32Array.BYTES_PER_ELEMENT,x=Uint32Array.BYTES_PER_ELEMENT,I=Float32Array.BYTES_PER_ELEMENT,S=Float64Array.BYTES_PER_ELEMENT;function k(t,e,i){i=i??p;let n=t.length;for(let o=0;o<n;++o)if(i.equalsEpsilon(t[o],e,p.EPSILON12))return o;return -1}var B=new c,y=new g,w=new g,A=new g,M=new u;function N(t,e,i,n,o,r,a,s,l,h,m){let E=s.length;for(let T=0;T<E;++T){let x=s[T],I=x.cartographic,S=x.index,k=t.length,w=I.longitude,A=I.latitude;A=p.clamp(A,-p.PI_OVER_TWO,p.PI_OVER_TWO);let M=I.height-a.skirtHeight;a.hMin=Math.min(a.hMin,M),c.fromRadians(w,A,M,B),h&&(B.longitude+=l),h?T===E-1?B.latitude+=m:0===T&&(B.latitude-=m):B.latitude+=l;let N=a.ellipsoid.cartographicToCartesian(B);t.push(N),e.push(M),i.push(d.clone(i[S])),n.length>0&&n.push(n[S]),o.length>0&&o.push(o[S]),u.multiplyByPoint(a.toENU,N,y);let P=a.minimum,R=a.maximum;g.minimumByComponent(y,P,P),g.maximumByComponent(y,R,R);let v=a.lastBorderPoint;if(f(v)){let t=v.index;r.push(t,k-1,k,k,S,t)}a.lastBorderPoint=x}}var P=i(function(i,P){i.ellipsoid=m.clone(i.ellipsoid),i.rectangle=l.clone(i.rectangle);let R=function(i,l,m,P,R,v,j,C,H,b,W){let U,F,_,L,O,D;f(P)?(U=P.west,F=P.south,_=P.east,L=P.north,O=P.width,D=P.height):(U=p.toRadians(R.west),F=p.toRadians(R.south),_=p.toRadians(R.east),L=p.toRadians(R.north),O=p.toRadians(P.width),D=p.toRadians(P.height));let V=[F,L],Y=[U,_],K=s.eastNorthUpToFixedFrame(l,m),z=u.inverseTransformation(K,M),Z,G;H&&(Z=n.geodeticLatitudeToMercatorAngle(F),G=1/(n.geodeticLatitudeToMercatorAngle(L)-Z));let J=1!==v,Q=new DataView(i),X=1/0,q=-1/0;w.x=1/0,w.y=1/0,w.z=1/0,A.x=-1/0,A.y=-1/0,A.z=-1/0;let $=0,tt=0,te=0,ti,tn;for(tn=0;tn<4;++tn){let t=$;ti=Q.getUint32(t,!0),t+=x;let e=p.toRadians(180*Q.getFloat64(t,!0));t+=S,-1===k(Y,e)&&Y.push(e);let i=p.toRadians(180*Q.getFloat64(t,!0));t+=S,-1===k(V,i)&&V.push(i),t+=2*S;let n=Q.getInt32(t,!0);t+=T,tt+=n,te+=3*(n=Q.getInt32(t,!0)),$+=ti+x}let to=[],tr=[],ta=Array(tt),ts=Array(tt),tl=Array(tt),tu=H?Array(tt):[],th=J?Array(tt):[],tc=Array(te),td=[],tm=[],tg=[],tp=[],tf=0,tE=0;for($=0,tn=0;tn<4;++tn){ti=Q.getUint32($,!0);let t=$+=x,e=p.toRadians(180*Q.getFloat64($,!0));$+=S;let i=p.toRadians(180*Q.getFloat64($,!0));$+=S;let o=p.toRadians(180*Q.getFloat64($,!0)),r=.5*o;$+=S;let a=p.toRadians(180*Q.getFloat64($,!0)),s=.5*a;$+=S;let l=Q.getInt32($,!0);$+=T;let f=Q.getInt32($,!0);$+=T,$+=T;let M=Array(l);for(let t=0;t<l;++t){let l=e+Q.getUint8($++)*o;B.longitude=l;let h=i+Q.getUint8($++)*a;B.latitude=h;let f=Q.getFloat32($,!0);if($+=I,0!==f&&f<W&&(f*=-Math.pow(2,b)),B.height=f*=6371010,-1!==k(Y,l)||-1!==k(V,h)){let e=k(to,B,c);if(-1===e)to.push(c.clone(B)),tr.push(tf);else{M[t]=tr[e];continue}}M[t]=tf,Math.abs(l-U)<r?td.push({index:tf,cartographic:c.clone(B)}):Math.abs(l-_)<r?tg.push({index:tf,cartographic:c.clone(B)}):Math.abs(h-F)<s?tm.push({index:tf,cartographic:c.clone(B)}):Math.abs(h-L)<s&&tp.push({index:tf,cartographic:c.clone(B)}),X=Math.min(f,X),q=Math.max(f,q),tl[tf]=f;let E=m.cartographicToCartesian(B);if(ta[tf]=E,H&&(tu[tf]=(n.geodeticLatitudeToMercatorAngle(h)-Z)*G),J){let t=m.geodeticSurfaceNormal(E);th[tf]=t}u.multiplyByPoint(z,E,y),g.minimumByComponent(y,w,w),g.maximumByComponent(y,A,A);let T=(l-U)/(_-U);T=p.clamp(T,0,1);let x=(h-F)/(L-F);x=p.clamp(x,0,1),ts[tf]=new d(T,x),++tf}let N=3*f;for(let t=0;t<N;++t,++tE)tc[tE]=M[Q.getUint16($,!0)],$+=E;if(ti!==$-t)throw new h("Invalid terrain tile.")}ta.length=tf,ts.length=tf,tl.length=tf,H&&(tu.length=tf),J&&(th.length=tf);let tT=tf,tx=tE,tI={hMin:X,lastBorderPoint:void 0,skirtHeight:C,toENU:z,ellipsoid:m,minimum:w,maximum:A};if(td.sort(function(t,e){return e.cartographic.latitude-t.cartographic.latitude}),tm.sort(function(t,e){return t.cartographic.longitude-e.cartographic.longitude}),tg.sort(function(t,e){return t.cartographic.latitude-e.cartographic.latitude}),tp.sort(function(t,e){return e.cartographic.longitude-t.cartographic.longitude}),N(ta,tl,ts,tu,th,tc,tI,td,-1e-5*O,!0,-1e-5*D),N(ta,tl,ts,tu,th,tc,tI,tm,-1e-5*D,!1),N(ta,tl,ts,tu,th,tc,tI,tg,1e-5*O,!0,1e-5*D),N(ta,tl,ts,tu,th,tc,tI,tp,1e-5*D,!1),td.length>0&&tp.length>0){let t=td[0].index,e=tp[tp.length-1].index,i=ta.length-1;tc.push(e,i,tT,tT,t,e)}tt=ta.length;let tS=a.fromPoints(ta),tk;f(P)&&(tk=o.fromRectangle(P,X,q,m));let tB=new t(m).computeHorizonCullingPointPossiblyUnderEllipsoid(l,ta,X),ty=new r(w,A,l),tw=new e(l,ty,tI.hMin,q,K,!1,H,J,v,j),tA=new Float32Array(tt*tw.stride),tM=0;for(let t=0;t<tt;++t)tM=tw.encode(tA,tM,ta[t],ts[t],tl[t],void 0,tu[t],th[t]);let tN=td.map(function(t){return t.index}).reverse(),tP=tm.map(function(t){return t.index}).reverse(),tR=tg.map(function(t){return t.index}).reverse(),tv=tp.map(function(t){return t.index}).reverse();return tP.unshift(tR[tR.length-1]),tP.push(tN[0]),tv.unshift(tN[tN.length-1]),tv.push(tR[0]),{vertices:tA,indices:new Uint16Array(tc),maximumHeight:q,minimumHeight:X,encoding:tw,boundingSphere3D:tS,orientedBoundingBox:tk,occludeePointInScaledSpace:tB,vertexCountWithoutSkirts:tT,indexCountWithoutSkirts:tx,westIndicesSouthToNorth:tN,southIndicesEastToWest:tP,eastIndicesNorthToSouth:tR,northIndicesWestToEast:tv}}(i.buffer,i.relativeToCenter,i.ellipsoid,i.rectangle,i.nativeRectangle,i.exaggeration,i.exaggerationRelativeHeight,i.skirtHeight,i.includeWebMercatorT,i.negativeAltitudeExponentBias,i.negativeElevationThreshold),v=R.vertices;P.push(v.buffer);let j=R.indices;return P.push(j.buffer),{vertices:v.buffer,indices:j.buffer,numberOfAttributes:R.encoding.stride,minimumHeight:R.minimumHeight,maximumHeight:R.maximumHeight,boundingSphere3D:R.boundingSphere3D,orientedBoundingBox:R.orientedBoundingBox,occludeePointInScaledSpace:R.occludeePointInScaledSpace,encoding:R.encoding,vertexCountWithoutSkirts:R.vertexCountWithoutSkirts,indexCountWithoutSkirts:R.indexCountWithoutSkirts,westIndicesSouthToNorth:R.westIndicesSouthToNorth,southIndicesEastToWest:R.southIndicesEastToWest,eastIndicesNorthToSouth:R.eastIndicesNorthToSouth,northIndicesWestToEast:R.northIndicesWestToEast}});export{P as default};