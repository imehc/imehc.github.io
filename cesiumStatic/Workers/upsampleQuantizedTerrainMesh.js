import{a as e,c as t}from"./chunk-OUPSOZ4F.js";import{a as i}from"./chunk-ILB4KG4E.js";import{a as n}from"./chunk-RNCQLKJ3.js";import{a as s}from"./chunk-NPKIHRIX.js";import"./chunk-33M5C4LG.js";import"./chunk-X2JOWFTB.js";import"./chunk-KIJM7B3H.js";import"./chunk-P44F6KLE.js";import{a as r}from"./chunk-GSMLTRAL.js";import{c as h}from"./chunk-XO2FNJZK.js";import"./chunk-CM5O7VPK.js";import{j as u}from"./chunk-IB27QQGF.js";import"./chunk-RGFEE67W.js";import"./chunk-KXT7EZPS.js";import"./chunk-ZIOQOCPQ.js";import"./chunk-SY2GINYP.js";import{a as o,b as p,c as l}from"./chunk-KCR7AORG.js";import{a as f}from"./chunk-QDJTHWTA.js";import{a as d}from"./chunk-2YWR3G22.js";import{a as a,b as c}from"./chunk-HTSQLHXI.js";import{e as m}from"./chunk-JDAHMWM5.js";var g={};g.clipTriangleAtAxisAlignedThreshold=function(e,t,i,n,s,r){let h,u,o;if(!m(e))throw new a("threshold is required.");if(!m(t))throw new a("keepAbove is required.");if(!m(i))throw new a("u0 is required.");if(!m(n))throw new a("u1 is required.");if(!m(s))throw new a("u2 is required.");m(r)?r.length=0:r=[],t?(h=i<e,u=n<e,o=s<e):(h=i>e,u=n>e,o=s>e);let p=h+u+o,l,f,d,c,g,w;return 1===p?h?(l=(e-i)/(n-i),f=(e-i)/(s-i),r.push(1),r.push(2),1!==f&&(r.push(-1),r.push(0),r.push(2),r.push(f)),1!==l&&(r.push(-1),r.push(0),r.push(1),r.push(l))):u?(d=(e-n)/(s-n),c=(e-n)/(i-n),r.push(2),r.push(0),1!==c&&(r.push(-1),r.push(1),r.push(0),r.push(c)),1!==d&&(r.push(-1),r.push(1),r.push(2),r.push(d))):o&&(g=(e-s)/(i-s),w=(e-s)/(n-s),r.push(0),r.push(1),1!==w&&(r.push(-1),r.push(2),r.push(1),r.push(w)),1!==g&&(r.push(-1),r.push(2),r.push(0),r.push(g))):2===p?h||i===e?u||n===e?o||s===e||(f=(e-i)/(s-i),d=(e-n)/(s-n),r.push(2),r.push(-1),r.push(0),r.push(2),r.push(f),r.push(-1),r.push(1),r.push(2),r.push(d)):(w=(e-s)/(n-s),l=(e-i)/(n-i),r.push(1),r.push(-1),r.push(2),r.push(1),r.push(w),r.push(-1),r.push(0),r.push(1),r.push(l)):(c=(e-n)/(i-n),g=(e-s)/(i-s),r.push(0),r.push(-1),r.push(1),r.push(0),r.push(c),r.push(-1),r.push(2),r.push(0),r.push(g)):3!==p&&(r.push(0),r.push(1),r.push(2)),r},g.computeBarycentricCoordinates=function(e,t,i,n,s,r,h,u,o){if(!m(e))throw new a("x is required.");if(!m(t))throw new a("y is required.");if(!m(i))throw new a("x1 is required.");if(!m(n))throw new a("y1 is required.");if(!m(s))throw new a("x2 is required.");if(!m(r))throw new a("y2 is required.");if(!m(h))throw new a("x3 is required.");if(!m(u))throw new a("y3 is required.");let p=i-h,l=h-s,d=r-u,c=n-u,g=1/(d*p+l*c),w=t-u,x=e-h,y=(d*x+l*w)*g,I=(-c*x+p*w)*g,B=1-y-I;return m(o)?(o.x=y,o.y=I,o.z=B,o):new f(y,I,B)},g.computeLineSegmentLineSegmentIntersection=function(e,t,i,n,s,r,h,u,o){c.typeOf.number("x00",e),c.typeOf.number("y00",t),c.typeOf.number("x01",i),c.typeOf.number("y01",n),c.typeOf.number("x10",s),c.typeOf.number("y10",r),c.typeOf.number("x11",h),c.typeOf.number("y11",u);let l=(h-s)*(t-r)-(u-r)*(e-s),f=(i-e)*(t-r)-(n-t)*(e-s),d=(u-r)*(i-e)-(h-s)*(n-t);if(0===d)return;let a=l/d,g=f/d;if(a>=0&&a<=1&&g>=0&&g<=1)return m(o)||(o=new p),o.x=e+a*(i-e),o.y=t+a*(n-t),o};var w=[],x=[],y=[],I=new o,B=new f,v=[],A=[],k=[],b=[],j=[],O=new f,C=new h,N=new n,T=new p,H=new f;function R(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}R.prototype.clone=function(e){return m(e)||(e=new R),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},R.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},R.prototype.initializeFromClipResult=function(e,t,i){let n=t+1;return -1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},R.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},R.prototype.isIndexed=function(){return m(this.index)},R.prototype.getH=function(){return m(this.index)?this.heightBuffer[this.index]:d.lerp(this.first.getH(),this.second.getH(),this.ratio)},R.prototype.getU=function(){return m(this.index)?this.uBuffer[this.index]:d.lerp(this.first.getU(),this.second.getU(),this.ratio)},R.prototype.getV=function(){return m(this.index)?this.vBuffer[this.index]:d.lerp(this.first.getV(),this.second.getV(),this.ratio)};var z=new p,V=-1,q=[new f,new f],F=[new f,new f];function K(e,t){let i=q[++V],n=F[V];return i=s.octDecode(e.first.getNormalX(),e.first.getNormalY(),i),n=s.octDecode(e.second.getNormalX(),e.second.getNormalY(),n),B=f.lerp(i,n,e.ratio,B),f.normalize(B,B),s.octEncode(B,t),--V,t}R.prototype.getNormalX=function(){return m(this.index)?this.normalBuffer[2*this.index]:(z=K(this,z)).x},R.prototype.getNormalY=function(){return m(this.index)?this.normalBuffer[2*this.index+1]:(z=K(this,z)).y};var E=[];function P(e,t,i,n,s,r,h,u,o){if(0===h.length)return;let p=0,l=0;for(;l<h.length;)l=E[p++].initializeFromClipResult(h,l,u);for(let s=0;s<p;++s){let h=E[s];if(h.isIndexed())h.newIndex=r[h.index],h.uBuffer=e,h.vBuffer=t,h.heightBuffer=i,o&&(h.normalBuffer=n);else{let s=h.getKey();if(m(r[s]))h.newIndex=r[s];else{let u=e.length;e.push(h.getU()),t.push(h.getV()),i.push(h.getH()),o&&(n.push(h.getNormalX()),n.push(h.getNormalY())),h.newIndex=u,r[s]=u}}}3===p?(s.push(E[0].newIndex),s.push(E[1].newIndex),s.push(E[2].newIndex)):4===p&&(s.push(E[0].newIndex),s.push(E[1].newIndex),s.push(E[2].newIndex),s.push(E[0].newIndex),s.push(E[2].newIndex),s.push(E[3].newIndex))}E.push(new R),E.push(new R),E.push(new R),E.push(new R);var S=i(function(i,s){let o,p=i.isEastChild,a=i.isNorthChild,c=16383*!!p,m=p?32767:16383,z=16383*!!a,V=a?32767:16383;v.length=0,A.length=0,k.length=0,j.length=0,b.length=0;let q={},F=i.vertices,K=i.indices;K=K.subarray(0,i.indexCountWithoutSkirts);let E=t.clone(i.encoding),S=E.hasVertexNormals,L=0,X=i.vertexCountWithoutSkirts,M=i.minimumHeight,U=i.maximumHeight,G=Array(X),W=Array(X),J=Array(X),Q=S?Array(2*X):void 0,Y,Z,D,_,$;for(Z=0,D=0;Z<X;++Z,D+=2){let e=E.decodeTextureCoordinates(F,Z,T);if(Y=E.decodeHeight(F,Z),_=d.clamp(32767*e.x|0,0,32767),$=d.clamp(32767*e.y|0,0,32767),J[Z]=d.clamp((Y-M)/(U-M)*32767|0,0,32767),_<20&&(_=0),$<20&&($=0),32767-_<20&&(_=32767),32767-$<20&&($=32767),G[Z]=_,W[Z]=$,S){let e=E.getOctEncodedNormal(F,Z,H);Q[D]=e.x,Q[D+1]=e.y}(p&&_>=16383||!p&&_<=16383)&&(a&&$>=16383||!a&&$<=16383)&&(q[Z]=L,v.push(_),A.push($),k.push(J[Z]),S&&(j.push(Q[D]),j.push(Q[D+1])),++L)}let ee=[];ee.push(new R),ee.push(new R),ee.push(new R);let et=[];for(et.push(new R),et.push(new R),et.push(new R),Z=0;Z<K.length;Z+=3){let e=K[Z],t=K[Z+1],i=K[Z+2],n=G[e],s=G[t],r=G[i];ee[0].initializeIndexed(G,W,J,Q,e),ee[1].initializeIndexed(G,W,J,Q,t),ee[2].initializeIndexed(G,W,J,Q,i);let h=g.clipTriangleAtAxisAlignedThreshold(16383,p,n,s,r,w);!((o=0)>=h.length)&&((o=et[0].initializeFromClipResult(h,o,ee))>=h.length||!((o=et[1].initializeFromClipResult(h,o,ee))>=h.length)&&(o=et[2].initializeFromClipResult(h,o,ee),P(v,A,k,j,b,q,g.clipTriangleAtAxisAlignedThreshold(16383,a,et[0].getV(),et[1].getV(),et[2].getV(),x),et,S),o<h.length&&(et[2].clone(et[1]),et[2].initializeFromClipResult(h,o,ee),P(v,A,k,j,b,q,g.clipTriangleAtAxisAlignedThreshold(16383,a,et[0].getV(),et[1].getV(),et[2].getV(),x),et,S))))}let ei=p?-32767:0,en=a?-32767:0,es=[],er=[],eh=[],eu=[],eo=Number.MAX_VALUE,ep=-eo;y.length=0;let el=l.clone(i.ellipsoid),ef=u.clone(i.childRectangle),ed=ef.north,ea=ef.south,ec=ef.east,em=ef.west;for(ec<em&&(ec+=d.TWO_PI),Z=0;Z<v.length;++Z)(_=Math.round(v[Z]))<=c?(es.push(Z),_=0):_>=m?(eh.push(Z),_=32767):_=2*_+ei,v[Z]=_,($=Math.round(A[Z]))<=z?(er.push(Z),$=0):$>=V?(eu.push(Z),$=32767):$=2*$+en,A[Z]=$,(Y=d.lerp(M,U,k[Z]/32767))<eo&&(eo=Y),Y>ep&&(ep=Y),k[Z]=Y,I.longitude=d.lerp(em,ec,_/32767),I.latitude=d.lerp(ea,ed,$/32767),I.height=Y,el.cartographicToCartesian(I,B),y.push(B.x),y.push(B.y),y.push(B.z);let eg=h.fromVertices(y,f.ZERO,3,C),ew=n.fromRectangle(ef,eo,ep,el,N),ex=new e(el).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(eg.center,y,3,eg.center,eo,O),ey=ep-eo,eI=new Uint16Array(v.length+A.length+k.length);for(Z=0;Z<v.length;++Z)eI[Z]=v[Z];let eB=v.length;for(Z=0;Z<A.length;++Z)eI[eB+Z]=A[Z];for(eB+=A.length,Z=0;Z<k.length;++Z)eI[eB+Z]=32767*(k[Z]-eo)/ey;let ev=r.createTypedArray(v.length,b),eA;if(S){let e=new Uint8Array(j);s.push(eI.buffer,ev.buffer,e.buffer),eA=e.buffer}else s.push(eI.buffer,ev.buffer);return{vertices:eI.buffer,encodedNormals:eA,indices:ev.buffer,minimumHeight:eo,maximumHeight:ep,westIndices:es,southIndices:er,eastIndices:eh,northIndices:eu,boundingSphere:eg,orientedBoundingBox:ew,horizonOcclusionPoint:ex}});export{S as default};