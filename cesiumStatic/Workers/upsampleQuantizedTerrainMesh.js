import{a as e,c as t}from"./chunk-33IJ66H2.js";import{a as i}from"./chunk-ITDFUUP5.js";import{a as n}from"./chunk-AZKYNZOH.js";import{a as s}from"./chunk-DAX2P4DI.js";import"./chunk-SI3KZUTO.js";import"./chunk-QM7HI6IF.js";import"./chunk-SPC72PTY.js";import"./chunk-HVWI7BO6.js";import{a as r}from"./chunk-KSX6TRAS.js";import{c as h}from"./chunk-BNHFHP3L.js";import"./chunk-4UHVCH4T.js";import{j as u}from"./chunk-4NDD6KRQ.js";import"./chunk-5ELDAYCN.js";import"./chunk-N6BI774S.js";import"./chunk-TI35VBH7.js";import"./chunk-6WLI3422.js";import{a as o,b as p,c as l}from"./chunk-ICY67TC6.js";import{a as f}from"./chunk-G2EMNOST.js";import{a as d}from"./chunk-4VFKVGYI.js";import{a as a,b as c}from"./chunk-3WJNS2B6.js";import{e as m}from"./chunk-XCN226AA.js";var g={};g.clipTriangleAtAxisAlignedThreshold=function(e,t,i,n,s,r){let h,u,o;if(!m(e))throw new a("threshold is required.");if(!m(t))throw new a("keepAbove is required.");if(!m(i))throw new a("u0 is required.");if(!m(n))throw new a("u1 is required.");if(!m(s))throw new a("u2 is required.");m(r)?r.length=0:r=[],t?(h=i<e,u=n<e,o=s<e):(h=i>e,u=n>e,o=s>e);let p=h+u+o,l,f,d,c,g,w;return 1===p?h?(l=(e-i)/(n-i),f=(e-i)/(s-i),r.push(1),r.push(2),1!==f&&(r.push(-1),r.push(0),r.push(2),r.push(f)),1!==l&&(r.push(-1),r.push(0),r.push(1),r.push(l))):u?(d=(e-n)/(s-n),c=(e-n)/(i-n),r.push(2),r.push(0),1!==c&&(r.push(-1),r.push(1),r.push(0),r.push(c)),1!==d&&(r.push(-1),r.push(1),r.push(2),r.push(d))):o&&(g=(e-s)/(i-s),w=(e-s)/(n-s),r.push(0),r.push(1),1!==w&&(r.push(-1),r.push(2),r.push(1),r.push(w)),1!==g&&(r.push(-1),r.push(2),r.push(0),r.push(g))):2===p?h||i===e?u||n===e?o||s===e||(f=(e-i)/(s-i),d=(e-n)/(s-n),r.push(2),r.push(-1),r.push(0),r.push(2),r.push(f),r.push(-1),r.push(1),r.push(2),r.push(d)):(w=(e-s)/(n-s),l=(e-i)/(n-i),r.push(1),r.push(-1),r.push(2),r.push(1),r.push(w),r.push(-1),r.push(0),r.push(1),r.push(l)):(c=(e-n)/(i-n),g=(e-s)/(i-s),r.push(0),r.push(-1),r.push(1),r.push(0),r.push(c),r.push(-1),r.push(2),r.push(0),r.push(g)):3!==p&&(r.push(0),r.push(1),r.push(2)),r},g.computeBarycentricCoordinates=function(e,t,i,n,s,r,h,u,o){if(!m(e))throw new a("x is required.");if(!m(t))throw new a("y is required.");if(!m(i))throw new a("x1 is required.");if(!m(n))throw new a("y1 is required.");if(!m(s))throw new a("x2 is required.");if(!m(r))throw new a("y2 is required.");if(!m(h))throw new a("x3 is required.");if(!m(u))throw new a("y3 is required.");let p=i-h,l=h-s,d=r-u,c=n-u,g=1/(d*p+l*c),w=t-u,x=e-h,y=(d*x+l*w)*g,I=(-c*x+p*w)*g,B=1-y-I;return m(o)?(o.x=y,o.y=I,o.z=B,o):new f(y,I,B)},g.computeLineSegmentLineSegmentIntersection=function(e,t,i,n,s,r,h,u,o){c.typeOf.number("x00",e),c.typeOf.number("y00",t),c.typeOf.number("x01",i),c.typeOf.number("y01",n),c.typeOf.number("x10",s),c.typeOf.number("y10",r),c.typeOf.number("x11",h),c.typeOf.number("y11",u);let l=(h-s)*(t-r)-(u-r)*(e-s),f=(i-e)*(t-r)-(n-t)*(e-s),d=(u-r)*(i-e)-(h-s)*(n-t);if(0===d)return;let a=l/d,g=f/d;if(a>=0&&a<=1&&g>=0&&g<=1)return m(o)||(o=new p),o.x=e+a*(i-e),o.y=t+a*(n-t),o};var w=[],x=[],y=[],I=new o,B=new f,A=[],v=[],k=[],b=[],j=[],N=new f,C=new h,T=new n,H=new p,V=new f;function O(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}O.prototype.clone=function(e){return m(e)||(e=new O),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},O.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},O.prototype.initializeFromClipResult=function(e,t,i){let n=t+1;return -1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},O.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},O.prototype.isIndexed=function(){return m(this.index)},O.prototype.getH=function(){return m(this.index)?this.heightBuffer[this.index]:d.lerp(this.first.getH(),this.second.getH(),this.ratio)},O.prototype.getU=function(){return m(this.index)?this.uBuffer[this.index]:d.lerp(this.first.getU(),this.second.getU(),this.ratio)},O.prototype.getV=function(){return m(this.index)?this.vBuffer[this.index]:d.lerp(this.first.getV(),this.second.getV(),this.ratio)};var z=new p,q=-1,S=[new f,new f],U=[new f,new f];function F(e,t){let i=S[++q],n=U[q];return i=s.octDecode(e.first.getNormalX(),e.first.getNormalY(),i),n=s.octDecode(e.second.getNormalX(),e.second.getNormalY(),n),B=f.lerp(i,n,e.ratio,B),f.normalize(B,B),s.octEncode(B,t),--q,t}O.prototype.getNormalX=function(){return m(this.index)?this.normalBuffer[2*this.index]:(z=F(this,z)).x},O.prototype.getNormalY=function(){return m(this.index)?this.normalBuffer[2*this.index+1]:(z=F(this,z)).y};var R=[];function K(e,t,i,n,s,r,h,u,o){if(0===h.length)return;let p=0,l=0;for(;l<h.length;)l=R[p++].initializeFromClipResult(h,l,u);for(let s=0;s<p;++s){let h=R[s];if(h.isIndexed())h.newIndex=r[h.index],h.uBuffer=e,h.vBuffer=t,h.heightBuffer=i,o&&(h.normalBuffer=n);else{let s=h.getKey();if(m(r[s]))h.newIndex=r[s];else{let u=e.length;e.push(h.getU()),t.push(h.getV()),i.push(h.getH()),o&&(n.push(h.getNormalX()),n.push(h.getNormalY())),h.newIndex=u,r[s]=u}}}3===p?(s.push(R[0].newIndex),s.push(R[1].newIndex),s.push(R[2].newIndex)):4===p&&(s.push(R[0].newIndex),s.push(R[1].newIndex),s.push(R[2].newIndex),s.push(R[0].newIndex),s.push(R[2].newIndex),s.push(R[3].newIndex))}R.push(new O),R.push(new O),R.push(new O),R.push(new O);var P=i(function(i,s){let o,p=i.isEastChild,a=i.isNorthChild,c=16383*!!p,m=p?32767:16383,z=16383*!!a,q=a?32767:16383;A.length=0,v.length=0,k.length=0,j.length=0,b.length=0;let S={},U=i.vertices,F=i.indices;F=F.subarray(0,i.indexCountWithoutSkirts);let R=t.clone(i.encoding),P=R.hasVertexNormals,Y=0,D=i.vertexCountWithoutSkirts,E=i.minimumHeight,X=i.maximumHeight,L=Array(D),W=Array(D),M=Array(D),Z=P?Array(2*D):void 0,J,G,Q,_,$;for(G=0,Q=0;G<D;++G,Q+=2){let e=R.decodeTextureCoordinates(U,G,H);if(J=R.decodeHeight(U,G),_=d.clamp(32767*e.x|0,0,32767),$=d.clamp(32767*e.y|0,0,32767),M[G]=d.clamp((J-E)/(X-E)*32767|0,0,32767),_<20&&(_=0),$<20&&($=0),32767-_<20&&(_=32767),32767-$<20&&($=32767),L[G]=_,W[G]=$,P){let e=R.getOctEncodedNormal(U,G,V);Z[Q]=e.x,Z[Q+1]=e.y}(p&&_>=16383||!p&&_<=16383)&&(a&&$>=16383||!a&&$<=16383)&&(S[G]=Y,A.push(_),v.push($),k.push(M[G]),P&&(j.push(Z[Q]),j.push(Z[Q+1])),++Y)}let ee=[];ee.push(new O),ee.push(new O),ee.push(new O);let et=[];for(et.push(new O),et.push(new O),et.push(new O),G=0;G<F.length;G+=3){let e=F[G],t=F[G+1],i=F[G+2],n=L[e],s=L[t],r=L[i];ee[0].initializeIndexed(L,W,M,Z,e),ee[1].initializeIndexed(L,W,M,Z,t),ee[2].initializeIndexed(L,W,M,Z,i);let h=g.clipTriangleAtAxisAlignedThreshold(16383,p,n,s,r,w);!((o=0)>=h.length)&&((o=et[0].initializeFromClipResult(h,o,ee))>=h.length||!((o=et[1].initializeFromClipResult(h,o,ee))>=h.length)&&(o=et[2].initializeFromClipResult(h,o,ee),K(A,v,k,j,b,S,g.clipTriangleAtAxisAlignedThreshold(16383,a,et[0].getV(),et[1].getV(),et[2].getV(),x),et,P),o<h.length&&(et[2].clone(et[1]),et[2].initializeFromClipResult(h,o,ee),K(A,v,k,j,b,S,g.clipTriangleAtAxisAlignedThreshold(16383,a,et[0].getV(),et[1].getV(),et[2].getV(),x),et,P))))}let ei=p?-32767:0,en=a?-32767:0,es=[],er=[],eh=[],eu=[],eo=Number.MAX_VALUE,ep=-eo;y.length=0;let el=l.clone(i.ellipsoid),ef=u.clone(i.childRectangle),ed=ef.north,ea=ef.south,ec=ef.east,em=ef.west;for(ec<em&&(ec+=d.TWO_PI),G=0;G<A.length;++G)(_=Math.round(A[G]))<=c?(es.push(G),_=0):_>=m?(eh.push(G),_=32767):_=2*_+ei,A[G]=_,($=Math.round(v[G]))<=z?(er.push(G),$=0):$>=q?(eu.push(G),$=32767):$=2*$+en,v[G]=$,(J=d.lerp(E,X,k[G]/32767))<eo&&(eo=J),J>ep&&(ep=J),k[G]=J,I.longitude=d.lerp(em,ec,_/32767),I.latitude=d.lerp(ea,ed,$/32767),I.height=J,el.cartographicToCartesian(I,B),y.push(B.x),y.push(B.y),y.push(B.z);let eg=h.fromVertices(y,f.ZERO,3,C),ew=n.fromRectangle(ef,eo,ep,el,T),ex=new e(el).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(eg.center,y,3,eg.center,eo,N),ey=ep-eo,eI=new Uint16Array(A.length+v.length+k.length);for(G=0;G<A.length;++G)eI[G]=A[G];let eB=A.length;for(G=0;G<v.length;++G)eI[eB+G]=v[G];for(eB+=v.length,G=0;G<k.length;++G)eI[eB+G]=32767*(k[G]-eo)/ey;let eA=r.createTypedArray(A.length,b),ev;if(P){let e=new Uint8Array(j);s.push(eI.buffer,eA.buffer,e.buffer),ev=e.buffer}else s.push(eI.buffer,eA.buffer);return{vertices:eI.buffer,encodedNormals:ev,indices:eA.buffer,minimumHeight:eo,maximumHeight:ep,westIndices:es,southIndices:er,eastIndices:eh,northIndices:eu,boundingSphere:eg,orientedBoundingBox:ew,horizonOcclusionPoint:ex}});export{P as default};